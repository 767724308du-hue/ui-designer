<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iOS 页面设计器</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg-primary: #F6F7F8;
            --bg-secondary: #ffffff;
            --text-primary: #111111;
            --text-secondary: #666666;
            --text-tertiary: #999999;
            --border-color: #E6E6E8;
            --accent-color: #111111;
            --danger-color: #ff3b30;
            --success-color: #34c759;
            --radius-card: 12px;
            --radius-button: 10px;
            --radius-input: 12px;
            --spacing-xs: 8px;
            --spacing-sm: 12px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            display: flex;
            min-height: 100vh;
        }

        .toolbar {
            width: 260px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 10;
            display: flex;
            flex-direction: column;
        }
        /* 固定区（Pinned Header） */
        .toolbar-pinned {
            flex-shrink: 0;
            padding: 16px 12px;
            background: #FAFAFA;
            border-bottom: 1px solid var(--border-color);
            position: relative;
            z-index: 2;
        }
        .toolbar-pinned.scrolled {
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        .toolbar-pinned-title {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }
        /* 大按钮卡片入口 */
        .mode-cards {
            display: flex;
            gap: 8px;
        }
        .mode-card {
            flex: 1;
            background: #ffffff;
            border: 1.5px solid var(--border-color);
            border-radius: 10px;
            padding: 14px 10px;
            cursor: pointer;
            transition: all 0.15s;
            text-align: center;
        }
        .mode-card:hover {
            border-color: #CCCCCC;
            background: #FEFEFE;
        }
        .mode-card.active {
            border-color: #111111;
            background: #111111;
        }
        .mode-card-icon {
            width: 32px;
            height: 32px;
            margin: 0 auto 8px;
            background: var(--bg-primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: var(--text-secondary);
            transition: all 0.15s;
        }
        .mode-card.active .mode-card-icon {
            background: rgba(255,255,255,0.15);
            color: #ffffff;
        }
        .mode-card-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
            transition: all 0.15s;
        }
        .mode-card.active .mode-card-title {
            color: #ffffff;
        }
        .mode-card-desc {
            font-size: 10px;
            color: var(--text-tertiary);
            transition: all 0.15s;
        }
        .mode-card.active .mode-card-desc {
            color: rgba(255,255,255,0.6);
        }
        /* 滚动区 */
        .toolbar-scrollable {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
        }
        .toolbar-scrollable.template-mode {
            padding: 0;
            overflow: hidden;
        }
        .toolbar-scrollable.free-mode {
            padding: 16px 12px;
        }
        .toolbar-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }
        .component-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            margin-bottom: 24px;
        }
        .component-item {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 12px 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.15s;
            user-select: none;
        }
        .component-item:hover {
            border-color: #999999;
            background: #F0F0F2;
        }
        .component-item:active { transform: scale(0.96); }
        .component-item i {
            font-size: 20px;
            color: var(--text-secondary);
            margin-bottom: 6px;
            display: block;
            pointer-events: none;
        }
        .component-item span {
            font-size: 11px;
            color: var(--text-primary);
            font-weight: 500;
            pointer-events: none;
        }

        /* 全局 Tooltip（挂载到body，不被裁切） */
        .global-tooltip {
            position: fixed;
            z-index: 99999;
            background: #333333;
            color: #ffffff;
            font-size: 11px;
            font-weight: 500;
            padding: 5px 8px;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            pointer-events: none;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.1s;
        }
        .global-tooltip.visible {
            opacity: 1;
        }

        /* 模板首次提示 */
        .template-hint {
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            background: #333333;
            color: #ffffff;
            font-size: 12px;
            font-weight: 500;
            padding: 10px 16px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 100;
            animation: slideDown 0.3s ease;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateX(-50%) translateY(-10px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
        .template-hint-text {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .template-hint-text i {
            color: #34c759;
        }
        .template-hint-close {
            background: none;
            border: none;
            color: rgba(255,255,255,0.6);
            cursor: pointer;
            padding: 4px;
            font-size: 14px;
            line-height: 1;
            transition: color 0.15s;
        }
        .template-hint-close:hover {
            color: #ffffff;
        }

        .canvas-area {
            margin-left: 260px;
            margin-right: 360px;
            padding: 32px;
            padding-bottom: 100px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            flex: 1;
            overflow: auto;
            position: relative;
        }
        .phone-frame {
            width: 390px;
            height: 844px;
            background: #fff;
            border-radius: 54px;
            box-shadow: 0 25px 80px rgba(0,0,0,0.15), 0 0 0 12px #1d1d1f;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
            transition: transform 0.2s ease;
        }
        .phone-notch {
            width: 126px;
            height: 34px;
            background: #1d1d1f;
            border-radius: 0 0 20px 20px;
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
        }
        .phone-screen {
            width: 100%;
            height: 100%;
            padding-top: 54px;
            padding-bottom: 34px;
            overflow-y: auto;
            background: #fff;
            position: relative;
        }
        .phone-home-indicator {
            width: 134px;
            height: 5px;
            background: #1d1d1f;
            border-radius: 3px;
            position: absolute;
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 101;
        }
        .canvas-content {
            min-height: 100%;
            position: relative;
        }
        /* Free layout mode */
        .canvas-content.free-layout {
            height: calc(844px - 54px - 34px);
        }
        /* 独立操作按钮覆盖层 - 不参与画布缩放 */
        #blockActionsOverlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 1000;
        }
        #blockActionsOverlay .overlay-actions {
            position: absolute;
            display: flex;
            flex-direction: column;
            gap: 6px;
            padding: 6px;
            background: rgba(255,255,255,0.98);
            border-radius: 10px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            border: 1px solid #E6E6E8;
            pointer-events: auto;
        }
        #blockActionsOverlay .overlay-action-btn {
            width: 32px;
            height: 32px;
            min-width: 32px;
            min-height: 32px;
            border-radius: 8px;
            border: none;
            background: #333333;
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            transition: background 0.15s;
        }
        #blockActionsOverlay .overlay-action-btn:hover {
            background: #111111;
        }
        #blockActionsOverlay .overlay-action-btn.delete:hover {
            background: var(--danger-color);
        }
        body.preview-mode #blockActionsOverlay { display: none; }
        .empty-canvas {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 500px;
            color: var(--text-tertiary);
            text-align: center;
            padding: 20px;
        }
        .empty-canvas i { font-size: 40px; margin-bottom: 16px; color: var(--border-color); }
        .empty-canvas .empty-title { font-size: 16px; font-weight: 500; color: var(--text-primary); margin-bottom: 8px; }
        .empty-canvas .empty-subtitle { font-size: 13px; color: var(--text-tertiary); line-height: 1.6; margin-bottom: 20px; }
        .empty-canvas .empty-actions { display: flex; gap: 10px; margin-bottom: 24px; }
        .empty-canvas .empty-btn { padding: 10px 20px; border-radius: 8px; font-size: 13px; font-weight: 500; cursor: pointer; border: 1px solid var(--border-color); background: #fff; color: var(--text-primary); transition: all 0.15s; }
        .empty-canvas .empty-btn:hover { border-color: #333333; color: #333333; }
        .empty-canvas .empty-btn.primary { background: #111111; color: #fff; border-color: #111111; }
        .empty-canvas .empty-btn.primary:hover { background: #333333; }
        .empty-canvas .empty-note { font-size: 11px; color: var(--text-tertiary); }

        .block {
            position: relative;
            cursor: grab;
            transition: outline 0.15s, background 0.15s;
        }
        .block:active { cursor: grabbing; }
        .block:hover { outline: 1px solid #CCCCCC; outline-offset: -1px; }
        .block.selected { outline: 1px solid #333333; outline-offset: -1px; background: transparent; }
        .block.multi-selected { outline: 1px solid #666666; outline-offset: -1px; background: transparent; }
        .block.dragging { opacity: 0.5; }
        .block.free-dragging {
            opacity: 0.9;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 100 !important;
            cursor: grabbing !important;
        }
        .block.drag-over { border-top: 2px solid #333333; }
        /* 禁止组件内部文本选择（非编辑状态） */
        .block * {
            user-select: none;
            -webkit-user-select: none;
        }
        .block input, .block textarea, .block [contenteditable="true"] {
            user-select: text;
            -webkit-user-select: text;
        }
        /* 选中状态显示移动光标 */
        .block.selected {
            cursor: grab;
        }
        .block.selected:active {
            cursor: grabbing;
        }

        /* Alignment guides */
        .align-guide {
            position: absolute;
            background: #FF6B6B;
            z-index: 1000;
            pointer-events: none;
        }
        .align-guide.horizontal {
            height: 1px;
            left: 0;
            right: 0;
            box-shadow: 0 0 2px rgba(255, 107, 107, 0.5);
        }
        .align-guide.vertical {
            width: 1px;
            top: 0;
            bottom: 0;
            box-shadow: 0 0 2px rgba(255, 107, 107, 0.5);
        }
        .align-guide-label {
            position: absolute;
            background: #FF6B6B;
            color: #fff;
            font-size: 9px;
            padding: 1px 4px;
            border-radius: 2px;
            white-space: nowrap;
            font-weight: 500;
        }

        /* Distance bubble */
        .distance-bubble {
            position: absolute;
            background: #FF6B6B;
            color: #fff;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            white-space: nowrap;
            z-index: 1001;
            pointer-events: none;
            font-weight: 500;
            transform: translate(-50%, -50%);
        }

        /* Component tooltip */
        .component-item {
            position: relative;
        }
        .component-item::after {
            content: attr(data-tip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.85);
            color: #fff;
            font-size: 10px;
            padding: 4px 8px;
            border-radius: 4px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
            z-index: 100;
            margin-bottom: 4px;
        }
        .component-item:hover::after {
            opacity: 1;
            visibility: visible;
        }

        /* Top toolbar */
        .top-toolbar {
            position: fixed;
            top: 0;
            left: 260px;
            right: 360px;
            height: 48px;
            background: #fff;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            flex-wrap: nowrap;
            overflow: visible;
            white-space: nowrap;
            align-items: center;
            padding: 0 16px;
            gap: 4px;
            z-index: 50;
        }
        .toolbar-group {
            display: flex;
            align-items: center;
            gap: 4px;
            flex-shrink: 0;
        }
        .toolbar-btn {
            position: relative;
            flex: 0 0 auto;
            width: 36px;
            height: 36px;
            border-radius: 6px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            transition: all 0.15s;
        }
        .toolbar-btn:hover {
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        .toolbar-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        .toolbar-btn.active {
            background: #333333;
            color: #fff;
        }
        .toolbar-divider {
            width: 1px;
            height: 24px;
            background: var(--border-color);
            margin: 0 4px;
            flex-shrink: 0;
        }
        /* Tooltip 浮层（显示在按钮下方） */
        .toolbar-btn .btn-tooltip {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-top: 6px;
            padding: 6px 10px;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
            white-space: nowrap;
            text-align: center;
            pointer-events: none;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.1s, visibility 0.1s;
            z-index: 9999;
        }
        .toolbar-btn .btn-tooltip::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-bottom-color: rgba(0, 0, 0, 0.9);
        }
        .toolbar-btn:hover .btn-tooltip {
            opacity: 1;
            visibility: visible;
        }
        .toolbar-btn .btn-tooltip .tip-cn {
            display: block;
            font-size: 12px;
            font-weight: 500;
            color: #fff;
            line-height: 1.4;
        }
        .toolbar-btn .btn-tooltip .tip-en {
            display: block;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
            line-height: 1.3;
            margin-top: 2px;
        }

        /* 开发标注浮层（仅用于导出功能） */
        .dev-annotation-overlay {
            position: fixed;
            background: rgba(30, 30, 30, 0.95);
            color: #fff;
            border-radius: 8px;
            padding: 12px 14px;
            font-size: 11px;
            font-family: 'SF Mono', Monaco, 'Courier New', monospace;
            line-height: 1.6;
            z-index: 10000;
            pointer-events: none;
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
            max-width: 280px;
            display: none;
        }
        .dev-annotation-overlay.visible {
            display: block;
        }
        .dev-annotation-overlay::before {
            content: '';
            position: absolute;
            top: -6px;
            left: 20px;
            border: 6px solid transparent;
            border-bottom-color: rgba(30, 30, 30, 0.95);
            border-top: none;
        }
        .dev-annotation-title {
            font-size: 12px;
            font-weight: 600;
            color: #4FC3F7;
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .dev-annotation-row {
            display: flex;
            justify-content: space-between;
            padding: 3px 0;
        }
        .dev-annotation-label {
            color: rgba(255,255,255,0.6);
        }
        .dev-annotation-value {
            color: #81C784;
            font-weight: 500;
        }
        .dev-annotation-section {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        .dev-annotation-section-title {
            font-size: 10px;
            color: #FFB74D;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        /* 开发模式下的组件高亮 */
        body.dev-mode .block:hover {
            outline: 2px dashed #4FC3F7 !important;
            outline-offset: 2px;
        }

        /* Adjust canvas area for top toolbar */
        .canvas-area {
            padding-top: 80px;
        }

        /* Keyboard shortcuts hint */
        .shortcut-hint {
            font-size: 10px;
            color: var(--text-tertiary);
            margin-left: 4px;
        }

        /* Free position block */
        .block.free-position {
            position: absolute !important;
            cursor: move;
            z-index: 10;
        }
        .block.free-position.selected {
            z-index: 20;
        }
        .block.free-position:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        /* Resize handles */
        .resize-handle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #333333;
            border: 2px solid #fff;
            border-radius: 2px;
            display: none;
            z-index: 100;
        }
        .block.selected .resize-handle { display: block; }
        .resize-handle.se { bottom: -5px; right: -5px; cursor: se-resize; }
        .resize-handle.sw { bottom: -5px; left: -5px; cursor: sw-resize; }
        .resize-handle.ne { top: -5px; right: -5px; cursor: ne-resize; }
        .resize-handle.nw { top: -5px; left: -5px; cursor: nw-resize; }

        .block-actions {
            display: none !important; /* 隐藏原有的内联操作按钮，改用独立覆盖层 */
        }
        .block-action-btn {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            border: 1px solid rgba(255,255,255,0.3);
            background: #1d1d1f;
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
            backdrop-filter: blur(10px);
            transition: all 0.15s;
        }
        .block-action-btn:hover {
            background: #333;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }
        .block-action-btn.delete:hover { background: var(--danger-color); }
        .drag-handle {
            cursor: grab;
            padding: 4px;
            color: #fff;
        }
        .drag-handle:active { cursor: grabbing; }

        .properties-panel {
            width: 360px;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-color);
            height: 100vh;
            position: fixed;
            right: 0;
            top: 0;
            overflow-y: auto;
            z-index: 10;
        }
        .panel-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            background: #fff;
            z-index: 5;
        }
        .panel-tab {
            flex: 1;
            padding: 14px;
            text-align: center;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        .panel-tab:hover { color: var(--text-primary); }
        .panel-tab.active { color: #111111; border-bottom-color: #111111; }
        .panel-content { padding: 16px; display: none; }
        .panel-content.active { display: block; }
        .panel-section { margin-bottom: 20px; }
        .panel-section-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }
        .property-row { margin-bottom: 14px; }
        .property-label { font-size: 12px; color: var(--text-secondary); margin-bottom: 6px; display: block; }
        .property-input {
            width: 100%;
            padding: 9px 11px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 13px;
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        .property-input:focus { outline: none; border-color: #999999; }
        .property-textarea { resize: vertical; min-height: 72px; }

        .slider-row { display: flex; align-items: center; gap: 10px; }
        .property-slider {
            flex: 1;
            -webkit-appearance: none;
            height: 4px;
            border-radius: 2px;
            background: var(--border-color);
        }
        .property-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #333333;
            cursor: pointer;
        }
        .slider-value { font-size: 12px; color: var(--text-secondary); min-width: 44px; text-align: right; }

        .color-row { display: flex; gap: 8px; align-items: center; }
        .color-picker {
            width: 36px;
            height: 36px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            padding: 0;
        }
        .color-picker::-webkit-color-swatch-wrapper { padding: 0; }
        .color-picker::-webkit-color-swatch { border: none; border-radius: 6px; }
        .color-presets { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 8px; }
        .color-preset {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
        }
        .color-preset:hover { transform: scale(1.1); }

        .segment-control { display: flex; background: var(--bg-primary); border-radius: 8px; padding: 3px; }
        .segment-option {
            flex: 1;
            padding: 8px 6px;
            text-align: center;
            font-size: 11px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 6px;
        }
        .segment-option:hover { color: var(--text-primary); }
        .segment-option.active { background: #fff; color: var(--text-primary); box-shadow: 0 1px 3px rgba(0,0,0,0.1); }

        .icon-grid-container {
            max-height: 360px;
            overflow-y: auto;
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 8px;
        }
        .icon-category-label {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 8px 0 4px 4px;
            padding-bottom: 4px;
            border-bottom: 1px solid var(--border-color);
        }
        .icon-category-label:first-child {
            margin-top: 0;
        }
        .icon-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
            padding: 4px 0;
        }
        .icon-option {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            cursor: pointer;
            color: var(--text-secondary);
            font-size: 14px;
        }
        .icon-option:hover, .icon-option.selected { background: #333333; color: #fff; }

        .number-input-group { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .number-input-item { display: flex; flex-direction: column; gap: 4px; }
        .number-input-item label { font-size: 11px; color: var(--text-tertiary); }
        .number-input-item input {
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 13px;
            background: #fff;
            text-align: center;
        }

        .global-section { background: var(--bg-primary); border-radius: 10px; padding: 14px; margin-bottom: 14px; }
        .global-section h4 { font-size: 12px; font-weight: 600; margin-bottom: 10px; }

        .no-selection { text-align: center; padding: 60px 24px; color: var(--text-tertiary); }
        .no-selection i { font-size: 40px; margin-bottom: 16px; display: block; color: var(--border-color); }
        .no-selection .no-sel-title { font-size: 15px; font-weight: 500; color: var(--text-primary); margin-bottom: 10px; }
        .no-selection .no-sel-desc { font-size: 13px; color: var(--text-secondary); line-height: 1.6; margin-bottom: 16px; }
        .no-selection .no-sel-hint { font-size: 11px; color: var(--text-tertiary); }

        .multi-info { background: #F6F7F8; border: 1px solid #E6E6E8; border-radius: 10px; padding: 14px; margin-bottom: 16px; }
        .multi-info h4 { font-size: 13px; font-weight: 600; color: #333333; margin-bottom: 4px; }
        .multi-info p { font-size: 12px; color: var(--text-secondary); }

        .checkbox-row { display: flex; align-items: center; gap: 8px; }
        .checkbox-row input { width: 18px; height: 18px; accent-color: #333333; }
        .checkbox-row label { font-size: 13px; cursor: pointer; }

        .preview-btn {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            background: #1d1d1f;
            color: #fff;
            border: none;
            border-radius: 24px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        .preview-btn:hover { background: #000; }

        /* Phone scale controls */
        .phone-scale-controls {
            position: fixed;
            bottom: 24px;
            left: 280px;
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255,255,255,0.95);
            padding: 8px 16px;
            border-radius: 20px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.15);
            z-index: 100;
        }
        .scale-label {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        .scale-slider {
            width: 100px;
            -webkit-appearance: none;
            height: 4px;
            border-radius: 2px;
            background: var(--border-color);
        }
        .scale-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #333333;
            cursor: pointer;
        }
        .scale-value {
            font-size: 12px;
            color: var(--text-primary);
            font-weight: 600;
            min-width: 40px;
        }
        .scale-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 1px solid var(--border-color);
            background: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: var(--text-secondary);
        }
        .scale-btn:hover {
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        /* Drag ghost element */
        .drag-ghost {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            background: #333333;
            color: #fff;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            box-shadow: 0 4px 20px rgba(0,0,0,0.25);
            opacity: 0.9;
        }

        /* Drop zone indicator */
        .canvas-content.drag-over-canvas {
            background: rgba(0,0,0,0.02);
            outline: 2px dashed #999999;
            outline-offset: -2px;
        }

        body.preview-mode .toolbar, body.preview-mode .properties-panel, body.preview-mode .phone-scale-controls { display: none; }
        body.preview-mode .canvas-area { margin: 0; }
        body.preview-mode .block-actions { display: none !important; }
        body.preview-mode .block:hover { outline: none; }
        body.preview-mode .block { cursor: default; }
        body.preview-mode .resize-handle { display: none !important; }

        /* iOS Components */
        .ios-navbar { padding: 12px 16px; display: flex; align-items: center; justify-content: space-between; }
        .ios-navbar-left, .ios-navbar-right { width: 60px; display: flex; align-items: center; }
        .ios-navbar-right { justify-content: flex-end; }
        .ios-navbar-title { font-size: 17px; font-weight: 600; white-space: pre-wrap; }
        .ios-navbar-btn { font-size: 17px; background: none; border: none; cursor: pointer; color: #111111; }

        .ios-large-title { padding: 8px 16px 16px; }
        .ios-large-title h1 { font-size: 34px; font-weight: 700; letter-spacing: -0.5px; white-space: pre-wrap; }

        .ios-search { padding: 8px 16px; }
        .ios-search-wrapper { position: relative; }
        .ios-search-wrapper i { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 14px; color: var(--text-tertiary); }
        .ios-search-input { width: 100%; padding: 10px 12px 10px 36px; border: 1px solid #E6E6E8; border-radius: 10px; font-size: 17px; background: var(--bg-primary); transition: border-color 0.15s, box-shadow 0.15s; }
        .ios-search-input:focus { border-color: #999999; box-shadow: 0 0 0 2px rgba(0,0,0,0.04); outline: none; }

        .ios-section-header { padding: 24px 16px 8px; background: var(--bg-primary); }
        .ios-section-header span { font-size: 13px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; white-space: pre-wrap; }

        .ios-list-item { padding: 12px 16px; display: flex; align-items: center; background: #fff; }
        .ios-list-icon { width: 30px; height: 30px; border-radius: 7px; display: flex; align-items: center; justify-content: center; margin-right: 12px; color: #fff; font-size: 16px; }
        .ios-list-content { flex: 1; }
        .ios-list-title { font-size: 17px; white-space: pre-wrap; }
        .ios-list-subtitle { font-size: 13px; color: var(--text-secondary); margin-top: 2px; white-space: pre-wrap; }
        .ios-list-value { font-size: 17px; color: var(--text-secondary); margin-right: 8px; }
        .ios-list-accessory { font-size: 14px; color: var(--text-tertiary); }

        .ios-toggle-item { padding: 12px 16px; display: flex; align-items: center; justify-content: space-between; background: #fff; }
        .ios-toggle { width: 51px; height: 31px; border-radius: 16px; position: relative; cursor: pointer; transition: background 0.3s; }
        .ios-toggle::after { content: ''; width: 27px; height: 27px; background: #fff; border-radius: 50%; position: absolute; top: 2px; left: 2px; transition: transform 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .ios-toggle.on::after { transform: translateX(20px); }

        .ios-card { margin: 16px; border-radius: 12px; overflow: hidden; background: #fff; border: 1px solid #E6E6E8; }
        .ios-card-image { height: 180px; display: flex; align-items: center; justify-content: center; color: #999999; font-size: 48px; background: #F6F7F8; }
        .ios-card-body { padding: 16px; }
        .ios-card-title { font-size: 17px; font-weight: 600; margin-bottom: 4px; white-space: pre-wrap; }
        .ios-card-desc { font-size: 15px; color: var(--text-secondary); line-height: 1.4; white-space: pre-wrap; }

        .ios-button { margin: 16px; }
        .ios-button button { width: 100%; border: none; border-radius: 12px; font-size: 17px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 0; padding-bottom: 1px; /* 视觉居中微调 */ line-height: 1; }

        .ios-avatar-block { padding: 24px 16px; display: flex; flex-direction: column; align-items: center; background: #fff; }
        .ios-avatar { width: 100px; height: 100px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #999999; font-size: 40px; margin-bottom: 12px; background: #E6E6E8; }
        .ios-avatar-name { font-size: 22px; font-weight: 600; white-space: pre-wrap; }
        .ios-avatar-subtitle { font-size: 15px; color: var(--text-secondary); margin-top: 4px; white-space: pre-wrap; }

        .ios-text-block { padding: 16px; background: #fff; }
        .ios-text-block p { font-size: 15px; color: var(--text-secondary); line-height: 1.5; white-space: pre-wrap; }

        /* 空文本占位符样式 */
        .text-placeholder {
            color: #C7C7CC !important;
            font-style: italic;
            opacity: 0.8;
        }
        .ios-large-title .text-placeholder {
            font-size: 28px;
            font-weight: 600;
        }

        .ios-icon-block { display: inline-block; background: transparent; position: relative; }
        .ios-icon-block i { font-size: 32px; line-height: 1; display: block; }
        .ios-icon-block .block-actions {
            position: absolute;
            top: auto;
            bottom: calc(100% + 8px);
            left: 50%;
            right: auto;
            transform: translateX(-50%);
            white-space: nowrap;
            gap: 8px;
            padding: 6px 8px;
            background: rgba(255,255,255,0.98);
            border-radius: 10px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            border: 1px solid #E6E6E8;
        }
        .ios-icon-block .block-action-btn {
            width: 32px;
            height: 32px;
            min-width: 32px;
            min-height: 32px;
            background: #333333;
            border: none;
            border-radius: 8px;
            box-shadow: none;
            font-size: 13px;
            flex-shrink: 0;
        }
        .ios-icon-block .block-action-btn:hover {
            background: #111111;
            transform: none;
        }
        .ios-icon-block .block-action-btn.delete:hover {
            background: var(--danger-color);
        }

        /* 细组件增加隐形可点击区域 */
        .ios-divider {
            height: 1px;
            background: var(--border-color);
            position: relative;
        }
        .ios-divider.selected {
            background: #666;
        }

        /* 六点拖拽手柄 - 放在操作按钮组中 */
        .overlay-drag-handle {
            width: 32px;
            height: 32px;
            min-width: 32px;
            background: #fff;
            border: none;
            border-radius: 6px;
            cursor: grab;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 3px;
            transition: background 0.15s;
            margin-bottom: 2px;
            border-bottom: 1px solid #E6E6E8;
            padding-bottom: 2px;
        }
        .overlay-drag-handle:hover {
            background: #F5F5F5;
        }
        .overlay-drag-handle:active {
            cursor: grabbing;
            background: #EBEBEB;
        }
        .overlay-drag-handle .dot-col {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        .overlay-drag-handle .dot {
            width: 4px;
            height: 4px;
            background: #888;
            border-radius: 50%;
        }
        .ios-spacer { height: 24px; position: relative; }
        .ios-spacer:hover {
            background-color: rgba(0,0,0,0.02);
        }

        .ios-tabbar { display: flex; padding: 8px 0 4px; position: absolute; bottom: 34px; left: 0; right: 0; background: #fff; }
        .ios-tabbar-item { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px; font-size: 10px; cursor: pointer; color: var(--text-tertiary); }
        .ios-tabbar-item.active { color: #111111; }
        .ios-tabbar-item i { font-size: 24px; }

        /* Number Picker - Wheel Style */
        .ios-number-picker {
            background: #fff;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .ios-number-picker-label { font-size: 17px; }
        .ios-number-picker-wheel {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            height: 100px;
            overflow: hidden;
        }
        .ios-number-picker-scroll {
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.2s ease;
        }
        .ios-number-picker-item {
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: var(--text-tertiary);
            cursor: pointer;
            transition: all 0.2s;
            min-width: 60px;
        }
        .ios-number-picker-item.active {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-primary);
        }
        .ios-number-picker-item.near { font-size: 16px; color: var(--text-secondary); }
        .ios-number-picker-item.far { font-size: 14px; color: var(--text-tertiary); opacity: 0.5; }
        .ios-number-picker-highlight {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 34px;
            transform: translateY(-50%);
            border-top: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
            background: rgba(0,0,0,0.02);
            pointer-events: none;
            border-radius: 8px;
        }
        .ios-number-picker-arrows {
            position: absolute;
            right: -24px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .ios-number-picker-arrow {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-tertiary);
            font-size: 10px;
            border-radius: 4px;
        }
        .ios-number-picker-arrow:hover { background: var(--bg-primary); color: var(--text-primary); }
        .ios-number-picker-unit { font-size: 14px; color: var(--text-secondary); margin-left: 8px; }

        /* Option Item */
        .ios-option-item {
            background: #fff;
            padding: 14px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }
        .ios-option-item-left { display: flex; align-items: center; gap: 12px; }
        .ios-option-item-icon {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: transparent;
            transition: all 0.2s;
        }
        .ios-option-item.checked .ios-option-item-icon {
            background: #111111;
            border-color: #111111;
            color: #fff;
        }
        .ios-option-item-text { font-size: 17px; white-space: pre-wrap; }
        .ios-option-item-desc { font-size: 13px; color: var(--text-secondary); margin-top: 2px; }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        .modal-overlay.show { opacity: 1; visibility: visible; }
        .modal-box {
            background: #fff;
            border-radius: 14px;
            width: 270px;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s;
        }
        .modal-overlay.show .modal-box { transform: scale(1); }
        .modal-header { padding: 20px 16px 8px; }
        .modal-title { font-size: 17px; font-weight: 600; }
        .modal-body { padding: 0 16px 20px; font-size: 13px; color: var(--text-secondary); }
        .modal-actions { border-top: 0.5px solid var(--border-color); display: flex; }
        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: none;
            font-size: 17px;
            color: #333333;
            cursor: pointer;
        }
        .modal-btn:first-child { border-right: 0.5px solid var(--border-color); }
        .modal-btn.primary { font-weight: 600; }
        .modal-btn.danger { color: var(--danger-color); }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: rgba(0,0,0,0.8);
            color: #fff;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 15px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            z-index: 2001;
        }
        .toast.show { opacity: 1; visibility: visible; transform: translateX(-50%) translateY(0); }

        /* Confirm Dialog */
        .confirm-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.4); display: none; align-items: center; justify-content: center; z-index: 3000; }
        .confirm-overlay.show { display: flex; }
        .confirm-box { background: #fff; border-radius: 14px; width: 280px; overflow: hidden; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .confirm-title { font-size: 17px; font-weight: 600; padding: 20px 16px 8px; color: var(--text-primary); }
        .confirm-body { font-size: 13px; color: var(--text-secondary); padding: 0 16px 20px; line-height: 1.5; }
        .confirm-actions { display: flex; border-top: 1px solid var(--border-color); }
        .confirm-btn { flex: 1; padding: 14px; font-size: 17px; border: none; background: none; cursor: pointer; color: #333333; font-weight: 400; }
        .confirm-btn:first-child { border-right: 1px solid var(--border-color); }
        .confirm-btn.danger { color: var(--danger-color); font-weight: 600; }
        .confirm-btn:hover { background: var(--bg-primary); }

        /* Onboarding Guide */
        .onboarding-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 3001; }
        .onboarding-overlay.show { display: flex; }
        .onboarding-box { background: #fff; border-radius: 16px; width: 340px; padding: 32px 28px; text-align: center; box-shadow: 0 25px 80px rgba(0,0,0,0.3); }
        .onboarding-steps { margin-bottom: 24px; }
        .onboarding-step { display: flex; align-items: center; gap: 14px; padding: 12px 0; text-align: left; }
        .step-number { width: 28px; height: 28px; border-radius: 50%; background: #333333; color: #fff; font-size: 14px; font-weight: 600; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .step-text { font-size: 14px; color: var(--text-primary); line-height: 1.4; }
        .onboarding-tip { font-size: 12px; color: var(--text-tertiary); margin-bottom: 24px; }
        .onboarding-actions { display: flex; gap: 10px; }
        .onboarding-btn { flex: 1; padding: 12px; border-radius: 10px; font-size: 15px; font-weight: 500; cursor: pointer; border: 1px solid var(--border-color); background: #fff; color: var(--text-primary); transition: all 0.15s; }
        .onboarding-btn:hover { border-color: #333333; color: #333333; }
        .onboarding-btn.primary { background: #111111; color: #fff; border-color: #111111; }
        .onboarding-btn.primary:hover { background: #333333; }

        /* 导出对话框样式 */
        .export-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3002;
        }
        .export-overlay.show { display: flex; }
        .export-box {
            background: #fff;
            border-radius: 16px;
            width: 420px;
            box-shadow: 0 25px 80px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .export-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .export-header h3 { font-size: 18px; font-weight: 600; }
        .export-close {
            width: 32px; height: 32px;
            border: none; background: none;
            font-size: 16px; color: var(--text-tertiary);
            cursor: pointer; border-radius: 8px;
        }
        .export-close:hover { background: var(--bg-primary); color: var(--text-primary); }
        .export-body { padding: 24px; }
        .export-field { margin-bottom: 16px; }
        .export-field label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }
        .export-field input {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 15px;
            transition: border-color 0.15s;
        }
        .export-field input:focus {
            outline: none;
            border-color: #111111;
        }
        .export-preview {
            background: var(--bg-primary);
            padding: 14px 16px;
            border-radius: 10px;
            margin-bottom: 16px;
        }
        .export-preview label {
            font-size: 12px;
            color: var(--text-tertiary);
            display: block;
            margin-bottom: 6px;
        }
        .export-filename {
            font-size: 14px;
            font-family: 'SF Mono', Monaco, monospace;
            color: var(--text-primary);
            word-break: break-all;
        }
        .export-options { margin-bottom: 8px; }
        .export-type-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }
        .export-radio {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 12px;
            margin-bottom: 8px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s;
        }
        .export-radio:hover {
            border-color: #999;
        }
        .export-radio:has(input:checked) {
            border-color: #111;
            background: #fafafa;
        }
        .export-radio input[type="radio"] {
            display: none;
        }
        .export-radio .radio-mark {
            width: 18px;
            height: 18px;
            border: 2px solid #ccc;
            border-radius: 50%;
            flex-shrink: 0;
            margin-top: 2px;
            position: relative;
        }
        .export-radio:has(input:checked) .radio-mark {
            border-color: #111;
        }
        .export-radio:has(input:checked) .radio-mark::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 8px;
            height: 8px;
            background: #111;
            border-radius: 50%;
        }
        .export-radio .radio-text {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        .export-radio .radio-text strong {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }
        .export-radio .radio-text small {
            font-size: 12px;
            color: var(--text-tertiary);
        }
        .export-actions {
            padding: 16px 24px 24px;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        .export-btn {
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.15s;
        }
        .export-btn.secondary {
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        .export-btn.secondary:hover { background: #EBEBEB; }
        .export-btn.primary {
            background: #111111;
            color: #fff;
        }
        .export-btn.primary:hover { background: #333333; }

        /* 导出成功提示样式 */
        .export-success-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3003;
        }
        .export-success-overlay.show { display: flex; }
        .export-success-box {
            background: #fff;
            border-radius: 16px;
            width: 400px;
            padding: 32px;
            text-align: center;
            box-shadow: 0 25px 80px rgba(0,0,0,0.3);
        }
        .export-success-icon {
            width: 64px; height: 64px;
            margin: 0 auto 16px;
            background: #E8F5E9;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: #34c759;
        }
        .export-success-box h3 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        .export-success-info {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            text-align: left;
        }
        .export-success-row {
            display: flex;
            align-items: center;
            padding: 8px 0;
        }
        .export-success-row:not(:last-child) {
            border-bottom: 1px solid var(--border-color);
        }
        .export-success-row .label {
            font-size: 13px;
            color: var(--text-tertiary);
            width: 70px;
            flex-shrink: 0;
        }
        .export-success-row .value {
            font-size: 14px;
            color: var(--text-primary);
            flex: 1;
            word-break: break-all;
            font-family: 'SF Mono', Monaco, monospace;
        }
        .copy-btn {
            width: 28px; height: 28px;
            border: none;
            background: #fff;
            border-radius: 6px;
            cursor: pointer;
            color: var(--text-tertiary);
            margin-left: 8px;
        }
        .copy-btn:hover { background: #EBEBEB; color: var(--text-primary); }
        .export-success-tip {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 24px;
            display: flex;
            align-items: flex-start;
            gap: 8px;
            text-align: left;
            background: #FFF9E6;
            padding: 12px 14px;
            border-radius: 10px;
        }
        .export-success-tip i { color: #F5A623; margin-top: 2px; }
        .export-success-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        [contenteditable]:focus { background: rgba(0,0,0,0.03); border-radius: 4px; outline: none; }

        /* Text component hover hint */
        .ios-large-title:hover::after,
        .ios-text-block:hover::after,
        .ios-card:hover::after,
        .ios-section-header:hover::after,
        .ios-list-item:hover::after,
        .ios-toggle-item:hover::after,
        .ios-option-item:hover::after,
        .ios-notice-bar:hover::after,
        .ios-avatar-block:hover::after {
            content: '双击编辑文字';
            position: absolute;
            bottom: 4px;
            right: 4px;
            background: rgba(0,0,0,0.75);
            color: #fff;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            pointer-events: none;
            z-index: 50;
        }
        .ios-button:hover::after,
        .ios-bottom-button:hover::after {
            content: '点击可设置动作';
            position: absolute;
            bottom: 4px;
            right: 4px;
            background: rgba(0,0,0,0.75);
            color: #fff;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            pointer-events: none;
            z-index: 50;
        }
        body.preview-mode .block:hover::after { content: none; }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }

        /* Editor Modal */
        .editor-modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
        }
        .editor-modal.show { opacity: 1; visibility: visible; }
        .editor-modal-content {
            background: #fff;
            border-radius: 12px;
            width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .editor-modal-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .editor-modal-header h3 { font-size: 17px; font-weight: 600; }
        .editor-modal-close {
            width: 28px; height: 28px;
            border-radius: 50%;
            border: none;
            background: var(--bg-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
        }
        .editor-modal-close:hover { background: var(--border-color); }
        .editor-modal-body { padding: 20px; }
        .editor-modal-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
        .editor-modal-btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border: none;
        }
        .editor-modal-btn.secondary { background: var(--bg-primary); color: var(--text-primary); }
        .editor-modal-btn.primary { background: #111111; color: #fff; }

        /* Position inputs */
        .position-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        .position-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .position-item label {
            font-size: 11px;
            color: var(--text-tertiary);
        }
        .position-item input {
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 13px;
            background: #fff;
            text-align: center;
        }

        /* New Component Styles */
        .ios-image-block {
            overflow: hidden;
        }
        .ios-badge {
            line-height: 1;
        }
        .ios-progress-bar {
            padding: 8px 0;
        }
        .ios-rating {
            padding: 8px;
        }
        .ios-tag {
            line-height: 1;
        }
        .ios-input-field input {
            border: 1px solid #E6E6E8;
            transition: border-color 0.15s, box-shadow 0.15s;
        }
        .ios-input-field input:focus {
            outline: none;
            border-color: #999999;
            box-shadow: 0 0 0 2px rgba(0,0,0,0.04);
        }
        .ios-notice-bar {
            overflow: hidden;
        }
        .ios-notice-bar span {
            white-space: pre-wrap;
        }
        .ios-steps {
            overflow-x: auto;
        }
        .ios-bottom-button {
            z-index: 90;
        }

        /* Style Template Modal */
        .template-modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
        }
        .template-modal.show { opacity: 1; visibility: visible; }
        .template-modal-content {
            background: #fff;
            border-radius: 12px;
            width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .template-modal-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .template-modal-header h3 { font-size: 17px; font-weight: 600; }
        .template-list {
            padding: 16px;
            max-height: 300px;
            overflow-y: auto;
        }
        .template-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: var(--bg-primary);
            border-radius: 8px;
            margin-bottom: 8px;
            gap: 12px;
        }
        .template-item:last-child { margin-bottom: 0; }
        .template-color-preview {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            flex-shrink: 0;
        }
        .template-info { flex: 1; }
        .template-name { font-size: 14px; font-weight: 600; color: var(--text-primary); }
        .template-meta { font-size: 12px; color: var(--text-secondary); margin-top: 2px; }
        .template-actions { display: flex; gap: 6px; }
        .template-action-btn {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            border: none;
            background: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: var(--text-secondary);
        }
        .template-action-btn:hover { background: var(--border-color); }
        .template-action-btn.delete:hover { background: var(--danger-color); color: #fff; }
        .template-form {
            padding: 16px;
            border-top: 1px solid var(--border-color);
        }
        .template-form-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }
        .template-form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }
        .template-form-row.full { grid-template-columns: 1fr; }
        .template-form-group { display: flex; flex-direction: column; gap: 4px; }
        .template-form-group label { font-size: 12px; color: var(--text-secondary); }
        .template-form-group input, .template-form-group select {
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 13px;
        }
        .template-form-group input[type="color"] {
            width: 100%;
            height: 36px;
            padding: 2px;
            cursor: pointer;
        }
        .template-form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 16px;
        }
        .empty-template {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-tertiary);
        }
        .empty-template i { font-size: 32px; margin-bottom: 12px; }
        .empty-template p { font-size: 14px; }

        /* 模板库容器 - 左右布局 */
        #templateSection {
            height: 100%;
        }
        .template-library {
            display: flex;
            height: 100%;
            background: #ffffff;
        }
        /* 左侧分类区 */
        .template-categories {
            width: 80px;
            flex-shrink: 0;
            background: #FAFAFA;
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 8px 0;
        }
        .template-category-item {
            position: relative;
            padding: 14px 12px;
            font-size: 12px;
            font-weight: 500;
            color: #666666;
            cursor: pointer;
            transition: all 0.15s;
            text-align: center;
            border-left: 2px solid transparent;
        }
        .template-category-item:hover {
            color: #333333;
            background: #F0F0F2;
        }
        .template-category-item.active {
            color: #111111;
            background: #ffffff;
            border-left-color: #333333;
            font-weight: 600;
        }
        /* 右侧模板展示区 */
        .template-content {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
            background: #ffffff;
        }
        .template-group {
            display: none;
        }
        .template-group.active {
            display: block;
        }
        .template-group-title {
            font-size: 11px;
            font-weight: 600;
            color: #999999;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            padding-left: 4px;
        }
        /* 双列卡片网格 */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        /* 模板卡片 */
        .template-card {
            background: #ffffff;
            border: 1px solid #E6E6E8;
            border-radius: 10px;
            padding: 14px 12px;
            cursor: pointer;
            transition: all 0.15s;
            user-select: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            min-height: 100px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
        }
        .template-card:hover {
            border-color: #CCCCCC;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transform: translateY(-1px);
        }
        .template-card:active {
            transform: scale(0.98) translateY(0);
        }
        .template-card-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #333333 0%, #111111 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            flex-shrink: 0;
        }
        .template-card-icon i {
            font-size: 15px;
            color: #ffffff;
        }
        .template-card-name {
            font-size: 12px;
            font-weight: 600;
            color: #111111;
            margin-bottom: 4px;
            line-height: 1.3;
        }
        .template-card-desc {
            font-size: 10px;
            color: #888888;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <aside class="toolbar">
        <!-- 固定区（Pinned Header） -->
        <div class="toolbar-pinned" id="toolbarPinned">
            <div class="toolbar-pinned-title">选择模式</div>
            <div class="mode-cards">
                <div class="mode-card active" data-mode="template" id="modeTemplate">
                    <div class="mode-card-icon"><i class="fas fa-layer-group"></i></div>
                    <div class="mode-card-title">通用模板</div>
                    <div class="mode-card-desc">快速套用页面</div>
                </div>
                <div class="mode-card" data-mode="free" id="modeFree">
                    <div class="mode-card-icon"><i class="fas fa-cubes"></i></div>
                    <div class="mode-card-title">自由设计</div>
                    <div class="mode-card-desc">逐个拖入组件</div>
                </div>
            </div>
        </div>

        <!-- 滚动区 -->
        <div class="toolbar-scrollable template-mode" id="toolbarScrollable">
            <div id="templateSection">
                <div class="template-library">
                    <!-- 左侧分类区 -->
                    <div class="template-categories">
                        <div class="template-category-item active" data-category="basic">基础结构</div>
                        <div class="template-category-item" data-category="function">功能场景</div>
                        <div class="template-category-item" data-category="industry">行业应用</div>
                        <div class="template-category-item" data-category="content">内容类型</div>
                        <div class="template-category-item" data-category="combo">组件组合</div>
                    </div>
                    <!-- 右侧模板展示区 -->
                    <div class="template-content">
                        <!-- 基础结构 -->
                        <div class="template-group active" data-category="basic">
                            <div class="template-group-title">基础结构</div>
                            <div class="template-grid">
                                <div class="template-card" data-template="step-form">
                                    <div class="template-card-icon"><i class="fas fa-list-ol"></i></div>
                                    <div class="template-card-name">多步表单页</div>
                                    <div class="template-card-desc">步骤指示器 + 表单分组</div>
                                </div>
                                <div class="template-card" data-template="create-page">
                                    <div class="template-card-icon"><i class="fas fa-plus-circle"></i></div>
                                    <div class="template-card-name">创建发布页</div>
                                    <div class="template-card-desc">主操作按钮 + 功能入口</div>
                                </div>
                                <div class="template-card" data-template="search-list">
                                    <div class="template-card-icon"><i class="fas fa-search"></i></div>
                                    <div class="template-card-name">搜索结果页</div>
                                    <div class="template-card-desc">搜索框 + 筛选 + 结果列表</div>
                                </div>
                                <div class="template-card" data-template="navigation-page">
                                    <div class="template-card-icon"><i class="fas fa-compass"></i></div>
                                    <div class="template-card-name">导航工具页</div>
                                    <div class="template-card-desc">分类列表 + 快速跳转</div>
                                </div>
                            </div>
                        </div>
                        <!-- 功能场景 -->
                        <div class="template-group" data-category="function">
                            <div class="template-group-title">功能场景</div>
                            <div class="template-grid">
                                <div class="template-card" data-template="chat-list">
                                    <div class="template-card-icon"><i class="fas fa-comments"></i></div>
                                    <div class="template-card-name">会话列表页</div>
                                    <div class="template-card-desc">头像 + 消息摘要 + 时间</div>
                                </div>
                                <div class="template-card" data-template="chat-dialog">
                                    <div class="template-card-icon"><i class="fas fa-comment-dots"></i></div>
                                    <div class="template-card-name">聊天对话页</div>
                                    <div class="template-card-desc">消息气泡 + 底部输入栏</div>
                                </div>
                                <div class="template-card" data-template="icon-hub">
                                    <div class="template-card-icon"><i class="fas fa-th-large"></i></div>
                                    <div class="template-card-name">功能入口页</div>
                                    <div class="template-card-desc">功能图标入口 + 推荐区</div>
                                </div>
                                <div class="template-card" data-template="utility-home">
                                    <div class="template-card-icon"><i class="fas fa-wrench"></i></div>
                                    <div class="template-card-name">工具应用首页</div>
                                    <div class="template-card-desc">功能卡片 + 最近使用</div>
                                </div>
                            </div>
                        </div>
                        <!-- 行业应用 -->
                        <div class="template-group" data-category="industry">
                            <div class="template-group-title">行业应用</div>
                            <div class="template-grid">
                                <div class="template-card" data-template="shop-home">
                                    <div class="template-card-icon"><i class="fas fa-shopping-bag"></i></div>
                                    <div class="template-card-name">商城首页</div>
                                    <div class="template-card-desc">Banner + 分类 + 商品推荐</div>
                                </div>
                                <div class="template-card" data-template="finance-home">
                                    <div class="template-card-icon"><i class="fas fa-chart-line"></i></div>
                                    <div class="template-card-name">财务应用首页</div>
                                    <div class="template-card-desc">资产概览 + 收支图表</div>
                                </div>
                                <div class="template-card" data-template="health-home">
                                    <div class="template-card-icon"><i class="fas fa-heartbeat"></i></div>
                                    <div class="template-card-name">健康应用首页</div>
                                    <div class="template-card-desc">今日数据 + 运动目标</div>
                                </div>
                                <div class="template-card" data-template="education-home">
                                    <div class="template-card-icon"><i class="fas fa-graduation-cap"></i></div>
                                    <div class="template-card-name">教育课程首页</div>
                                    <div class="template-card-desc">课程推荐 + 学习进度</div>
                                </div>
                                <div class="template-card" data-template="travel-home">
                                    <div class="template-card-icon"><i class="fas fa-plane"></i></div>
                                    <div class="template-card-name">旅游目的地页</div>
                                    <div class="template-card-desc">目的地推荐 + 旅行攻略</div>
                                </div>
                                <div class="template-card" data-template="food-home">
                                    <div class="template-card-icon"><i class="fas fa-utensils"></i></div>
                                    <div class="template-card-name">美食推荐页</div>
                                    <div class="template-card-desc">美食推荐 + 分类筛选</div>
                                </div>
                                <div class="template-card" data-template="developer-page">
                                    <div class="template-card-icon"><i class="fas fa-code"></i></div>
                                    <div class="template-card-name">开发工具页</div>
                                    <div class="template-card-desc">API列表 + 文档入口</div>
                                </div>
                                <div class="template-card" data-template="dashboard-page">
                                    <div class="template-card-icon"><i class="fas fa-tachometer-alt"></i></div>
                                    <div class="template-card-name">商务仪表盘</div>
                                    <div class="template-card-desc">数据卡片 + 图表展示</div>
                                </div>
                            </div>
                        </div>
                        <!-- 内容类型 -->
                        <div class="template-group" data-category="content">
                            <div class="template-group-title">内容类型</div>
                            <div class="template-grid">
                                <div class="template-card" data-template="feed-home">
                                    <div class="template-card-icon"><i class="fas fa-stream"></i></div>
                                    <div class="template-card-name">信息流首页</div>
                                    <div class="template-card-desc">信息流卡片 + 底部导航</div>
                                </div>
                                <div class="template-card" data-template="news-home">
                                    <div class="template-card-icon"><i class="fas fa-newspaper"></i></div>
                                    <div class="template-card-name">报刊杂志首页</div>
                                    <div class="template-card-desc">头条 + 分类频道</div>
                                </div>
                                <div class="template-card" data-template="social-home">
                                    <div class="template-card-icon"><i class="fas fa-users"></i></div>
                                    <div class="template-card-name">社交动态页</div>
                                    <div class="template-card-desc">好友动态 + 互动消息</div>
                                </div>
                                <div class="template-card" data-template="photo-gallery">
                                    <div class="template-card-icon"><i class="fas fa-images"></i></div>
                                    <div class="template-card-name">作品展示页</div>
                                    <div class="template-card-desc">作品展示 + 相册分类</div>
                                </div>
                                <div class="template-card" data-template="reference-page">
                                    <div class="template-card-icon"><i class="fas fa-book"></i></div>
                                    <div class="template-card-name">参考资料页</div>
                                    <div class="template-card-desc">目录导航 + 详情内容</div>
                                </div>
                            </div>
                        </div>
                        <!-- 组件组合 -->
                        <div class="template-group" data-category="combo">
                            <div class="template-group-title">组件组合</div>
                            <div class="template-grid">
                                <div class="template-card" data-template="card-hub">
                                    <div class="template-card-icon"><i class="fas fa-grip"></i></div>
                                    <div class="template-card-name">功能卡片首页</div>
                                    <div class="template-card-desc">大功能卡片 + 分类标签</div>
                                </div>
                                <div class="template-card" data-template="grid-cards">
                                    <div class="template-card-icon"><i class="fas fa-th"></i></div>
                                    <div class="template-card-name">双列卡片页</div>
                                    <div class="template-card-desc">分类Tab + 双列网格</div>
                                </div>
                                <div class="template-card" data-template="recommend-page">
                                    <div class="template-card-icon"><i class="fas fa-star"></i></div>
                                    <div class="template-card-name">推荐聚合页</div>
                                    <div class="template-card-desc">Banner + 分类 + 推荐卡片</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        <div id="freeDesignSection" style="display:none;">
            <h3 class="toolbar-title">新手常用</h3>
        <div class="component-grid">
            <div class="component-item" data-type="large-title" data-tip="双击编辑文字"><i class="fas fa-heading"></i><span>页面标题</span></div>
            <div class="component-item" data-type="text-block" data-tip="双击编辑文字"><i class="fas fa-align-left"></i><span>正文文本</span></div>
            <div class="component-item" data-type="button" data-tip="点击可设置动作（跳转/弹窗/提交）"><i class="fas fa-hand-pointer"></i><span>按钮</span></div>
            <div class="component-item" data-type="card" data-tip="双击编辑文字"><i class="fas fa-square"></i><span>信息卡片</span></div>
        </div>

        <h3 class="toolbar-title">基础组件</h3>
        <div class="component-grid">
            <div class="component-item" data-type="navbar" data-tip="双击编辑文字"><i class="fas fa-window-maximize"></i><span>顶部导航</span></div>
            <div class="component-item" data-type="section-header" data-tip="双击编辑文字"><i class="fas fa-layer-group"></i><span>小标题</span></div>
            <div class="component-item" data-type="avatar-block" data-tip="双击编辑文字"><i class="fas fa-user-circle"></i><span>头像</span></div>
            <div class="component-item" data-type="icon" data-tip="点击选中后在右侧更换图标"><i class="fas fa-icons"></i><span>图标</span></div>
            <div class="component-item" data-type="image-block" data-tip="点击选中后在右侧设置图片"><i class="fas fa-image"></i><span>图片</span></div>
        </div>

        <h3 class="toolbar-title">表单输入</h3>
        <div class="component-grid">
            <div class="component-item" data-type="input-field" data-tip="点击聚焦时描边加深"><i class="fas fa-keyboard"></i><span>输入框</span></div>
            <div class="component-item" data-type="search" data-tip="点击聚焦时描边加深"><i class="fas fa-search"></i><span>搜索</span></div>
            <div class="component-item" data-type="toggle-item" data-tip="双击编辑文字"><i class="fas fa-toggle-on"></i><span>开关</span></div>
            <div class="component-item" data-type="option-item" data-tip="双击编辑文字"><i class="fas fa-check-circle"></i><span>单选 / 多选</span></div>
            <div class="component-item" data-type="number-picker" data-tip="双击编辑文字"><i class="fas fa-sort"></i><span>数字选择</span></div>
        </div>

        <h3 class="toolbar-title">列表与卡片</h3>
        <div class="component-grid">
            <div class="component-item" data-type="list-item" data-tip="双击编辑文字"><i class="fas fa-list"></i><span>列表</span></div>
            <div class="component-item" data-type="tabbar" data-tip="点击切换选中项"><i class="fas fa-ellipsis-h"></i><span>底部导航</span></div>
            <div class="component-item" data-type="bottom-button" data-tip="点击可设置动作（跳转/弹窗/提交）"><i class="fas fa-shopping-cart"></i><span>底部按钮</span></div>
            <div class="component-item" data-type="steps" data-tip="双击编辑文字"><i class="fas fa-shoe-prints"></i><span>步骤条</span></div>
        </div>

        <h3 class="toolbar-title">反馈与状态</h3>
        <div class="component-grid">
            <div class="component-item" data-type="badge" data-tip="双击编辑文字"><i class="fas fa-certificate"></i><span>徽章</span></div>
            <div class="component-item" data-type="tag" data-tip="双击编辑文字"><i class="fas fa-tag"></i><span>标签</span></div>
            <div class="component-item" data-type="progress-bar" data-tip="点击选中后在右侧调整进度"><i class="fas fa-tasks"></i><span>进度条</span></div>
            <div class="component-item" data-type="rating" data-tip="点击星星可更改评分"><i class="fas fa-star"></i><span>评分</span></div>
            <div class="component-item" data-type="notice-bar" data-tip="双击编辑文字"><i class="fas fa-bullhorn"></i><span>通知栏</span></div>
        </div>

        <h3 class="toolbar-title">布局与辅助</h3>
        <div class="component-grid">
            <div class="component-item" data-type="divider" data-tip="内容分隔线"><i class="fas fa-minus"></i><span>分割线</span></div>
            <div class="component-item" data-type="spacer" data-tip="快速拉开上下间距"><i class="fas fa-arrows-alt-v"></i><span>留白</span></div>
        </div>

        <h3 class="toolbar-title">交互预览</h3>
        <div class="component-grid">
            <div class="component-item" id="showModalBtn" data-tip="预览弹窗效果"><i class="fas fa-window-restore"></i><span>弹窗预览</span></div>
            <div class="component-item" id="showToastBtn" data-tip="预览轻提示效果"><i class="fas fa-comment-dots"></i><span>Toast 预览</span></div>
        </div>

            <h3 class="toolbar-title">交互配置</h3>
            <div class="component-grid">
                <div class="component-item" id="editModalBtn" data-tip="自定义弹窗内容"><i class="fas fa-edit"></i><span>弹窗配置</span></div>
                <div class="component-item" id="editToastBtn" data-tip="自定义提示内容"><i class="fas fa-pen"></i><span>Toast 配置</span></div>
            </div>
            </div><!-- end freeDesignSection -->
        </div><!-- end toolbar-scrollable -->
    </aside>
    <!-- 全局Tooltip容器 -->
    <div class="global-tooltip" id="globalTooltip"></div>

    <main class="canvas-area">
        <div class="phone-frame">
            <div class="phone-notch"></div>
            <div class="phone-screen">
                <div class="canvas-content free-layout" id="canvas">
                    <div class="empty-canvas" id="emptyState">
                        <i class="fas fa-plus-circle"></i>
                        <p class="empty-title">从左侧拖入组件开始设计</p>
                        <p class="empty-subtitle">或选择现成页面模板快速开始<br>放心操作，随时可撤销恢复</p>
                        <div class="empty-actions">
                            <button class="empty-btn primary" onclick="window.addPageTemplate('feed-home')">使用模板</button>
                            <button class="empty-btn" onclick="window.addQuickComponent('large-title')">添加组件</button>
                        </div>
                        <p class="empty-note">更多模板请查看左侧「通用模板」</p>
                    </div>
                </div>
            </div>
            <div class="phone-home-indicator"></div>
        </div>
        <!-- 独立的操作按钮覆盖层，不参与画布缩放 -->
        <div id="blockActionsOverlay"></div>
    </main>

    <aside class="properties-panel">
        <div class="panel-tabs">
            <div class="panel-tab active" data-tab="props">内容</div>
            <div class="panel-tab" data-tab="style">样式</div>
            <div class="panel-tab" data-tab="global">页面</div>
        </div>
        <div class="panel-content active" id="propsPanel">
            <div class="no-selection" id="noSelection">
                <i class="fas fa-mouse-pointer"></i>
                <p class="no-sel-title">点击组件开始编辑</p>
                <p class="no-sel-desc">选中画布中的组件后<br>可在这里修改内容与样式</p>
                <p class="no-sel-hint">按住 Shift 可多选 · 拖拽可移动位置</p>
            </div>
            <div id="propsEditor"></div>
        </div>
        <div class="panel-content" id="stylePanel">
            <div class="no-selection" id="noStyleSelection">
                <i class="fas fa-palette"></i>
                <p class="no-sel-title">点击组件调整样式</p>
                <p class="no-sel-desc">选中组件后<br>可调整颜色、字号、间距等外观</p>
            </div>
            <div id="styleEditor"></div>
        </div>
        <div class="panel-content" id="globalPanel">
            <div class="panel-section">
                <h3 class="panel-section-title">背景</h3>
                <div class="property-row">
                    <div class="color-row">
                        <input type="color" class="color-picker" id="pageBgColor" value="#ffffff">
                        <input type="text" class="property-input" id="pageBgHex" value="#ffffff" style="flex:1">
                    </div>
                </div>
            </div>
            <div class="panel-section">
                <h3 class="panel-section-title">主色调</h3>
                <div class="color-row">
                    <input type="color" class="color-picker" id="accentColorPicker" value="#111111">
                    <input type="text" class="property-input" id="accentColorHex" value="#111111" style="flex:1">
                </div>
                <div class="color-presets">
                    <div class="color-preset" style="background:#111111" data-color="#111111"></div>
                    <div class="color-preset" style="background:#333333" data-color="#333333"></div>
                    <div class="color-preset" style="background:#666666" data-color="#666666"></div>
                    <div class="color-preset" style="background:#007aff" data-color="#007aff"></div>
                    <div class="color-preset" style="background:#34c759" data-color="#34c759"></div>
                    <div class="color-preset" style="background:#ff3b30" data-color="#ff3b30"></div>
                </div>
            </div>
            <div class="panel-section">
                <h3 class="panel-section-title">间距</h3>
                <div class="slider-row">
                    <input type="range" class="property-slider" id="globalSpacing" min="0" max="24" value="0">
                    <span class="slider-value" id="spacingValue">0px</span>
                </div>
            </div>
        </div>
    </aside>

    <button class="preview-btn" id="previewBtn"><i class="fas fa-play"></i><span>预览</span></button>

    <!-- Top Toolbar -->
    <div class="top-toolbar">
        <div class="toolbar-group">
            <button class="toolbar-btn" id="undoBtn" disabled><i class="fas fa-undo"></i><span class="btn-tooltip"><span class="tip-cn">撤销</span><span class="tip-en">Undo</span></span></button>
            <button class="toolbar-btn" id="redoBtn" disabled><i class="fas fa-redo"></i><span class="btn-tooltip"><span class="tip-cn">重做</span><span class="tip-en">Redo</span></span></button>
            <div class="toolbar-divider"></div>
            <button class="toolbar-btn" id="saveBtn"><i class="fas fa-save"></i><span class="btn-tooltip"><span class="tip-cn">保存</span><span class="tip-en">Save</span></span></button>
            <button class="toolbar-btn" id="exportBtn"><i class="fas fa-file-export"></i><span class="btn-tooltip"><span class="tip-cn">导出</span><span class="tip-en">Export</span></span></button>
            <div class="toolbar-divider"></div>
            <button class="toolbar-btn" id="clearAllBtn"><i class="fas fa-trash-alt"></i><span class="btn-tooltip"><span class="tip-cn">清空</span><span class="tip-en">Clear</span></span></button>
        </div>
    </div>

    <!-- Phone Scale Controls -->
    <div class="phone-scale-controls">
        <span class="scale-label">画布</span>
        <button class="scale-btn" id="scaleDown"><i class="fas fa-minus"></i></button>
        <input type="range" class="scale-slider" id="phoneScale" min="50" max="150" value="100">
        <button class="scale-btn" id="scaleUp"><i class="fas fa-plus"></i></button>
        <span class="scale-value" id="scaleValue">100%</span>
    </div>

    <!-- iOS Modal Preview -->
    <div class="modal-overlay" id="iosModal">
        <div class="modal-box">
            <div class="modal-header"><div class="modal-title" id="modalTitle">提示</div></div>
            <div class="modal-body" id="modalBody">弹窗内容</div>
            <div class="modal-actions">
                <button class="modal-btn" id="modalCancelBtn">取消</button>
                <button class="modal-btn primary" id="modalConfirmBtn">确定</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- Confirm Dialog -->
    <div class="confirm-overlay" id="confirmDialog">
        <div class="confirm-box">
            <div class="confirm-title" id="confirmTitle">确认操作</div>
            <div class="confirm-body" id="confirmBody">确定要执行此操作吗？</div>
            <div class="confirm-actions">
                <button class="confirm-btn" id="confirmCancelBtn">取消</button>
                <button class="confirm-btn danger" id="confirmOkBtn">确定</button>
            </div>
        </div>
    </div>

    <!-- Onboarding Guide -->
    <div class="onboarding-overlay" id="onboardingGuide">
        <div class="onboarding-box">
            <div class="onboarding-steps">
                <div class="onboarding-step">
                    <div class="step-number">1</div>
                    <div class="step-text">从左侧拖入组件到手机画布</div>
                </div>
                <div class="onboarding-step">
                    <div class="step-number">2</div>
                    <div class="step-text">点击组件，在右侧面板修改内容与样式</div>
                </div>
                <div class="onboarding-step">
                    <div class="step-number">3</div>
                    <div class="step-text">点击底部"预览"按钮查看效果</div>
                </div>
            </div>
            <p class="onboarding-tip">所有操作可撤销，放心尝试</p>
            <div class="onboarding-actions">
                <button class="onboarding-btn primary" id="startUsingBtn">开始使用</button>
                <button class="onboarding-btn" id="skipGuideBtn">跳过</button>
            </div>
        </div>
    </div>

    <!-- 导出对话框 -->
    <div class="export-overlay" id="exportDialog">
        <div class="export-box">
            <div class="export-header">
                <h3>导出 HTML</h3>
                <button class="export-close" id="exportCloseBtn"><i class="fas fa-times"></i></button>
            </div>
            <div class="export-body">
                <div class="export-field">
                    <label>项目名称</label>
                    <input type="text" id="exportProjectName" placeholder="my-project">
                </div>
                <div class="export-field">
                    <label>页面名称</label>
                    <input type="text" id="exportPageName" placeholder="首页">
                </div>
                <div class="export-preview">
                    <label>文件名预览</label>
                    <div class="export-filename" id="exportFilenamePreview">my-project-首页-20260210-2153.html</div>
                </div>
                <div class="export-options">
                    <div class="export-type-label">导出类型</div>
                    <label class="export-radio">
                        <input type="radio" name="exportType" value="standard" id="exportTypeStandard" checked>
                        <span class="radio-mark"></span>
                        <span class="radio-text">
                            <strong>标准运行版</strong>
                            <small>纯 UI 代码，用于交付上线</small>
                        </span>
                    </label>
                    <label class="export-radio">
                        <input type="radio" name="exportType" value="inspect" id="exportTypeInspect">
                        <span class="radio-mark"></span>
                        <span class="radio-text">
                            <strong>开发标注版</strong>
                            <small>含 Inspect 标注层，用于开发交接</small>
                        </span>
                    </label>
                </div>
            </div>
            <div class="export-actions">
                <button class="export-btn secondary" id="exportCancelBtn">取消</button>
                <button class="export-btn primary" id="exportConfirmBtn"><i class="fas fa-download"></i> 导出文件</button>
            </div>
        </div>
    </div>

    <!-- 导出成功提示 -->
    <div class="export-success-overlay" id="exportSuccessDialog">
        <div class="export-success-box">
            <div class="export-success-icon"><i class="fas fa-check-circle"></i></div>
            <h3>导出成功</h3>
            <div class="export-success-info">
                <div class="export-success-row">
                    <span class="label">文件名</span>
                    <span class="value" id="exportedFilename">-</span>
                    <button class="copy-btn" id="copyFilenameBtn" title="复制文件名"><i class="fas fa-copy"></i></button>
                </div>
                <div class="export-success-row">
                    <span class="label">保存位置</span>
                    <span class="value">下载 (Downloads) 文件夹</span>
                </div>
            </div>
            <p class="export-success-tip">
                <i class="fas fa-lightbulb"></i>
                可在 Finder 的「下载」中找到，或用 Spotlight (⌘+空格) 搜索文件名
            </p>
            <div class="export-success-actions">
                <button class="export-btn secondary" id="redownloadBtn"><i class="fas fa-redo"></i> 再次下载</button>
                <button class="export-btn primary" id="exportSuccessCloseBtn">完成</button>
            </div>
        </div>
    </div>

    <!-- 开发标注浮层（不参与导出） -->
    <div class="dev-annotation-overlay" id="devAnnotation">
        <div class="dev-annotation-title" id="devAnnotationTitle">组件信息</div>
        <div id="devAnnotationContent"></div>
    </div>

    <!-- Editor Modal for Modal -->
    <div class="editor-modal" id="modalEditor">
        <div class="editor-modal-content">
            <div class="editor-modal-header">
                <h3>弹窗配置</h3>
                <button class="editor-modal-close" onclick="closeEditorModal('modalEditor')"><i class="fas fa-times"></i></button>
            </div>
            <div class="editor-modal-body">
                <div class="property-row">
                    <label class="property-label">标题</label>
                    <input type="text" class="property-input" id="modalTitleInput" value="提示">
                </div>
                <div class="property-row">
                    <label class="property-label">内容</label>
                    <textarea class="property-input property-textarea" id="modalBodyInput">弹窗内容</textarea>
                </div>
                <div class="property-row">
                    <label class="property-label">取消按钮</label>
                    <input type="text" class="property-input" id="modalCancelInput" value="取消">
                </div>
                <div class="property-row">
                    <label class="property-label">确认按钮</label>
                    <input type="text" class="property-input" id="modalConfirmInput" value="确定">
                </div>
            </div>
            <div class="editor-modal-footer">
                <button class="editor-modal-btn secondary" onclick="closeEditorModal('modalEditor')">关闭</button>
                <button class="editor-modal-btn primary" onclick="saveModalSettings()">应用</button>
            </div>
        </div>
    </div>

    <!-- Editor Modal for Toast -->
    <div class="editor-modal" id="toastEditor">
        <div class="editor-modal-content">
            <div class="editor-modal-header">
                <h3>Toast 配置</h3>
                <button class="editor-modal-close" onclick="closeEditorModal('toastEditor')"><i class="fas fa-times"></i></button>
            </div>
            <div class="editor-modal-body">
                <div class="property-row">
                    <label class="property-label">提示文字</label>
                    <input type="text" class="property-input" id="toastTextInput" value="操作成功">
                </div>
                <div class="property-row">
                    <label class="property-label">显示时长</label>
                    <div class="slider-row">
                        <input type="range" class="property-slider" id="toastDurationInput" min="1" max="5" value="2">
                        <span class="slider-value" id="toastDurationValue">2s</span>
                    </div>
                </div>
            </div>
            <div class="editor-modal-footer">
                <button class="editor-modal-btn secondary" onclick="closeEditorModal('toastEditor')">关闭</button>
                <button class="editor-modal-btn primary" onclick="saveToastSettings()">应用</button>
            </div>
        </div>
    </div>

    <!-- Color Template Modal -->
    <div class="template-modal" id="colorTemplateModal">
        <div class="template-modal-content">
            <div class="template-modal-header">
                <h3>颜色预设</h3>
                <button class="editor-modal-close" onclick="closeTemplateModal('colorTemplateModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="template-list" id="colorTemplateList">
                <div class="empty-template">
                    <i class="fas fa-palette"></i>
                    <p>暂无预设颜色</p>
                </div>
            </div>
            <div class="template-form">
                <div class="template-form-title">新建颜色</div>
                <div class="template-form-row">
                    <div class="template-form-group">
                        <label>名称</label>
                        <input type="text" id="colorName" placeholder="主色调">
                    </div>
                    <div class="template-form-group">
                        <label>色值</label>
                        <input type="color" id="colorValue" value="#111111">
                    </div>
                </div>
                <div class="template-form-row full">
                    <div class="template-form-group">
                        <label>用途</label>
                        <input type="text" id="colorUsage" placeholder="按钮、链接等强调元素">
                    </div>
                </div>
                <div class="template-form-actions">
                    <button class="editor-modal-btn primary" onclick="addColorTemplate()"><i class="fas fa-plus"></i> 添加</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Font Template Modal -->
    <div class="template-modal" id="fontTemplateModal">
        <div class="template-modal-content">
            <div class="template-modal-header">
                <h3>字体预设</h3>
                <button class="editor-modal-close" onclick="closeTemplateModal('fontTemplateModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="template-list" id="fontTemplateList">
                <div class="empty-template">
                    <i class="fas fa-font"></i>
                    <p>暂无预设字体</p>
                </div>
            </div>
            <div class="template-form">
                <div class="template-form-title">新建字体样式</div>
                <div class="template-form-row">
                    <div class="template-form-group">
                        <label>名称</label>
                        <input type="text" id="fontName" placeholder="标题文字">
                    </div>
                    <div class="template-form-group">
                        <label>字号</label>
                        <input type="number" id="fontSize" value="17" min="10" max="72">
                    </div>
                </div>
                <div class="template-form-row">
                    <div class="template-form-group">
                        <label>字重</label>
                        <select id="fontWeight">
                            <option value="300">Light (300)</option>
                            <option value="400" selected>Regular (400)</option>
                            <option value="500">Medium (500)</option>
                            <option value="600">Semibold (600)</option>
                            <option value="700">Bold (700)</option>
                        </select>
                    </div>
                    <div class="template-form-group">
                        <label>颜色</label>
                        <input type="color" id="fontColor" value="#1d1d1f">
                    </div>
                </div>
                <div class="template-form-row full">
                    <div class="template-form-group">
                        <label>用途</label>
                        <input type="text" id="fontUsage" placeholder="页面主标题">
                    </div>
                </div>
                <div class="template-form-actions">
                    <button class="editor-modal-btn primary" onclick="addFontTemplate()"><i class="fas fa-plus"></i> 添加</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Apply Template Modal -->
    <div class="template-modal" id="applyTemplateModal">
        <div class="template-modal-content">
            <div class="template-modal-header">
                <h3>应用预设</h3>
                <button class="editor-modal-close" onclick="closeTemplateModal('applyTemplateModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="template-form" style="border-top:none;">
                <div class="template-form-title">选择颜色</div>
                <div id="applyColorList" style="margin-bottom:20px;"></div>

                <div class="template-form-title">选择字体</div>
                <div id="applyFontList" style="margin-bottom:20px;"></div>

                <div class="template-form-title">范围</div>
                <div class="template-form-row">
                    <div class="template-form-group">
                        <label>
                            <input type="checkbox" id="applyToSelected" checked> 仅选中组件
                        </label>
                    </div>
                    <div class="template-form-group">
                        <label>
                            <input type="checkbox" id="applyToAll"> 全部组件
                        </label>
                    </div>
                </div>
                <div class="template-form-actions">
                    <button class="editor-modal-btn secondary" onclick="closeTemplateModal('applyTemplateModal')">关闭</button>
                    <button class="editor-modal-btn primary" onclick="applyStyleTemplate()"><i class="fas fa-check"></i> 应用</button>
                </div>
            </div>
        </div>
    </div>

<script>
(function() {
    var blocks = [];
    var selectedIds = new Set();
    var idCounter = 0;
    var globalStyle = { bgColor: '#ffffff', spacing: 0, accent: '#111111' };
    var draggedBlock = null;
    var modalSettings = { title: '提示', body: '弹窗内容', cancel: '取消', confirm: '确定' };
    var toastSettings = { text: '操作成功', duration: 2 };
    var layoutMode = 'free'; // 'flow' or 'free'
    var phoneScale = 100; // Phone scale percentage

    // Free drag state
    var isDragging = false;
    var isDragPending = false; // 等待超过阈值才开始拖拽
    var dragStartX = 0;
    var dragStartY = 0;
    var dragBlockStartX = 0;
    var dragBlockStartY = 0;
    var currentDragBlock = null;
    var currentDragElement = null;
    var dragThreshold = 4; // 拖拽启动阈值（px）

    // 统一的拖拽启动函数
    function initDrag(blockId, e) {
        if (layoutMode !== 'free') return false;
        var block = findBlock(blockId);
        var el = document.querySelector('.block[data-id="' + blockId + '"]');
        if (!block || !el) return false;
        if (block.type === 'tabbar') return false;

        // 记录起始状态，等待超过阈值后才真正开始拖拽
        isDragPending = true;
        currentDragBlock = block;
        currentDragElement = el;
        dragStartX = e.clientX;
        dragStartY = e.clientY;
        dragBlockStartX = block.style.x || 0;
        dragBlockStartY = block.style.y || 0;

        // 禁止文本选择
        document.body.style.userSelect = 'none';
        document.body.style.webkitUserSelect = 'none';

        // 禁用画布滚动
        var phoneScreen = document.querySelector('.phone-screen');
        if (phoneScreen) phoneScreen.style.overflow = 'hidden';

        return true;
    }

    // 激活拖拽状态（超过阈值后调用）
    function activateDrag() {
        if (!isDragPending || !currentDragElement) return;
        isDragging = true;
        isDragPending = false;
        currentDragElement.classList.add('free-dragging');
        // 显示移动光标
        document.body.style.cursor = 'grabbing';
    }

    // 结束拖拽
    function endDrag() {
        if (currentDragElement) {
            currentDragElement.classList.remove('free-dragging');
        }
        // 恢复文本选择
        document.body.style.userSelect = '';
        document.body.style.webkitUserSelect = '';
        document.body.style.cursor = '';

        // 恢复画布滚动
        var phoneScreen = document.querySelector('.phone-screen');
        if (phoneScreen) phoneScreen.style.overflow = '';

        if (isDragging && currentDragBlock) {
            // 调试：记录拖拽结束时的位置
            console.log('[拖拽结束] id=' + currentDragBlock.id +
                        ' type=' + currentDragBlock.type +
                        ' 新位置: x=' + (currentDragBlock.style.x || 0).toFixed(1) + '% y=' + (currentDragBlock.style.y || 0).toFixed(1) + '%');

            // 验证 blocks 数组中对应的 block 也被更新了
            var verifyBlock = findBlock(currentDragBlock.id);
            if (verifyBlock) {
                console.log('[验证] blocks数组中: x=' + (verifyBlock.style.x || 0).toFixed(1) + '% y=' + (verifyBlock.style.y || 0).toFixed(1) + '%');
            }

            clearAlignGuides();
            clearDistanceBubbles();
            saveHistory();
            render();
            selectBlock(currentDragBlock.id, false);
            updateEditors();
        }

        isDragging = false;
        isDragPending = false;
        currentDragBlock = null;
        currentDragElement = null;
    }

    // Toolbar drag state
    var isToolbarDragging = false;
    var toolbarDragType = null;
    var dragGhost = null;
    var toolbarDragStartX = 0;
    var toolbarDragStartY = 0;

    // Alignment settings
    var alignSnapThreshold = 2; // Snap when within 2% (~8px on 390px canvas)
    var alignGuides = []; // Current alignment guides
    var distanceBubbles = []; // Distance bubbles

    // Get estimated block height as percentage of canvas
    function getBlockHeight(block) {
        var canvasHeight = 844; // Base canvas height in px
        var heightPx = 44; // Default height
        switch (block.type) {
            case 'heading': heightPx = 28; break;
            case 'text': heightPx = 22; break;
            case 'button': heightPx = 44; break;
            case 'search': heightPx = 40; break;
            case 'input': heightPx = 48; break;
            case 'card': heightPx = 80; break;
            case 'list-item': heightPx = 56; break;
            case 'avatar': heightPx = parseInt(block.style.avatarSize) || 48; break;
            case 'divider': heightPx = 1; break;
            case 'icon': heightPx = parseInt(block.style.iconSize) || 24; break;
            case 'image': heightPx = 180; break;
            case 'checkbox': heightPx = 24; break;
            case 'toggle': heightPx = 31; break;
            case 'badge': heightPx = 22; break;
            case 'progress': heightPx = 6; break;
            case 'tabbar': heightPx = 83; break;
            default: heightPx = 44;
        }
        return heightPx / canvasHeight * 100;
    }

    // Undo/Redo history
    var history = [];
    var historyIndex = -1;
    var maxHistory = 50;

    // Style templates
    var colorTemplates = JSON.parse(localStorage.getItem('colorTemplates') || '[]');
    var fontTemplates = JSON.parse(localStorage.getItem('fontTemplates') || '[]');

    // Confirm dialog callback
    var confirmCallback = null;

    // Show confirm dialog
    function showConfirmDialog(title, body, okText, callback) {
        var dialog = document.getElementById('confirmDialog');
        document.getElementById('confirmTitle').textContent = title;
        document.getElementById('confirmBody').textContent = body;
        document.getElementById('confirmOkBtn').textContent = okText;
        confirmCallback = callback;
        dialog.classList.add('show');
    }

    // Hide confirm dialog
    function hideConfirmDialog() {
        document.getElementById('confirmDialog').classList.remove('show');
        confirmCallback = null;
    }

    // Quick add component from empty state
    window.addQuickComponent = function(type) {
        addBlock(type);
    };

    // Quick add page template from empty state
    window.addPageTemplate = function(templateId) {
        addPageTemplate(templateId);
    };

    // Show template guide
    window.showTemplateGuide = function() {
        showOnboarding();
    };

    // Show onboarding guide
    function showOnboarding() {
        document.getElementById('onboardingGuide').classList.add('show');
    }

    // Hide onboarding guide
    function hideOnboarding() {
        document.getElementById('onboardingGuide').classList.remove('show');
        localStorage.setItem('onboardingShown', 'true');
    }

    // Check if should show onboarding
    function checkOnboarding() {
        if (!localStorage.getItem('onboardingShown') && blocks.length === 0) {
            showOnboarding();
        }
    }

    var templates = {
        navbar: { props: { left: '返回', title: '账户信息', right: '编辑', showLeft: true, showRight: true }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
        'large-title': { props: { title: '账户信息' }, style: { bg: '#ffffff', color: '#111111', fontSize: 20, fontWeight: 600, lineHeight: 1.3, py: 8, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
        search: { props: { placeholder: '请输入关键词' }, style: { bg: '#ffffff', inputBg: '#ffffff', color: '#111111', placeholderColor: '#999999', borderColor: '#E6E6E8', fontSize: 16, fontWeight: 400, radius: 12, inputRadius: 12, px: 16, h: 40, x: 0, y: 0, w: 100 } },
        'section-header': { props: { title: '基本信息' }, style: { bg: '#F6F7F8', color: '#666666', fontSize: 14, fontWeight: 500, py: 16, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
        'list-item': { props: { icon: 'fa-user', iconBg: '#E6E6E8', title: '个人资料', subtitle: '查看和编辑您的信息', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#999999', titleSize: 16, titleWeight: 400, subSize: 14, subWeight: 400, py: 12, px: 16, iconSize: 28, iconRadius: 7, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
        'toggle-item': { props: { title: '接收消息通知', isOn: false }, style: { bg: '#ffffff', color: '#111111', fontSize: 16, fontWeight: 400, py: 12, px: 16, onColor: '#111111', offColor: '#E6E6E8', trackBg: '#F6F7F8', radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
        card: { props: { showImg: false, imgIcon: 'fa-image', title: '会员权益说明', desc: '开通会员后可享受专属折扣、优先客服等多项权益' }, style: { bg: '#ffffff', imgBg: '#F6F7F8', imgColor: '#999999', titleColor: '#111111', descColor: '#666666', borderColor: '#E6E6E8', titleSize: 16, titleWeight: 600, descSize: 14, descWeight: 400, imgH: 120, radius: 12, mx: 16, my: 12, px: 16, py: 16, x: 0, y: 0, w: 100, h: 'auto' } },
        button: { props: { text: '下一步' }, style: { bg: '#111111', color: '#ffffff', borderColor: 'transparent', fontSize: 16, fontWeight: 600, h: 44, radius: 10, mx: 16, my: 12, x: 0, y: 0, w: 100 } },
        'avatar-block': { props: { icon: 'fa-user', name: '张三', subtitle: 'zhangsan@example.com' }, style: { bg: '#ffffff', avatarBg: '#E6E6E8', avatarColor: '#999999', nameColor: '#111111', subColor: '#666666', avatarSize: 72, avatarRadius: 36, nameSize: 18, nameWeight: 600, subSize: 14, subWeight: 400, py: 24, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
        'text-block': { props: { text: '请仔细阅读以下条款，确保您了解相关权益和使用须知。如有疑问，可随时联系客服。' }, style: { bg: '#ffffff', color: '#666666', fontSize: 14, fontWeight: 400, lineHeight: 1.6, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
        icon: { props: { icon: 'fa-circle-check' }, style: { color: '#111111', fontSize: 24, bg: 'transparent', x: 0, y: 0, w: 'auto', h: 'auto' } },
        'number-picker': { props: { label: '购买数量', value: 1, min: 1, max: 99, step: 1, unit: '件' }, style: { bg: '#ffffff', color: '#111111', valueColor: '#111111', highlightBg: 'rgba(0,0,0,0.02)', borderColor: '#E6E6E8', fontSize: 16, radius: 0, h: 120, x: 0, y: 0, w: 100 } },
        'option-item': { props: { text: '我已阅读并同意《用户协议》', desc: '', checked: false }, style: { bg: '#ffffff', color: '#111111', descColor: '#666666', checkedColor: '#111111', uncheckedColor: '#E6E6E8', checkedBg: '#111111', iconBg: 'transparent', fontSize: 16, descSize: 14, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
        divider: { props: {}, style: { bg: '#E6E6E8', h: 1, radius: 0, x: 0, y: 0, w: 100 } },
        spacer: { props: {}, style: { h: 16, x: 0, y: 0, w: 100 } },
        tabbar: { props: { items: [{ icon: 'fa-house', label: '首页', active: true }, { icon: 'fa-compass', label: '发现' }, { icon: 'fa-plus-circle', label: '' }, { icon: 'fa-bell', label: '消息' }, { icon: 'fa-user', label: '我的' }] }, style: { bg: '#ffffff', activeColor: '#111111', inactiveColor: '#999999', borderColor: '#E6E6E8' } },
        'image-block': { props: { src: '', icon: 'fa-image', aspectRatio: '16:9' }, style: { bg: '#F6F7F8', color: '#999999', h: 180, radius: 12, mx: 16, my: 8, x: 0, y: 0, w: 100 } },
        badge: { props: { text: '新品', type: 'primary' }, style: { bg: '#111111', color: '#ffffff', fontSize: 12, fontWeight: 500, radius: 10, px: 8, py: 4, x: 0, y: 0, w: 'auto', h: 'auto' } },
        'progress-bar': { props: { value: 60, max: 100, showLabel: true }, style: { bg: '#E6E6E8', barColor: '#111111', h: 6, radius: 3, mx: 16, my: 8, x: 0, y: 0, w: 100 } },
        rating: { props: { value: 4, max: 5, allowHalf: false }, style: { color: '#111111', emptyColor: '#E6E6E8', fontSize: 18, x: 0, y: 0, w: 'auto', h: 'auto' } },
        tag: { props: { text: '热门', closable: false }, style: { bg: '#F6F7F8', color: '#666666', fontSize: 12, fontWeight: 500, radius: 6, px: 8, py: 4, x: 0, y: 0, w: 'auto', h: 'auto' } },
        'input-field': { props: { label: '手机号', placeholder: '请输入您的手机号', type: 'text' }, style: { bg: '#ffffff', labelColor: '#111111', inputBg: '#ffffff', inputColor: '#111111', placeholderColor: '#999999', borderColor: '#E6E6E8', fontSize: 16, radius: 12, py: 12, px: 16, h: 40, x: 0, y: 0, w: 100 } },
        'notice-bar': { props: { text: '系统将于今晚 22:00 进行维护升级，届时部分功能暂不可用', icon: 'fa-circle-info', closable: true }, style: { bg: '#F6F7F8', color: '#666666', iconColor: '#666666', fontSize: 14, py: 10, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
        steps: { props: { current: 1, items: ['提交申请', '审核中', '处理完成'] }, style: { bg: '#ffffff', activeColor: '#111111', inactiveColor: '#999999', lineColor: '#E6E6E8', fontSize: 12, py: 16, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
        'bottom-button': { props: { leftText: '取消', leftIcon: '', rightText: '确认提交', showLeft: true }, style: { bg: '#ffffff', leftBg: '#ffffff', leftColor: '#111111', leftBorderColor: '#E6E6E8', rightBg: '#111111', rightColor: '#ffffff', fontSize: 16, fontWeight: 600, h: 44, radius: 10, x: 0, y: 0, w: 100 } }
    };

    // 通用页面模板定义 - 基于流式布局，由基础组件组合而成
    var pageTemplates = {
        // 1. 信息流首页模板
        'feed-home': {
            name: '信息流首页',
            description: '搜索/分类 + 信息流卡片 + 底部导航',
            components: [
                { type: 'navbar', props: { left: '', title: '发现', right: '搜索', showLeft: false, showRight: true }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'search', props: { placeholder: '搜索你感兴趣的内容' }, style: { bg: '#ffffff', inputBg: '#F6F7F8', color: '#111111', placeholderColor: '#999999', borderColor: '#E6E6E8', fontSize: 15, fontWeight: 400, radius: 0, inputRadius: 8, px: 16, h: 40, x: 0, y: 0, w: 100 } },
                { type: 'image-block', props: { src: '', icon: 'fa-play', aspectRatio: '16:9' }, style: { bg: '#1a1a1a', color: '#ffffff', h: 180, radius: 12, mx: 16, my: 8, x: 0, y: 0, w: 100 } },
                { type: 'avatar-block', props: { icon: 'fa-user', name: '旅行摄影师小王', subtitle: '记录世界的每一个角落 · 127.8万粉丝' }, style: { bg: '#ffffff', avatarBg: '#E6E6E8', avatarColor: '#999999', nameColor: '#111111', subColor: '#666666', avatarSize: 40, nameSize: 15, nameWeight: 600, subSize: 12, subWeight: 400, py: 10, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'text-block', props: { text: '在云南大理的洱海边，看着夕阳慢慢落下，整个天空都被染成了金色。#旅行日记 #大理' }, style: { bg: '#ffffff', color: '#333333', fontSize: 14, fontWeight: 400, lineHeight: 1.5, py: 6, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'divider', props: {}, style: { bg: '#F6F7F8', h: 8, radius: 0, x: 0, y: 0, w: 100 } },
                { type: 'image-block', props: { src: '', icon: 'fa-image', aspectRatio: '16:9' }, style: { bg: '#F6F7F8', color: '#999999', h: 180, radius: 12, mx: 16, my: 8, x: 0, y: 0, w: 100 } },
                { type: 'avatar-block', props: { icon: 'fa-user', name: '美食达人阿杰', subtitle: '用心做好每一道菜 · 89.2万粉丝' }, style: { bg: '#ffffff', avatarBg: '#FF9500', avatarColor: '#ffffff', nameColor: '#111111', subColor: '#666666', avatarSize: 40, nameSize: 15, nameWeight: 600, subSize: 12, subWeight: 400, py: 10, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'text-block', props: { text: '今天教大家做一道超简单的蒜蓉粉丝蒸虾，10分钟搞定！鲜嫩多汁 #美食教程' }, style: { bg: '#ffffff', color: '#333333', fontSize: 14, fontWeight: 400, lineHeight: 1.5, py: 6, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'tabbar', props: { items: [{ icon: 'fa-house', label: '首页', active: true }, { icon: 'fa-compass', label: '发现', active: false }, { icon: 'fa-plus-circle', label: '', active: false }, { icon: 'fa-bell', label: '消息', active: false }, { icon: 'fa-user', label: '我的', active: false }] }, style: { bg: '#ffffff', activeColor: '#111111', inactiveColor: '#999999', borderColor: '#E6E6E8' } }
            ]
        },
        // 2. 功能卡片首页模板（Card Hub Home）
        'card-hub': {
            name: '功能卡片首页',
            description: '大功能卡片 + 分类标签 + 底部导航',
            components: [
                { type: 'navbar', props: { left: '', title: '派对', right: '搜索', showLeft: false, showRight: true }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '热门房间' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'card', props: { showImg: true, imgIcon: 'fa-microphone', title: '深夜电台', desc: '正在直播 · 1.2万人在听' }, style: { bg: '#ffffff', imgBg: '#1a1a1a', imgColor: '#ffffff', titleColor: '#111111', descColor: '#666666', borderColor: '#E6E6E8', titleSize: 16, titleWeight: 600, descSize: 13, descWeight: 400, imgH: 100, radius: 12, mx: 16, my: 6, px: 14, py: 12, x: 0, y: 0, w: 100, h: 'auto' } },
                { type: 'card', props: { showImg: true, imgIcon: 'fa-gamepad', title: '游戏开黑', desc: '组队中 · 3/5人' }, style: { bg: '#ffffff', imgBg: '#333333', imgColor: '#ffffff', titleColor: '#111111', descColor: '#666666', borderColor: '#E6E6E8', titleSize: 16, titleWeight: 600, descSize: 13, descWeight: 400, imgH: 100, radius: 12, mx: 16, my: 6, px: 14, py: 12, x: 0, y: 0, w: 100, h: 'auto' } },
                { type: 'divider', props: {}, style: { bg: '#F6F7F8', h: 8, radius: 0, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '分类' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-music', iconBg: '#FF3B30', title: '音乐派对', subtitle: '一起听歌聊天', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-comments', iconBg: '#007AFF', title: '语音聊天', subtitle: '轻松开麦畅聊', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-dice', iconBg: '#34C759', title: '互动游戏', subtitle: '趣味小游戏', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-tv', iconBg: '#FF9500', title: '一起看', subtitle: '共享视频体验', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'tabbar', props: { items: [{ icon: 'fa-house', label: '广场', active: true }, { icon: 'fa-compass', label: '发现', active: false }, { icon: 'fa-plus-circle', label: '', active: false }, { icon: 'fa-bell', label: '消息', active: false }, { icon: 'fa-user', label: '我的', active: false }] }, style: { bg: '#ffffff', activeColor: '#111111', inactiveColor: '#999999', borderColor: '#E6E6E8' } }
            ]
        },
        // 3. 搜索结果列表模板
        'search-list': {
            name: '搜索结果页',
            description: '搜索框 + 筛选条件 + 结果列表',
            components: [
                { type: 'navbar', props: { left: '返回', title: '搜索', right: '', showLeft: true, showRight: false }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'search', props: { placeholder: '搜索商品、店铺、品牌' }, style: { bg: '#ffffff', inputBg: '#F6F7F8', color: '#111111', placeholderColor: '#999999', borderColor: '#E6E6E8', fontSize: 15, fontWeight: 400, radius: 0, inputRadius: 8, px: 16, h: 40, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '热门搜索' }, style: { bg: '#ffffff', color: '#666666', fontSize: 13, fontWeight: 500, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-fire', iconBg: '#FF3B30', title: '智能手表', subtitle: '超过10万人搜索', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#999999', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 12, subWeight: 400, py: 12, px: 16, iconSize: 24, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-bolt', iconBg: '#FF9500', title: '无线耳机', subtitle: '今日热搜第2名', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#999999', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 12, subWeight: 400, py: 12, px: 16, iconSize: 24, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-star', iconBg: '#34C759', title: '运动鞋', subtitle: '本周新上榜', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#999999', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 12, subWeight: 400, py: 12, px: 16, iconSize: 24, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'divider', props: {}, style: { bg: '#F6F7F8', h: 8, radius: 0, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '搜索历史' }, style: { bg: '#ffffff', color: '#666666', fontSize: 13, fontWeight: 500, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-clock', iconBg: '#E6E6E8', title: '蓝牙音箱', subtitle: '', value: '', arrow: false }, style: { bg: '#ffffff', titleColor: '#666666', subColor: '#999999', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 14, titleWeight: 400, subSize: 12, subWeight: 400, py: 10, px: 16, iconSize: 20, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-clock', iconBg: '#E6E6E8', title: '充电宝 20000mAh', subtitle: '', value: '', arrow: false }, style: { bg: '#ffffff', titleColor: '#666666', subColor: '#999999', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 14, titleWeight: 400, subSize: 12, subWeight: 400, py: 10, px: 16, iconSize: 20, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } }
            ]
        },
        // 3. 双列卡片网格模板
        'grid-cards': {
            name: '双列卡片页',
            description: '分类Tab + 双列卡片网格',
            components: [
                { type: 'navbar', props: { left: '返回', title: '全部商品', right: '筛选', showLeft: true, showRight: true }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '热门分类' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'card', props: { showImg: true, imgIcon: 'fa-headphones', title: '降噪无线耳机', desc: '主动降噪 · 40小时续航' }, style: { bg: '#ffffff', imgBg: '#F6F7F8', imgColor: '#666666', titleColor: '#111111', descColor: '#666666', borderColor: '#E6E6E8', titleSize: 14, titleWeight: 600, descSize: 12, descWeight: 400, imgH: 120, radius: 12, mx: 16, my: 6, px: 12, py: 12, x: 0, y: 0, w: 100, h: 'auto' } },
                { type: 'card', props: { showImg: true, imgIcon: 'fa-laptop', title: '轻薄笔记本', desc: '14英寸 · 16GB内存' }, style: { bg: '#ffffff', imgBg: '#F6F7F8', imgColor: '#666666', titleColor: '#111111', descColor: '#666666', borderColor: '#E6E6E8', titleSize: 14, titleWeight: 600, descSize: 12, descWeight: 400, imgH: 120, radius: 12, mx: 16, my: 6, px: 12, py: 12, x: 0, y: 0, w: 100, h: 'auto' } },
                { type: 'card', props: { showImg: true, imgIcon: 'fa-camera', title: '微单相机套装', desc: '4K视频 · 2600万像素' }, style: { bg: '#ffffff', imgBg: '#F6F7F8', imgColor: '#666666', titleColor: '#111111', descColor: '#666666', borderColor: '#E6E6E8', titleSize: 14, titleWeight: 600, descSize: 12, descWeight: 400, imgH: 120, radius: 12, mx: 16, my: 6, px: 12, py: 12, x: 0, y: 0, w: 100, h: 'auto' } },
                { type: 'card', props: { showImg: true, imgIcon: 'fa-mobile', title: '智能手机', desc: '6.7英寸 · 5000mAh' }, style: { bg: '#ffffff', imgBg: '#F6F7F8', imgColor: '#666666', titleColor: '#111111', descColor: '#666666', borderColor: '#E6E6E8', titleSize: 14, titleWeight: 600, descSize: 12, descWeight: 400, imgH: 120, radius: 12, mx: 16, my: 6, px: 12, py: 12, x: 0, y: 0, w: 100, h: 'auto' } },
                { type: 'tabbar', props: { items: [{ icon: 'fa-house', label: '首页', active: false }, { icon: 'fa-th-large', label: '分类', active: true }, { icon: 'fa-cart-shopping', label: '购物车', active: false }, { icon: 'fa-user', label: '我的', active: false }] }, style: { bg: '#ffffff', activeColor: '#111111', inactiveColor: '#999999', borderColor: '#E6E6E8' } }
            ]
        },
        // 4. 商品/内容推荐模板
        'recommend-page': {
            name: '推荐聚合页',
            description: '搜索/Banner + 分类入口 + 推荐卡片',
            components: [
                { type: 'navbar', props: { left: '', title: '精选推荐', right: '消息', showLeft: false, showRight: true }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'search', props: { placeholder: '搜索你想要的商品' }, style: { bg: '#ffffff', inputBg: '#F6F7F8', color: '#111111', placeholderColor: '#999999', borderColor: '#E6E6E8', fontSize: 15, fontWeight: 400, radius: 0, inputRadius: 8, px: 16, h: 40, x: 0, y: 0, w: 100 } },
                { type: 'image-block', props: { src: '', icon: 'fa-gift', aspectRatio: '16:9' }, style: { bg: '#F6F7F8', color: '#999999', h: 140, radius: 12, mx: 16, my: 8, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '热门分类' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-mobile', iconBg: '#007AFF', title: '数码电子', subtitle: '手机、电脑、配件', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-shirt', iconBg: '#FF9500', title: '服饰鞋包', subtitle: '男装、女装、鞋履', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-couch', iconBg: '#34C759', title: '家居生活', subtitle: '家具、厨具、装饰', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'divider', props: {}, style: { bg: '#F6F7F8', h: 8, radius: 0, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '为你推荐' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'card', props: { showImg: true, imgIcon: 'fa-headphones', title: '降噪无线耳机 Pro', desc: '限时特惠 · 直降200元' }, style: { bg: '#ffffff', imgBg: '#F6F7F8', imgColor: '#666666', titleColor: '#111111', descColor: '#FF3B30', borderColor: '#E6E6E8', titleSize: 15, titleWeight: 600, descSize: 13, descWeight: 500, imgH: 140, radius: 12, mx: 16, my: 8, px: 14, py: 14, x: 0, y: 0, w: 100, h: 'auto' } },
                { type: 'tabbar', props: { items: [{ icon: 'fa-house', label: '首页', active: true }, { icon: 'fa-th-large', label: '分类', active: false }, { icon: 'fa-cart-shopping', label: '购物车', active: false }, { icon: 'fa-user', label: '我的', active: false }] }, style: { bg: '#ffffff', activeColor: '#111111', inactiveColor: '#999999', borderColor: '#E6E6E8' } }
            ]
        },
        // 5. 功能入口聚合模板
        'icon-hub': {
            name: '功能入口页',
            description: '功能图标入口 + Banner推荐区',
            components: [
                { type: 'navbar', props: { left: '', title: '全部服务', right: '', showLeft: false, showRight: false }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '常用功能' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-wallet', iconBg: '#FF9500', title: '钱包', subtitle: '余额、银行卡管理', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-credit-card', iconBg: '#007AFF', title: '支付', subtitle: '扫码付款、收款', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-ticket', iconBg: '#FF3B30', title: '卡券', subtitle: '优惠券、会员卡', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'divider', props: {}, style: { bg: '#F6F7F8', h: 8, radius: 0, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '生活服务' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-mobile', iconBg: '#34C759', title: '话费充值', subtitle: '手机、流量充值', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-bolt', iconBg: '#FFCC00', title: '生活缴费', subtitle: '水电燃气缴费', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-train', iconBg: '#5856D6', title: '出行服务', subtitle: '火车票、机票预订', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'divider', props: {}, style: { bg: '#F6F7F8', h: 8, radius: 0, x: 0, y: 0, w: 100 } },
                { type: 'notice-bar', props: { text: '更多服务正在开放中，敬请期待', icon: 'fa-circle-info', closable: false }, style: { bg: '#F6F7F8', color: '#666666', iconColor: '#666666', fontSize: 13, py: 10, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } }
            ]
        },
        // 6. 聊天会话列表模板
        'chat-list': {
            name: '会话列表页',
            description: '会话列表：头像 + 标题 + 摘要 + 时间',
            components: [
                { type: 'navbar', props: { left: '', title: '消息', right: '编辑', showLeft: false, showRight: true }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'search', props: { placeholder: '搜索联系人或消息' }, style: { bg: '#ffffff', inputBg: '#F6F7F8', color: '#111111', placeholderColor: '#999999', borderColor: '#E6E6E8', fontSize: 15, fontWeight: 400, radius: 0, inputRadius: 8, px: 16, h: 36, x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-user', iconBg: '#007AFF', title: '李明', subtitle: '好的，明天下午三点见', value: '刚刚', arrow: false }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#999999', arrowColor: '#CCCCCC', titleSize: 16, titleWeight: 500, subSize: 14, subWeight: 400, py: 14, px: 16, iconSize: 48, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-users', iconBg: '#34C759', title: '项目组', subtitle: '张三: 文档已经更新完成了', value: '10分钟前', arrow: false }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#999999', arrowColor: '#CCCCCC', titleSize: 16, titleWeight: 500, subSize: 14, subWeight: 400, py: 14, px: 16, iconSize: 48, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-bell', iconBg: '#FF9500', title: '系统通知', subtitle: '您的订单已发货，点击查看物流信息', value: '1小时前', arrow: false }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#999999', arrowColor: '#CCCCCC', titleSize: 16, titleWeight: 500, subSize: 14, subWeight: 400, py: 14, px: 16, iconSize: 48, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-user', iconBg: '#AF52DE', title: '王芳', subtitle: '收到，谢谢你的帮助！', value: '昨天', arrow: false }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#999999', arrowColor: '#CCCCCC', titleSize: 16, titleWeight: 500, subSize: 14, subWeight: 400, py: 14, px: 16, iconSize: 48, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-headset', iconBg: '#FF3B30', title: '客服中心', subtitle: '感谢您的反馈，问题已解决', value: '周一', arrow: false }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#999999', arrowColor: '#CCCCCC', titleSize: 16, titleWeight: 500, subSize: 14, subWeight: 400, py: 14, px: 16, iconSize: 48, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-shopping-bag', iconBg: '#5856D6', title: '商城优惠', subtitle: '双十一预售开始，限时抢购进行中', value: '11/01', arrow: false }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#999999', arrowColor: '#CCCCCC', titleSize: 16, titleWeight: 500, subSize: 14, subWeight: 400, py: 14, px: 16, iconSize: 48, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'tabbar', props: { items: [{ icon: 'fa-house', label: '首页', active: false }, { icon: 'fa-compass', label: '发现', active: false }, { icon: 'fa-comment', label: '消息', active: true }, { icon: 'fa-user', label: '我的', active: false }] }, style: { bg: '#ffffff', activeColor: '#111111', inactiveColor: '#999999', borderColor: '#E6E6E8' } }
            ]
        },
        // 7. 聊天对话页模板
        'chat-dialog': {
            name: '聊天对话页',
            description: '消息气泡列表 + 底部输入栏',
            components: [
                { type: 'navbar', props: { left: '返回', title: '李明', right: '更多', showLeft: true, showRight: true }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'spacer', props: {}, style: { h: 12, x: 0, y: 0, w: 100 } },
                { type: 'text-block', props: { text: '今天 14:30' }, style: { bg: 'transparent', color: '#999999', fontSize: 12, fontWeight: 400, lineHeight: 1.4, py: 8, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'card', props: { showImg: false, imgIcon: '', title: '你好，明天有时间吗？', desc: '' }, style: { bg: '#F6F7F8', imgBg: '#F6F7F8', imgColor: '#666666', titleColor: '#111111', descColor: '#666666', borderColor: 'transparent', titleSize: 15, titleWeight: 400, descSize: 13, descWeight: 400, imgH: 0, radius: 16, mx: 16, my: 4, px: 14, py: 12, x: 0, y: 0, w: 100, h: 'auto' } },
                { type: 'card', props: { showImg: false, imgIcon: '', title: '有的，什么事？', desc: '' }, style: { bg: '#111111', imgBg: '#F6F7F8', imgColor: '#666666', titleColor: '#ffffff', descColor: '#cccccc', borderColor: 'transparent', titleSize: 15, titleWeight: 400, descSize: 13, descWeight: 400, imgH: 0, radius: 16, mx: 16, my: 4, px: 14, py: 12, x: 0, y: 0, w: 100, h: 'auto' } },
                { type: 'card', props: { showImg: false, imgIcon: '', title: '想约你一起吃个饭，顺便聊聊项目的事情', desc: '' }, style: { bg: '#F6F7F8', imgBg: '#F6F7F8', imgColor: '#666666', titleColor: '#111111', descColor: '#666666', borderColor: 'transparent', titleSize: 15, titleWeight: 400, descSize: 13, descWeight: 400, imgH: 0, radius: 16, mx: 16, my: 4, px: 14, py: 12, x: 0, y: 0, w: 100, h: 'auto' } },
                { type: 'card', props: { showImg: false, imgIcon: '', title: '好的，明天下午三点见', desc: '' }, style: { bg: '#111111', imgBg: '#F6F7F8', imgColor: '#666666', titleColor: '#ffffff', descColor: '#cccccc', borderColor: 'transparent', titleSize: 15, titleWeight: 400, descSize: 13, descWeight: 400, imgH: 0, radius: 16, mx: 16, my: 4, px: 14, py: 12, x: 0, y: 0, w: 100, h: 'auto' } },
                { type: 'spacer', props: {}, style: { h: 60, x: 0, y: 0, w: 100 } },
                { type: 'input-field', props: { label: '', placeholder: '输入消息...', type: 'text' }, style: { bg: '#ffffff', labelColor: '#111111', inputBg: '#F6F7F8', inputColor: '#111111', placeholderColor: '#999999', borderColor: '#E6E6E8', fontSize: 15, radius: 20, py: 10, px: 16, h: 40, x: 0, y: 0, w: 100 } }
            ]
        },
        // 8. 创建发布页模板
        'create-page': {
            name: '创建发布页',
            description: '主操作按钮 + 功能入口 + 最近记录',
            components: [
                { type: 'navbar', props: { left: '取消', title: '发布', right: '', showLeft: true, showRight: false }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'large-title', props: { title: '创建新内容' }, style: { bg: '#ffffff', color: '#111111', fontSize: 24, fontWeight: 700, lineHeight: 1.3, py: 16, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'text-block', props: { text: '选择你要创建的内容类型，开始分享你的精彩瞬间' }, style: { bg: '#ffffff', color: '#666666', fontSize: 14, fontWeight: 400, lineHeight: 1.5, py: 0, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'spacer', props: {}, style: { h: 16, x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-camera', iconBg: '#007AFF', title: '拍照', subtitle: '拍摄照片或从相册选择', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 16, titleWeight: 500, subSize: 13, subWeight: 400, py: 14, px: 16, iconSize: 36, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-video', iconBg: '#FF3B30', title: '录像', subtitle: '录制短视频内容', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 16, titleWeight: 500, subSize: 13, subWeight: 400, py: 14, px: 16, iconSize: 36, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-pen', iconBg: '#34C759', title: '写文章', subtitle: '发布图文内容', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 16, titleWeight: 500, subSize: 13, subWeight: 400, py: 14, px: 16, iconSize: 36, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'divider', props: {}, style: { bg: '#F6F7F8', h: 8, radius: 0, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '最近草稿' }, style: { bg: '#ffffff', color: '#666666', fontSize: 13, fontWeight: 500, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-file', iconBg: '#E6E6E8', title: '周末出游记录', subtitle: '3天前编辑', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#999999', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 400, subSize: 12, subWeight: 400, py: 12, px: 16, iconSize: 24, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-file', iconBg: '#E6E6E8', title: '美食分享', subtitle: '1周前编辑', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#999999', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 400, subSize: 12, subWeight: 400, py: 12, px: 16, iconSize: 24, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } }
            ]
        },
        // 9. 多步表单页模板
        'step-form': {
            name: '多步表单页',
            description: '步骤指示器 + 表单分组 + 底部操作栏',
            components: [
                { type: 'navbar', props: { left: '取消', title: '完善资料', right: '', showLeft: true, showRight: false }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'steps', props: { current: 1, items: ['基本信息', '身份验证', '完成注册'] }, style: { bg: '#ffffff', activeColor: '#111111', inactiveColor: '#CCCCCC', lineColor: '#E6E6E8', fontSize: 11, py: 16, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '基本信息' }, style: { bg: '#F6F7F8', color: '#666666', fontSize: 13, fontWeight: 500, py: 10, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'input-field', props: { label: '真实姓名', placeholder: '请输入您的姓名', type: 'text' }, style: { bg: '#ffffff', labelColor: '#111111', inputBg: '#ffffff', inputColor: '#111111', placeholderColor: '#999999', borderColor: '#E6E6E8', fontSize: 15, radius: 0, py: 14, px: 16, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'input-field', props: { label: '手机号码', placeholder: '请输入11位手机号', type: 'tel' }, style: { bg: '#ffffff', labelColor: '#111111', inputBg: '#ffffff', inputColor: '#111111', placeholderColor: '#999999', borderColor: '#E6E6E8', fontSize: 15, radius: 0, py: 14, px: 16, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'input-field', props: { label: '电子邮箱', placeholder: '用于接收重要通知', type: 'email' }, style: { bg: '#ffffff', labelColor: '#111111', inputBg: '#ffffff', inputColor: '#111111', placeholderColor: '#999999', borderColor: '#E6E6E8', fontSize: 15, radius: 0, py: 14, px: 16, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '安全设置' }, style: { bg: '#F6F7F8', color: '#666666', fontSize: 13, fontWeight: 500, py: 10, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'input-field', props: { label: '登录密码', placeholder: '6-20位字母数字组合', type: 'password' }, style: { bg: '#ffffff', labelColor: '#111111', inputBg: '#ffffff', inputColor: '#111111', placeholderColor: '#999999', borderColor: '#E6E6E8', fontSize: 15, radius: 0, py: 14, px: 16, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'input-field', props: { label: '确认密码', placeholder: '请再次输入密码', type: 'password' }, style: { bg: '#ffffff', labelColor: '#111111', inputBg: '#ffffff', inputColor: '#111111', placeholderColor: '#999999', borderColor: '#E6E6E8', fontSize: 15, radius: 0, py: 14, px: 16, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'spacer', props: {}, style: { h: 12, x: 0, y: 0, w: 100 } },
                { type: 'option-item', props: { text: '我已阅读并同意《用户服务协议》和《隐私政策》', desc: '', checked: false }, style: { bg: '#ffffff', color: '#666666', descColor: '#666666', checkedColor: '#111111', uncheckedColor: '#CCCCCC', checkedBg: '#111111', iconBg: 'transparent', fontSize: 13, descSize: 12, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'bottom-button', props: { leftText: '上一步', leftIcon: '', rightText: '下一步', showLeft: true }, style: { bg: '#ffffff', leftBg: '#ffffff', leftColor: '#111111', leftBorderColor: '#E6E6E8', rightBg: '#111111', rightColor: '#ffffff', fontSize: 15, fontWeight: 600, h: 44, radius: 8, x: 0, y: 0, w: 100 } }
            ]
        },
        // 10. 报刊杂志首页模板
        'news-home': {
            name: '报刊杂志首页',
            description: '头条 + 分类频道 + 资讯列表',
            components: [
                { type: 'navbar', props: { left: '', title: '今日头条', right: '发布', showLeft: false, showRight: true }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'search', props: { placeholder: '搜索新闻、话题' }, style: { bg: '#ffffff', inputBg: '#F6F7F8', color: '#111111', placeholderColor: '#999999', borderColor: '#E6E6E8', fontSize: 15, fontWeight: 400, radius: 0, inputRadius: 8, px: 16, h: 40, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '热门频道' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-fire', iconBg: '#FF3B30', title: '热点', subtitle: '实时更新', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-globe', iconBg: '#007AFF', title: '国际', subtitle: '全球视野', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-chart-bar', iconBg: '#34C759', title: '财经', subtitle: '市场动态', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'divider', props: {}, style: { bg: '#F6F7F8', h: 8, radius: 0, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '推荐阅读' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'card', props: { showImg: true, imgIcon: 'fa-image', title: '2024年科技行业十大趋势预测', desc: '深度分析 · 5分钟阅读' }, style: { bg: '#ffffff', imgBg: '#1a1a1a', imgColor: '#ffffff', titleColor: '#111111', descColor: '#666666', borderColor: '#E6E6E8', titleSize: 16, titleWeight: 600, descSize: 13, descWeight: 400, imgH: 140, radius: 12, mx: 16, my: 6, px: 14, py: 12, x: 0, y: 0, w: 100, h: 'auto' } },
                { type: 'list-item', props: { icon: 'fa-newspaper', iconBg: '#E6E6E8', title: '人工智能在医疗领域的最新应用', subtitle: '科技日报 · 3小时前', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#999999', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 12, subWeight: 400, py: 12, px: 16, iconSize: 28, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'tabbar', props: { items: [{ icon: 'fa-house', label: '首页', active: true }, { icon: 'fa-video', label: '视频', active: false }, { icon: 'fa-plus-circle', label: '', active: false }, { icon: 'fa-bookmark', label: '收藏', active: false }, { icon: 'fa-user', label: '我的', active: false }] }, style: { bg: '#ffffff', activeColor: '#111111', inactiveColor: '#999999', borderColor: '#E6E6E8' } }
            ]
        },
        // 11. 财务应用首页模板
        'finance-home': {
            name: '财务应用首页',
            description: '资产概览 + 收支图表 + 快捷操作',
            components: [
                { type: 'navbar', props: { left: '', title: '我的财务', right: '设置', showLeft: false, showRight: true }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'card', props: { showImg: false, imgIcon: '', title: '总资产', desc: '¥ 125,680.00' }, style: { bg: '#111111', imgBg: '#F6F7F8', imgColor: '#666666', titleColor: 'rgba(255,255,255,0.7)', descColor: '#ffffff', borderColor: 'transparent', titleSize: 14, titleWeight: 400, descSize: 28, descWeight: 700, imgH: 0, radius: 16, mx: 16, my: 12, px: 20, py: 20, x: 0, y: 0, w: 100, h: 'auto' } },
                { type: 'section-header', props: { title: '快捷操作' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-arrow-down', iconBg: '#34C759', title: '收入', subtitle: '本月 +¥12,500', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#34C759', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 500, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-arrow-up', iconBg: '#FF3B30', title: '支出', subtitle: '本月 -¥8,320', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#FF3B30', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 500, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-piggy-bank', iconBg: '#FF9500', title: '储蓄目标', subtitle: '已完成 68%', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'divider', props: {}, style: { bg: '#F6F7F8', h: 8, radius: 0, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '最近交易' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-shopping-bag', iconBg: '#E6E6E8', title: '超市购物', subtitle: '今天 14:30', value: '-¥128.50', arrow: false }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#999999', valueColor: '#FF3B30', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 400, subSize: 12, subWeight: 400, py: 12, px: 16, iconSize: 28, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-briefcase', iconBg: '#E6E6E8', title: '工资收入', subtitle: '昨天 10:00', value: '+¥12,500', arrow: false }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#999999', valueColor: '#34C759', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 400, subSize: 12, subWeight: 400, py: 12, px: 16, iconSize: 28, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'tabbar', props: { items: [{ icon: 'fa-house', label: '概览', active: true }, { icon: 'fa-chart-pie', label: '统计', active: false }, { icon: 'fa-plus-circle', label: '', active: false }, { icon: 'fa-wallet', label: '账户', active: false }, { icon: 'fa-user', label: '我的', active: false }] }, style: { bg: '#ffffff', activeColor: '#111111', inactiveColor: '#999999', borderColor: '#E6E6E8' } }
            ]
        },
        // 12. 参考资料页模板
        'reference-page': {
            name: '参考资料页',
            description: '目录导航 + 详情内容 + 相关推荐',
            components: [
                { type: 'navbar', props: { left: '返回', title: '帮助文档', right: '搜索', showLeft: true, showRight: true }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'large-title', props: { title: '快速入门指南' }, style: { bg: '#ffffff', color: '#111111', fontSize: 24, fontWeight: 700, lineHeight: 1.3, py: 16, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'text-block', props: { text: '本文档将帮助您快速了解产品的核心功能和使用方法，预计阅读时间 5 分钟。' }, style: { bg: '#ffffff', color: '#666666', fontSize: 14, fontWeight: 400, lineHeight: 1.6, py: 0, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'divider', props: {}, style: { bg: '#F6F7F8', h: 1, radius: 0, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '目录' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-circle', iconBg: 'transparent', title: '1. 安装与配置', subtitle: '', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#007AFF', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 400, subSize: 13, subWeight: 400, py: 10, px: 16, iconSize: 8, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-circle', iconBg: 'transparent', title: '2. 基础概念', subtitle: '', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#007AFF', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 400, subSize: 13, subWeight: 400, py: 10, px: 16, iconSize: 8, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-circle', iconBg: 'transparent', title: '3. 进阶功能', subtitle: '', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#007AFF', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 400, subSize: 13, subWeight: 400, py: 10, px: 16, iconSize: 8, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'divider', props: {}, style: { bg: '#F6F7F8', h: 8, radius: 0, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '相关文档' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-file-alt', iconBg: '#E6E6E8', title: 'API 参考手册', subtitle: '', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 400, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 24, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-question-circle', iconBg: '#E6E6E8', title: '常见问题', subtitle: '', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 400, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 24, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } }
            ]
        },
        // 13. 导航工具页模板
        'navigation-page': {
            name: '导航工具页',
            description: '分类列表 + 快速跳转入口',
            components: [
                { type: 'navbar', props: { left: '', title: '导航', right: '编辑', showLeft: false, showRight: true }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'search', props: { placeholder: '搜索网站或应用' }, style: { bg: '#ffffff', inputBg: '#F6F7F8', color: '#111111', placeholderColor: '#999999', borderColor: '#E6E6E8', fontSize: 15, fontWeight: 400, radius: 0, inputRadius: 8, px: 16, h: 40, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '常用网站' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-google', iconBg: '#4285F4', title: 'Google', subtitle: '搜索引擎', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-github', iconBg: '#333333', title: 'GitHub', subtitle: '代码托管', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-youtube', iconBg: '#FF0000', title: 'YouTube', subtitle: '视频平台', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'divider', props: {}, style: { bg: '#F6F7F8', h: 8, radius: 0, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '工具网站' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-palette', iconBg: '#FF9500', title: 'Dribbble', subtitle: '设计灵感', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-figma', iconBg: '#A259FF', title: 'Figma', subtitle: '设计工具', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'button', props: { text: '添加新网站', icon: 'fa-plus' }, style: { bg: '#F6F7F8', color: '#111111', fontSize: 15, fontWeight: 500, h: 44, radius: 10, mx: 16, my: 16, x: 0, y: 0, w: 100 } }
            ]
        },
        // 14. 工具应用首页模板
        'utility-home': {
            name: '工具应用首页',
            description: '功能卡片 + 最近使用 + 工具列表',
            components: [
                { type: 'navbar', props: { left: '', title: '工具箱', right: '设置', showLeft: false, showRight: true }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '最近使用' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-calculator', iconBg: '#FF9500', title: '计算器', subtitle: '上次使用：今天', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-qrcode', iconBg: '#007AFF', title: '扫一扫', subtitle: '上次使用：昨天', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'divider', props: {}, style: { bg: '#F6F7F8', h: 8, radius: 0, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '全部工具' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-ruler', iconBg: '#34C759', title: '尺子', subtitle: '测量长度', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-compass', iconBg: '#5856D6', title: '指南针', subtitle: '方向导航', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-lightbulb', iconBg: '#FFCC00', title: '手电筒', subtitle: '照明工具', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-clock', iconBg: '#FF3B30', title: '计时器', subtitle: '倒计时/秒表', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'tabbar', props: { items: [{ icon: 'fa-house', label: '首页', active: true }, { icon: 'fa-star', label: '收藏', active: false }, { icon: 'fa-clock', label: '历史', active: false }, { icon: 'fa-user', label: '我的', active: false }] }, style: { bg: '#ffffff', activeColor: '#111111', inactiveColor: '#999999', borderColor: '#E6E6E8' } }
            ]
        },
        // 15. 商城首页模板
        'shop-home': {
            name: '商城首页',
            description: 'Banner + 分类入口 + 商品推荐',
            components: [
                { type: 'navbar', props: { left: '', title: '商城', right: '购物车', showLeft: false, showRight: true }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'search', props: { placeholder: '搜索商品' }, style: { bg: '#ffffff', inputBg: '#F6F7F8', color: '#111111', placeholderColor: '#999999', borderColor: '#E6E6E8', fontSize: 15, fontWeight: 400, radius: 0, inputRadius: 8, px: 16, h: 40, x: 0, y: 0, w: 100 } },
                { type: 'image-block', props: { src: '', icon: 'fa-tag', aspectRatio: '16:9' }, style: { bg: '#FF3B30', color: '#ffffff', h: 140, radius: 12, mx: 16, my: 8, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '分类' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-mobile', iconBg: '#007AFF', title: '数码电子', subtitle: '手机/电脑/配件', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-shirt', iconBg: '#FF9500', title: '服饰鞋包', subtitle: '男装/女装/鞋履', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-couch', iconBg: '#34C759', title: '家居生活', subtitle: '家具/厨具/装饰', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'divider', props: {}, style: { bg: '#F6F7F8', h: 8, radius: 0, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '热销商品' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'card', props: { showImg: true, imgIcon: 'fa-headphones', title: '无线降噪耳机', desc: '¥599 · 已售2.3万' }, style: { bg: '#ffffff', imgBg: '#F6F7F8', imgColor: '#666666', titleColor: '#111111', descColor: '#FF3B30', borderColor: '#E6E6E8', titleSize: 15, titleWeight: 600, descSize: 14, descWeight: 600, imgH: 120, radius: 12, mx: 16, my: 6, px: 14, py: 12, x: 0, y: 0, w: 100, h: 'auto' } },
                { type: 'tabbar', props: { items: [{ icon: 'fa-house', label: '首页', active: true }, { icon: 'fa-th-large', label: '分类', active: false }, { icon: 'fa-cart-shopping', label: '购物车', active: false }, { icon: 'fa-user', label: '我的', active: false }] }, style: { bg: '#ffffff', activeColor: '#111111', inactiveColor: '#999999', borderColor: '#E6E6E8' } }
            ]
        },
        // 16. 健康应用首页模板
        'health-home': {
            name: '健康应用首页',
            description: '今日数据 + 运动目标 + 健康建议',
            components: [
                { type: 'navbar', props: { left: '', title: '健康', right: '设置', showLeft: false, showRight: true }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'card', props: { showImg: false, imgIcon: '', title: '今日步数', desc: '8,526 步' }, style: { bg: '#34C759', imgBg: '#F6F7F8', imgColor: '#666666', titleColor: 'rgba(255,255,255,0.8)', descColor: '#ffffff', borderColor: 'transparent', titleSize: 14, titleWeight: 400, descSize: 32, descWeight: 700, imgH: 0, radius: 16, mx: 16, my: 12, px: 20, py: 20, x: 0, y: 0, w: 100, h: 'auto' } },
                { type: 'section-header', props: { title: '运动数据' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-fire', iconBg: '#FF9500', title: '消耗热量', subtitle: '目标 500 千卡', value: '328 千卡', arrow: false }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#FF9500', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-person-running', iconBg: '#007AFF', title: '运动时长', subtitle: '目标 30 分钟', value: '22 分钟', arrow: false }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#007AFF', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-heart', iconBg: '#FF3B30', title: '心率', subtitle: '静息心率', value: '72 次/分', arrow: false }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#FF3B30', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'divider', props: {}, style: { bg: '#F6F7F8', h: 8, radius: 0, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '健康建议' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'card', props: { showImg: false, imgIcon: '', title: '今日建议', desc: '还需要走 1,474 步完成今日目标，加油！' }, style: { bg: '#F6F7F8', imgBg: '#F6F7F8', imgColor: '#666666', titleColor: '#111111', descColor: '#666666', borderColor: 'transparent', titleSize: 15, titleWeight: 600, descSize: 14, descWeight: 400, imgH: 0, radius: 12, mx: 16, my: 6, px: 16, py: 14, x: 0, y: 0, w: 100, h: 'auto' } },
                { type: 'tabbar', props: { items: [{ icon: 'fa-house', label: '今日', active: true }, { icon: 'fa-chart-line', label: '趋势', active: false }, { icon: 'fa-dumbbell', label: '运动', active: false }, { icon: 'fa-user', label: '我的', active: false }] }, style: { bg: '#ffffff', activeColor: '#111111', inactiveColor: '#999999', borderColor: '#E6E6E8' } }
            ]
        },
        // 17. 教育课程首页模板
        'education-home': {
            name: '教育课程首页',
            description: '课程推荐 + 学习进度 + 分类浏览',
            components: [
                { type: 'navbar', props: { left: '', title: '学习', right: '搜索', showLeft: false, showRight: true }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '继续学习' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'card', props: { showImg: true, imgIcon: 'fa-play', title: 'Python 入门到精通', desc: '已学习 65% · 继续第8节' }, style: { bg: '#ffffff', imgBg: '#007AFF', imgColor: '#ffffff', titleColor: '#111111', descColor: '#666666', borderColor: '#E6E6E8', titleSize: 16, titleWeight: 600, descSize: 13, descWeight: 400, imgH: 100, radius: 12, mx: 16, my: 6, px: 14, py: 12, x: 0, y: 0, w: 100, h: 'auto' } },
                { type: 'divider', props: {}, style: { bg: '#F6F7F8', h: 8, radius: 0, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '课程分类' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-code', iconBg: '#FF9500', title: '编程开发', subtitle: '128门课程', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-palette', iconBg: '#AF52DE', title: '设计创意', subtitle: '86门课程', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-language', iconBg: '#34C759', title: '语言学习', subtitle: '52门课程', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-briefcase', iconBg: '#007AFF', title: '职场技能', subtitle: '94门课程', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'tabbar', props: { items: [{ icon: 'fa-house', label: '首页', active: true }, { icon: 'fa-compass', label: '发现', active: false }, { icon: 'fa-book', label: '我的课程', active: false }, { icon: 'fa-user', label: '我的', active: false }] }, style: { bg: '#ffffff', activeColor: '#111111', inactiveColor: '#999999', borderColor: '#E6E6E8' } }
            ]
        },
        // 18. 旅游目的地页模板
        'travel-home': {
            name: '旅游目的地页',
            description: '目的地推荐 + 旅行攻略 + 热门景点',
            components: [
                { type: 'navbar', props: { left: '', title: '旅行', right: '搜索', showLeft: false, showRight: true }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'image-block', props: { src: '', icon: 'fa-mountain', aspectRatio: '16:9' }, style: { bg: '#1a1a1a', color: '#ffffff', h: 180, radius: 12, mx: 16, my: 8, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '热门目的地' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-location-dot', iconBg: '#FF3B30', title: '东京', subtitle: '日本 · 热门城市', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-location-dot', iconBg: '#007AFF', title: '巴黎', subtitle: '法国 · 浪漫之都', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-location-dot', iconBg: '#34C759', title: '曼谷', subtitle: '泰国 · 美食天堂', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'divider', props: {}, style: { bg: '#F6F7F8', h: 8, radius: 0, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '旅行攻略' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'card', props: { showImg: true, imgIcon: 'fa-map', title: '东京5日游攻略', desc: '吃住行全攻略 · 2.3万人收藏' }, style: { bg: '#ffffff', imgBg: '#F6F7F8', imgColor: '#666666', titleColor: '#111111', descColor: '#666666', borderColor: '#E6E6E8', titleSize: 15, titleWeight: 600, descSize: 13, descWeight: 400, imgH: 100, radius: 12, mx: 16, my: 6, px: 14, py: 12, x: 0, y: 0, w: 100, h: 'auto' } },
                { type: 'tabbar', props: { items: [{ icon: 'fa-house', label: '首页', active: true }, { icon: 'fa-compass', label: '发现', active: false }, { icon: 'fa-heart', label: '收藏', active: false }, { icon: 'fa-user', label: '我的', active: false }] }, style: { bg: '#ffffff', activeColor: '#111111', inactiveColor: '#999999', borderColor: '#E6E6E8' } }
            ]
        },
        // 19. 美食推荐页模板
        'food-home': {
            name: '美食推荐页',
            description: '美食推荐 + 分类筛选 + 店铺列表',
            components: [
                { type: 'navbar', props: { left: '', title: '美食', right: '筛选', showLeft: false, showRight: true }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'search', props: { placeholder: '搜索美食、餐厅' }, style: { bg: '#ffffff', inputBg: '#F6F7F8', color: '#111111', placeholderColor: '#999999', borderColor: '#E6E6E8', fontSize: 15, fontWeight: 400, radius: 0, inputRadius: 8, px: 16, h: 40, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '美食分类' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-bowl-rice', iconBg: '#FF9500', title: '中餐', subtitle: '附近 128 家', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-pizza-slice', iconBg: '#FF3B30', title: '西餐', subtitle: '附近 56 家', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-fish', iconBg: '#007AFF', title: '日料', subtitle: '附近 42 家', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'divider', props: {}, style: { bg: '#F6F7F8', h: 8, radius: 0, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '附近推荐' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'card', props: { showImg: true, imgIcon: 'fa-utensils', title: '老北京涮羊肉', desc: '⭐ 4.8 · 人均¥88 · 500m' }, style: { bg: '#ffffff', imgBg: '#F6F7F8', imgColor: '#666666', titleColor: '#111111', descColor: '#FF9500', borderColor: '#E6E6E8', titleSize: 15, titleWeight: 600, descSize: 13, descWeight: 500, imgH: 100, radius: 12, mx: 16, my: 6, px: 14, py: 12, x: 0, y: 0, w: 100, h: 'auto' } },
                { type: 'card', props: { showImg: true, imgIcon: 'fa-mug-hot', title: '星巴克咖啡', desc: '⭐ 4.5 · 人均¥42 · 200m' }, style: { bg: '#ffffff', imgBg: '#F6F7F8', imgColor: '#666666', titleColor: '#111111', descColor: '#FF9500', borderColor: '#E6E6E8', titleSize: 15, titleWeight: 600, descSize: 13, descWeight: 500, imgH: 100, radius: 12, mx: 16, my: 6, px: 14, py: 12, x: 0, y: 0, w: 100, h: 'auto' } },
                { type: 'tabbar', props: { items: [{ icon: 'fa-house', label: '首页', active: true }, { icon: 'fa-compass', label: '发现', active: false }, { icon: 'fa-receipt', label: '订单', active: false }, { icon: 'fa-user', label: '我的', active: false }] }, style: { bg: '#ffffff', activeColor: '#111111', inactiveColor: '#999999', borderColor: '#E6E6E8' } }
            ]
        },
        // 20. 开发工具页模板
        'developer-page': {
            name: '开发工具页',
            description: 'API列表 + 文档入口 + 状态监控',
            components: [
                { type: 'navbar', props: { left: '', title: '开发者中心', right: '设置', showLeft: false, showRight: true }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'card', props: { showImg: false, imgIcon: '', title: 'API 调用统计', desc: '今日 12,580 次' }, style: { bg: '#111111', imgBg: '#F6F7F8', imgColor: '#666666', titleColor: 'rgba(255,255,255,0.7)', descColor: '#34C759', borderColor: 'transparent', titleSize: 14, titleWeight: 400, descSize: 24, descWeight: 700, imgH: 0, radius: 16, mx: 16, my: 12, px: 20, py: 16, x: 0, y: 0, w: 100, h: 'auto' } },
                { type: 'section-header', props: { title: '快速入口' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-book', iconBg: '#007AFF', title: 'API 文档', subtitle: '接口说明与示例', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-key', iconBg: '#FF9500', title: '密钥管理', subtitle: 'API Key 与权限', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-terminal', iconBg: '#34C759', title: '调试控制台', subtitle: '在线测试接口', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'divider', props: {}, style: { bg: '#F6F7F8', h: 8, radius: 0, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '服务状态' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-circle-check', iconBg: '#34C759', title: 'API 服务', subtitle: '运行正常', value: '99.9%', arrow: false }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#34C759', valueColor: '#34C759', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 28, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-circle-check', iconBg: '#34C759', title: '数据库', subtitle: '运行正常', value: '99.8%', arrow: false }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#34C759', valueColor: '#34C759', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 28, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } }
            ]
        },
        // 21. 商务仪表盘模板
        'dashboard-page': {
            name: '商务仪表盘',
            description: '数据卡片 + 图表展示 + 快捷操作',
            components: [
                { type: 'navbar', props: { left: '', title: '数据概览', right: '刷新', showLeft: false, showRight: true }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '今日数据' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-users', iconBg: '#007AFF', title: '新增用户', subtitle: '较昨日 +12%', value: '1,286', arrow: false }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#34C759', valueColor: '#111111', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-shopping-cart', iconBg: '#34C759', title: '订单数量', subtitle: '较昨日 +8%', value: '3,542', arrow: false }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#34C759', valueColor: '#111111', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-dollar-sign', iconBg: '#FF9500', title: '营业额', subtitle: '较昨日 +15%', value: '¥86,420', arrow: false }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#34C759', valueColor: '#111111', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'divider', props: {}, style: { bg: '#F6F7F8', h: 8, radius: 0, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '快捷操作' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-chart-bar', iconBg: '#5856D6', title: '查看报表', subtitle: '详细数据分析', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-download', iconBg: '#007AFF', title: '导出数据', subtitle: 'Excel / PDF', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-cog', iconBg: '#666666', title: '数据设置', subtitle: '指标与维度配置', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } }
            ]
        },
        // 22. 社交动态页模板
        'social-home': {
            name: '社交动态页',
            description: '好友动态 + 互动消息 + 发布入口',
            components: [
                { type: 'navbar', props: { left: '', title: '动态', right: '发布', showLeft: false, showRight: true }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'avatar-block', props: { icon: 'fa-user', name: '小明', subtitle: '2小时前 · 北京' }, style: { bg: '#ffffff', avatarBg: '#007AFF', avatarColor: '#ffffff', nameColor: '#111111', subColor: '#999999', avatarSize: 44, nameSize: 15, nameWeight: 600, subSize: 12, subWeight: 400, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'text-block', props: { text: '今天天气真好，和朋友们一起去公园野餐了~ 🌸🧺' }, style: { bg: '#ffffff', color: '#333333', fontSize: 15, fontWeight: 400, lineHeight: 1.5, py: 0, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'image-block', props: { src: '', icon: 'fa-image', aspectRatio: '16:9' }, style: { bg: '#F6F7F8', color: '#999999', h: 180, radius: 12, mx: 16, my: 8, x: 0, y: 0, w: 100 } },
                { type: 'divider', props: {}, style: { bg: '#F6F7F8', h: 8, radius: 0, x: 0, y: 0, w: 100 } },
                { type: 'avatar-block', props: { icon: 'fa-user', name: '小红', subtitle: '5小时前 · 上海' }, style: { bg: '#ffffff', avatarBg: '#FF3B30', avatarColor: '#ffffff', nameColor: '#111111', subColor: '#999999', avatarSize: 44, nameSize: 15, nameWeight: 600, subSize: 12, subWeight: 400, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'text-block', props: { text: '分享一本最近在读的好书《人类简史》，强烈推荐给大家！📚' }, style: { bg: '#ffffff', color: '#333333', fontSize: 15, fontWeight: 400, lineHeight: 1.5, py: 0, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'card', props: { showImg: true, imgIcon: 'fa-book', title: '人类简史', desc: '尤瓦尔·赫拉利 著' }, style: { bg: '#F6F7F8', imgBg: '#E6E6E8', imgColor: '#666666', titleColor: '#111111', descColor: '#666666', borderColor: 'transparent', titleSize: 14, titleWeight: 600, descSize: 12, descWeight: 400, imgH: 60, radius: 8, mx: 16, my: 8, px: 12, py: 10, x: 0, y: 0, w: 100, h: 'auto' } },
                { type: 'tabbar', props: { items: [{ icon: 'fa-house', label: '首页', active: false }, { icon: 'fa-compass', label: '发现', active: false }, { icon: 'fa-plus-circle', label: '', active: false }, { icon: 'fa-newspaper', label: '动态', active: true }, { icon: 'fa-user', label: '我的', active: false }] }, style: { bg: '#ffffff', activeColor: '#111111', inactiveColor: '#999999', borderColor: '#E6E6E8' } }
            ]
        },
        // 23. 作品展示页模板
        'photo-gallery': {
            name: '作品展示页',
            description: '作品展示 + 相册分类 + 详情浏览',
            components: [
                { type: 'navbar', props: { left: '返回', title: '我的作品', right: '上传', showLeft: true, showRight: true }, style: { bg: '#ffffff', titleColor: '#111111', btnColor: '#111111', fontSize: 17, fontWeight: 600, radius: 0, h: 44, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '精选作品' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'image-block', props: { src: '', icon: 'fa-camera', aspectRatio: '16:9' }, style: { bg: '#1a1a1a', color: '#ffffff', h: 200, radius: 12, mx: 16, my: 8, x: 0, y: 0, w: 100 } },
                { type: 'text-block', props: { text: '城市夜景 · 2024年1月拍摄于上海外滩' }, style: { bg: '#ffffff', color: '#666666', fontSize: 13, fontWeight: 400, lineHeight: 1.4, py: 4, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'divider', props: {}, style: { bg: '#F6F7F8', h: 8, radius: 0, x: 0, y: 0, w: 100 } },
                { type: 'section-header', props: { title: '相册分类' }, style: { bg: '#ffffff', color: '#111111', fontSize: 15, fontWeight: 600, py: 12, px: 16, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-city', iconBg: '#007AFF', title: '城市风光', subtitle: '32张照片', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-tree', iconBg: '#34C759', title: '自然风景', subtitle: '48张照片', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-face-smile', iconBg: '#FF9500', title: '人像摄影', subtitle: '24张照片', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'list-item', props: { icon: 'fa-video', iconBg: '#FF3B30', title: '视频作品', subtitle: '12个视频', value: '', arrow: true }, style: { bg: '#ffffff', titleColor: '#111111', subColor: '#666666', valueColor: '#666666', arrowColor: '#CCCCCC', titleSize: 15, titleWeight: 500, subSize: 13, subWeight: 400, py: 12, px: 16, iconSize: 32, radius: 0, h: 'auto', x: 0, y: 0, w: 100 } },
                { type: 'tabbar', props: { items: [{ icon: 'fa-house', label: '首页', active: false }, { icon: 'fa-compass', label: '发现', active: false }, { icon: 'fa-images', label: '作品', active: true }, { icon: 'fa-user', label: '我的', active: false }] }, style: { bg: '#ffffff', activeColor: '#111111', inactiveColor: '#999999', borderColor: '#E6E6E8' } }
            ]
        }
    };

    // 添加页面模板函数
    function addPageTemplate(templateId) {
        var template = pageTemplates[templateId];
        if (!template) return;

        // 清空当前画布（可选，先询问用户）
        if (blocks.length > 0) {
            showConfirmDialog(
                '应用模板',
                '应用模板将清空当前画布内容，是否继续？',
                '确定应用',
                function() {
                    applyPageTemplate(template);
                }
            );
        } else {
            applyPageTemplate(template);
        }
    }

    // 模板首次提示标记
    var templateHintShown = localStorage.getItem('templateHintShown') === 'true';

    // 显示模板编辑提示
    function showTemplateHint() {
        if (templateHintShown) return;

        // 移除已有提示
        var existingHint = document.querySelector('.template-hint');
        if (existingHint) existingHint.remove();

        var hint = document.createElement('div');
        hint.className = 'template-hint';
        hint.innerHTML = '<div class="template-hint-text"><i class="fas fa-check-circle"></i>这是一个可编辑模板，你可以自由修改或继续添加组件</div><button class="template-hint-close"><i class="fas fa-times"></i></button>';

        var canvasArea = document.querySelector('.canvas-area');
        canvasArea.appendChild(hint);

        hint.querySelector('.template-hint-close').onclick = function() {
            hint.remove();
            templateHintShown = true;
            localStorage.setItem('templateHintShown', 'true');
        };

        // 5秒后自动消失
        setTimeout(function() {
            if (hint.parentNode) {
                hint.style.opacity = '0';
                hint.style.transition = 'opacity 0.3s';
                setTimeout(function() { if (hint.parentNode) hint.remove(); }, 300);
            }
        }, 5000);
    }

    // 实际应用页面模板
    function applyPageTemplate(template) {
        // 清空当前画布
        blocks = [];
        idCounter = 0;

        var canvas = document.getElementById('canvas');

        // 第一步：用流式布局渲染，获取实际位置
        layoutMode = 'flow';
        canvas.classList.remove('free-layout');

        // 添加模板中的所有组件
        for (var i = 0; i < template.components.length; i++) {
            var comp = template.components[i];
            var block = {
                id: ++idCounter,
                type: comp.type,
                props: JSON.parse(JSON.stringify(comp.props)),
                style: JSON.parse(JSON.stringify(comp.style))
            };
            blocks.push(block);
        }

        // 渲染一次获取实际DOM位置
        render();

        // 第二步：读取每个组件的实际位置，转换为自由布局坐标
        var canvasRect = canvas.getBoundingClientRect();
        var blockEls = canvas.querySelectorAll('.block[data-id]');

        for (var j = 0; j < blockEls.length; j++) {
            var el = blockEls[j];
            var blockId = parseInt(el.getAttribute('data-id'));
            var block = findBlock(blockId);
            if (block && block.type !== 'tabbar') {
                var elRect = el.getBoundingClientRect();
                // 转换为相对于画布的百分比坐标
                block.style.x = ((elRect.left - canvasRect.left) / canvasRect.width) * 100;
                block.style.y = ((elRect.top - canvasRect.top) / canvasRect.height) * 100;
                block.style.w = (elRect.width / canvasRect.width) * 100;
            }
        }

        // 第三步：切换到自由布局并重新渲染
        layoutMode = 'free';
        canvas.classList.add('free-layout');
        render();
        saveHistory();

        // 调试：输出模板加载后的状态
        console.log('[模板加载完成] ' + template.name + ' | blocks数量=' + blocks.length);
        blocks.forEach(function(b, i) {
            console.log('  [' + i + '] id=' + b.id + ' type=' + b.type +
                        ' x=' + (b.style.x || 0).toFixed(1) + '% y=' + (b.style.y || 0).toFixed(1) + '%');
        });

        // 切换到自由设计模式，显示组件库
        if (typeof window.setModeActive === 'function') {
            window.setModeActive('free', true);
        }

        // 显示首次提示
        showTemplateHint();

        showToastMsg(template.name + ' 已添加，可继续编辑');
    }

    // 图标名称映射（用于tooltip显示）
    var iconNames = {
        'fa-gear': '设置',
        'fa-cog': '设置',
        'fa-circle-question': '帮助',
        'fa-question-circle': '帮助',
        'fa-moon': '主题',
        'fa-keyboard': '快捷键',
        'fa-user': '账户',
        'fa-user-circle': '账户',
        'fa-circle-user': '账户'
    };

    // 图标分为五大类
    var iconCategories = {
        '设置类': [
            'fa-gear','fa-circle-question','fa-moon','fa-keyboard','fa-user'
        ],
        '导航操作': [
            // 返回图标 (5个)
            'fa-chevron-left','fa-arrow-left','fa-angle-left','fa-circle-left','fa-left-long',
            // 选中图标 (1个)
            'fa-square-check',
            // 菜单图标
            'fa-bars','fa-ellipsis','fa-ellipsis-vertical','fa-grip-lines','fa-list-ul',
            // 导航箭头
            'fa-chevron-right','fa-chevron-up','fa-chevron-down','fa-arrow-right','fa-arrow-up','fa-arrow-down',
            'fa-angle-right','fa-angle-up','fa-angle-down','fa-angles-left','fa-angles-right',
            // 操作图标
            'fa-plus','fa-minus','fa-xmark','fa-check','fa-circle-check','fa-circle-xmark',
            'fa-rotate','fa-refresh','fa-sync','fa-spinner','fa-redo','fa-undo',
            'fa-download','fa-upload','fa-share','fa-share-nodes','fa-link','fa-paperclip',
            'fa-copy','fa-paste','fa-cut','fa-trash','fa-trash-alt','fa-edit','fa-pen','fa-pencil',
            'fa-search','fa-magnifying-glass','fa-filter','fa-sort','fa-sliders'
        ],
        'TabBar底栏': [
            // 首页相关
            'fa-house','fa-home','fa-house-chimney','fa-igloo','fa-building',
            // 发现/服务
            'fa-compass','fa-concierge-bell','fa-handshake','fa-briefcase','fa-store',
            // 消息相关
            'fa-bell','fa-envelope','fa-message','fa-comment','fa-comments',
            // 我的/用户
            'fa-user','fa-user-circle','fa-circle-user','fa-id-card','fa-address-card',
            // 其他底栏常用
            'fa-cart-shopping','fa-shopping-bag','fa-heart','fa-star','fa-bookmark',
            'fa-gear','fa-cog','fa-plus-circle','fa-grid','fa-th-large'
        ],
        '功能业务': [
            // 媒体
            'fa-camera','fa-image','fa-images','fa-photo-film','fa-video',
            'fa-music','fa-headphones','fa-microphone','fa-volume-high',
            'fa-play','fa-pause','fa-stop','fa-forward','fa-backward',
            // 文件
            'fa-file','fa-file-alt','fa-folder','fa-folder-open',
            'fa-print','fa-fax','fa-qrcode','fa-barcode',
            // 位置时间
            'fa-location-dot','fa-map-marker-alt','fa-map','fa-globe',
            'fa-calendar','fa-calendar-alt','fa-clock','fa-stopwatch','fa-hourglass',
            // 金融购物
            'fa-credit-card','fa-wallet','fa-money-bill','fa-coins','fa-piggy-bank',
            'fa-basket-shopping','fa-shop','fa-tag','fa-tags','fa-receipt',
            // 设备
            'fa-phone','fa-mobile','fa-tablet','fa-laptop','fa-desktop',
            'fa-wifi','fa-signal','fa-bluetooth','fa-battery-full',
            // 安全
            'fa-lock','fa-unlock','fa-key','fa-shield','fa-fingerprint',
            // 数据图表
            'fa-chart-bar','fa-chart-line','fa-chart-pie','fa-chart-simple',
            // 社交互动
            'fa-thumbs-up','fa-thumbs-down','fa-hand','fa-hands-clapping',
            'fa-trophy','fa-medal','fa-award','fa-crown','fa-gem',
            'fa-gift','fa-cake-candles','fa-champagne-glasses',
            // 查看
            'fa-eye','fa-eye-slash','fa-glasses'
        ],
        '装饰标识': [
            // 天气自然
            'fa-moon','fa-sun','fa-cloud','fa-cloud-sun','fa-bolt',
            'fa-fire','fa-water','fa-snowflake','fa-rainbow',
            'fa-tree','fa-leaf','fa-seedling',
            // 动物
            'fa-dog','fa-cat','fa-fish','fa-bird','fa-paw',
            // 食物
            'fa-utensils','fa-coffee','fa-mug-hot','fa-wine-glass','fa-burger',
            'fa-apple-whole','fa-carrot','fa-lemon',
            // 交通
            'fa-car','fa-bus','fa-train','fa-plane','fa-ship','fa-bicycle',
            // 医疗教育
            'fa-hospital','fa-pills','fa-syringe','fa-heartbeat',
            'fa-graduation-cap','fa-book','fa-book-open','fa-school',
            // 创意
            'fa-palette','fa-paint-brush','fa-wand-magic-sparkles',
            'fa-lightbulb','fa-plug','fa-flag'
        ]
    };
    // 合并所有图标为数组（保持向后兼容）
    var icons = [];
    Object.keys(iconCategories).forEach(function(cat) {
        icons = icons.concat(iconCategories[cat]);
    });
    var colors = ['#111111','#333333','#666666','#999999','#E6E6E8','#007aff','#34c759','#ff9500','#ff3b30','#af52de','#ffffff','#f5f5f7'];

    document.addEventListener('DOMContentLoaded', function() {
        // Component drag from toolbar
        var componentItems = document.querySelectorAll('.component-item[data-type]');
        for (var i = 0; i < componentItems.length; i++) {
            (function(item) {
                // Drag start from toolbar - single click and drag
                item.onmousedown = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    isToolbarDragging = true;
                    toolbarDragType = item.getAttribute('data-type');
                    toolbarDragStartX = e.clientX;
                    toolbarDragStartY = e.clientY;

                    // Create ghost element
                    dragGhost = document.createElement('div');
                    dragGhost.className = 'drag-ghost';
                    dragGhost.textContent = item.querySelector('span').textContent;
                    document.body.appendChild(dragGhost);
                    dragGhost.style.left = e.clientX + 10 + 'px';
                    dragGhost.style.top = e.clientY + 10 + 'px';
                };
            })(componentItems[i]);
        }

        // Phone scale controls
        var phoneScaleSlider = document.getElementById('phoneScale');
        var scaleValueLabel = document.getElementById('scaleValue');
        var phoneFrame = document.querySelector('.phone-frame');

        phoneScaleSlider.oninput = function() {
            phoneScale = parseInt(this.value);
            scaleValueLabel.textContent = phoneScale + '%';
            phoneFrame.style.transform = 'scale(' + (phoneScale / 100) + ')';
            phoneFrame.style.transformOrigin = 'top center';
            updateOverlayActions();
        };

        document.getElementById('scaleDown').onclick = function() {
            phoneScale = Math.max(50, phoneScale - 10);
            phoneScaleSlider.value = phoneScale;
            scaleValueLabel.textContent = phoneScale + '%';
            phoneFrame.style.transform = 'scale(' + (phoneScale / 100) + ')';
            phoneFrame.style.transformOrigin = 'top center';
            updateOverlayActions();
        };

        document.getElementById('scaleUp').onclick = function() {
            phoneScale = Math.min(150, phoneScale + 10);
            phoneScaleSlider.value = phoneScale;
            scaleValueLabel.textContent = phoneScale + '%';
            phoneFrame.style.transform = 'scale(' + (phoneScale / 100) + ')';
            phoneFrame.style.transformOrigin = 'top center';
            updateOverlayActions();
        };

        // Tab switch
        var tabs = document.querySelectorAll('.panel-tab');
        for (var i = 0; i < tabs.length; i++) {
            (function(tab) {
                tab.onclick = function() {
                    for (var j = 0; j < tabs.length; j++) tabs[j].classList.remove('active');
                    var contents = document.querySelectorAll('.panel-content');
                    for (var j = 0; j < contents.length; j++) contents[j].classList.remove('active');
                    tab.classList.add('active');
                    document.getElementById(tab.getAttribute('data-tab') + 'Panel').classList.add('active');
                };
            })(tabs[i]);
        }

        // Mode cards toggle (通用模板 / 自由设计)
        var modeTemplate = document.getElementById('modeTemplate');
        var modeFree = document.getElementById('modeFree');
        var templateSection = document.getElementById('templateSection');
        var freeDesignSection = document.getElementById('freeDesignSection');
        var canvasEl = document.getElementById('canvas');
        var toolbarPinned = document.getElementById('toolbarPinned');
        var toolbarScrollable = document.getElementById('toolbarScrollable');

        function setModeActive(mode, skipLayoutChange) {
            if (mode === 'template') {
                modeTemplate.classList.add('active');
                modeFree.classList.remove('active');
                templateSection.style.display = 'block';
                freeDesignSection.style.display = 'none';
                toolbarScrollable.classList.add('template-mode');
                toolbarScrollable.classList.remove('free-mode');
            } else {
                modeTemplate.classList.remove('active');
                modeFree.classList.add('active');
                templateSection.style.display = 'none';
                freeDesignSection.style.display = 'block';
                toolbarScrollable.classList.remove('template-mode');
                toolbarScrollable.classList.add('free-mode');
                // 确保画布使用自由布局（统一编辑体验）
                if (!skipLayoutChange) {
                    layoutMode = 'free';
                    canvasEl.classList.add('free-layout');
                    // 如果有组件且还没有位置信息，需要重新渲染
                    if (blocks.length > 0) {
                        render();
                    }
                }
            }
        }

        // 暴露为全局函数，供 applyPageTemplate 调用
        window.setModeActive = setModeActive;

        modeTemplate.onclick = function() { setModeActive('template'); };
        modeFree.onclick = function() { setModeActive('free'); };

        // 滚动时固定区阴影效果
        toolbarScrollable.onscroll = function() {
            if (toolbarScrollable.scrollTop > 5) {
                toolbarPinned.classList.add('scrolled');
            } else {
                toolbarPinned.classList.remove('scrolled');
            }
        };

        // 全局Tooltip功能
        var globalTooltip = document.getElementById('globalTooltip');

        function showTooltip(el, text) {
            if (!text) return;
            var rect = el.getBoundingClientRect();
            globalTooltip.textContent = text;
            globalTooltip.classList.add('visible');

            // 定位：优先显示在元素下方
            var tooltipRect = globalTooltip.getBoundingClientRect();
            var left = rect.left + (rect.width - tooltipRect.width) / 2;
            var top = rect.bottom + 6;

            // 边界检测
            if (left < 5) left = 5;
            if (left + tooltipRect.width > window.innerWidth - 5) {
                left = window.innerWidth - tooltipRect.width - 5;
            }
            if (top + tooltipRect.height > window.innerHeight - 5) {
                top = rect.top - tooltipRect.height - 6;
            }

            globalTooltip.style.left = left + 'px';
            globalTooltip.style.top = top + 'px';
        }

        function hideTooltip() {
            globalTooltip.classList.remove('visible');
        }

        // 暴露为全局函数，供 bindEditorEvents 使用
        window.showTooltip = showTooltip;
        window.hideTooltip = hideTooltip;

        // 为所有带图标的元素添加tooltip
        function bindTooltips() {
            // 模板项的图标
            var templateItems = document.querySelectorAll('.page-template-item');
            for (var i = 0; i < templateItems.length; i++) {
                (function(item) {
                    var icon = item.querySelector('.template-preview');
                    var name = item.querySelector('span').textContent;
                    if (icon) {
                        icon.onmouseenter = function(e) {
                            showTooltip(icon, name);
                        };
                        icon.onmouseleave = hideTooltip;
                    }
                })(templateItems[i]);
            }

            // 组件项的图标
            var componentItems = document.querySelectorAll('.component-item');
            for (var j = 0; j < componentItems.length; j++) {
                (function(item) {
                    var icon = item.querySelector('i');
                    var spanEl = item.querySelector('span');
                    var name = spanEl ? spanEl.textContent : '';
                    if (icon && name) {
                        icon.style.pointerEvents = 'auto';
                        icon.onmouseenter = function(e) {
                            showTooltip(icon, name);
                        };
                        icon.onmouseleave = hideTooltip;
                    }
                })(componentItems[j]);
            }
        }

        bindTooltips();

        // Preview
        document.getElementById('previewBtn').onclick = function() {
            document.body.classList.toggle('preview-mode');
            var isPreview = document.body.classList.contains('preview-mode');
            this.innerHTML = isPreview ? '<i class="fas fa-edit"></i><span>退出预览</span>' : '<i class="fas fa-play"></i><span>预览</span>';
        };

        // Confirm dialog events
        document.getElementById('confirmCancelBtn').onclick = function() {
            hideConfirmDialog();
        };
        document.getElementById('confirmOkBtn').onclick = function() {
            if (confirmCallback) confirmCallback();
            hideConfirmDialog();
        };
        document.getElementById('confirmDialog').onclick = function(e) {
            if (e.target === this) hideConfirmDialog();
        };

        // Onboarding events
        document.getElementById('startUsingBtn').onclick = function() {
            hideOnboarding();
        };
        document.getElementById('skipGuideBtn').onclick = function() {
            hideOnboarding();
        };
        document.getElementById('onboardingGuide').onclick = function(e) {
            if (e.target === this) hideOnboarding();
        };

        // 导出对话框事件
        document.getElementById('exportCloseBtn').onclick = closeExportDialog;
        document.getElementById('exportCancelBtn').onclick = closeExportDialog;
        document.getElementById('exportConfirmBtn').onclick = performExport;
        document.getElementById('exportDialog').onclick = function(e) {
            if (e.target === this) closeExportDialog();
        };
        document.getElementById('exportProjectName').addEventListener('input', updateExportFilenamePreview);
        document.getElementById('exportPageName').addEventListener('input', updateExportFilenamePreview);

        // 导出成功提示事件
        document.getElementById('exportSuccessCloseBtn').onclick = closeExportSuccess;
        document.getElementById('copyFilenameBtn').onclick = copyFilename;
        document.getElementById('redownloadBtn').onclick = redownload;
        document.getElementById('exportSuccessDialog').onclick = function(e) {
            if (e.target === this) closeExportSuccess();
        };

        // Check if should show onboarding
        checkOnboarding();

        // Global styles
        document.getElementById('pageBgColor').oninput = function() {
            globalStyle.bgColor = this.value;
            document.getElementById('pageBgHex').value = this.value;
            applyGlobal();
        };
        document.getElementById('globalSpacing').oninput = function() {
            globalStyle.spacing = parseInt(this.value);
            document.getElementById('spacingValue').textContent = this.value + 'px';
            render();
        };

        // Modal/Toast preview
        document.getElementById('showModalBtn').onclick = function() { showModal(); };
        document.getElementById('showToastBtn').onclick = function() { showToast(); };

        // Modal/Toast edit
        document.getElementById('editModalBtn').onclick = function() { openEditorModal('modalEditor'); };
        document.getElementById('editToastBtn').onclick = function() { openEditorModal('toastEditor'); };

        // Template category switching
        var categoryItems = document.querySelectorAll('.template-category-item');
        var templateGroups = document.querySelectorAll('.template-group');
        for (var i = 0; i < categoryItems.length; i++) {
            (function(item) {
                item.onclick = function() {
                    var category = item.getAttribute('data-category');
                    // Update active category
                    for (var j = 0; j < categoryItems.length; j++) {
                        categoryItems[j].classList.remove('active');
                    }
                    item.classList.add('active');
                    // Show corresponding template group
                    for (var j = 0; j < templateGroups.length; j++) {
                        if (templateGroups[j].getAttribute('data-category') === category) {
                            templateGroups[j].classList.add('active');
                        } else {
                            templateGroups[j].classList.remove('active');
                        }
                    }
                };
            })(categoryItems[i]);
        }

        // Page template click events
        var templateCards = document.querySelectorAll('.template-card[data-template]');
        for (var i = 0; i < templateCards.length; i++) {
            (function(item) {
                item.onclick = function() {
                    var templateId = item.getAttribute('data-template');
                    addPageTemplate(templateId);
                };
            })(templateCards[i]);
        }

        // Toast duration slider
        document.getElementById('toastDurationInput').oninput = function() {
            document.getElementById('toastDurationValue').textContent = this.value + 's';
        };

        // Close iOS modal
        document.getElementById('iosModal').onclick = function(e) {
            if (e.target === this) hideModal();
        };
        document.getElementById('modalCancelBtn').onclick = hideModal;
        document.getElementById('modalConfirmBtn').onclick = hideModal;

        // Deselect
        document.onclick = function(e) {
            if (!e.target.closest('.block') && !e.target.closest('.properties-panel') && !e.target.closest('.toolbar') && !e.target.closest('.editor-modal')) {
                selectedIds.clear();
                render();
                updateEditors();
            }
        };

        // Global mouse events for free dragging
        document.addEventListener('mousemove', handleMouseMove);
        document.addEventListener('mouseup', handleMouseUp);

        // Canvas drop zone
        var canvas = document.getElementById('canvas');
        canvas.addEventListener('mouseenter', function() {
            if (isToolbarDragging) {
                canvas.classList.add('drag-over-canvas');
            }
        });
        canvas.addEventListener('mouseleave', function() {
            canvas.classList.remove('drag-over-canvas');
        });

        // Top toolbar buttons
        document.getElementById('undoBtn').onclick = undo;
        document.getElementById('redoBtn').onclick = redo;
        document.getElementById('saveBtn').onclick = saveProject;
        document.getElementById('exportBtn').onclick = exportHTML;
        document.getElementById('clearAllBtn').onclick = clearAll;

        // ==================== 开发标注模式（内部使用，不暴露UI） ====================
        var devMode = false;
        var devAnnotation = document.getElementById('devAnnotation');
        var devAnnotationTitle = document.getElementById('devAnnotationTitle');
        var devAnnotationContent = document.getElementById('devAnnotationContent');

        function setDevMode(enabled) {
            devMode = enabled;
            document.body.classList.toggle('dev-mode', enabled);
            if (!enabled) {
                hideDevAnnotation();
            }
        }

        function showDevAnnotation(element, blockData) {
            if (!devMode) return;

            var rect = element.getBoundingClientRect();
            var computedStyle = window.getComputedStyle(element);

            // 组件类型名称
            var typeNames = {
                'navbar': '导航栏 Navbar',
                'large-title': '大标题 Large Title',
                'section-header': '章节标题 Section Header',
                'search': '搜索框 Search',
                'list-item': '列表项 List Item',
                'toggle-item': '开关项 Toggle Item',
                'card': '卡片 Card',
                'button': '按钮 Button',
                'avatar-block': '头像块 Avatar Block',
                'text-block': '文本块 Text Block',
                'divider': '分割线 Divider',
                'spacer': '间距 Spacer',
                'tabbar': '标签栏 TabBar'
            };

            devAnnotationTitle.textContent = typeNames[blockData.type] || blockData.type;

            // 构建标注内容
            var html = '';

            // 尺寸信息
            html += '<div class="dev-annotation-section">';
            html += '<div class="dev-annotation-section-title">尺寸 Size</div>';
            html += '<div class="dev-annotation-row"><span class="dev-annotation-label">宽度</span><span class="dev-annotation-value">' + Math.round(rect.width) + 'px</span></div>';
            html += '<div class="dev-annotation-row"><span class="dev-annotation-label">高度</span><span class="dev-annotation-value">' + Math.round(rect.height) + 'px</span></div>';
            html += '</div>';

            // 间距信息
            var padding = computedStyle.padding;
            var margin = computedStyle.margin;
            if (padding !== '0px' || margin !== '0px') {
                html += '<div class="dev-annotation-section">';
                html += '<div class="dev-annotation-section-title">间距 Spacing</div>';
                if (padding !== '0px') {
                    html += '<div class="dev-annotation-row"><span class="dev-annotation-label">padding</span><span class="dev-annotation-value">' + padding + '</span></div>';
                }
                if (margin !== '0px') {
                    html += '<div class="dev-annotation-row"><span class="dev-annotation-label">margin</span><span class="dev-annotation-value">' + margin + '</span></div>';
                }
                html += '</div>';
            }

            // 文字样式（如果有文本）
            var textEl = element.querySelector('h1, h2, p, span, .ios-navbar-title, .ios-list-title, .ios-card-title, button');
            if (textEl) {
                var textStyle = window.getComputedStyle(textEl);
                html += '<div class="dev-annotation-section">';
                html += '<div class="dev-annotation-section-title">文字 Typography</div>';
                html += '<div class="dev-annotation-row"><span class="dev-annotation-label">字号</span><span class="dev-annotation-value">' + textStyle.fontSize + '</span></div>';
                html += '<div class="dev-annotation-row"><span class="dev-annotation-label">行高</span><span class="dev-annotation-value">' + textStyle.lineHeight + '</span></div>';
                html += '<div class="dev-annotation-row"><span class="dev-annotation-label">字重</span><span class="dev-annotation-value">' + textStyle.fontWeight + '</span></div>';
                html += '<div class="dev-annotation-row"><span class="dev-annotation-label">颜色</span><span class="dev-annotation-value">' + rgbToHex(textStyle.color) + '</span></div>';
                html += '</div>';
            }

            // 背景颜色
            var bgColor = computedStyle.backgroundColor;
            if (bgColor && bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
                html += '<div class="dev-annotation-section">';
                html += '<div class="dev-annotation-section-title">背景 Background</div>';
                html += '<div class="dev-annotation-row"><span class="dev-annotation-label">背景色</span><span class="dev-annotation-value">' + rgbToHex(bgColor) + '</span></div>';
                html += '</div>';
            }

            // 圆角
            var borderRadius = computedStyle.borderRadius;
            if (borderRadius && borderRadius !== '0px') {
                html += '<div class="dev-annotation-row"><span class="dev-annotation-label">圆角</span><span class="dev-annotation-value">' + borderRadius + '</span></div>';
            }

            devAnnotationContent.innerHTML = html;

            // 定位浮层
            var annotationRect = devAnnotation.getBoundingClientRect();
            var left = rect.left + rect.width / 2 - 100;
            var top = rect.bottom + 10;

            // 边界检查
            if (left < 10) left = 10;
            if (left + 200 > window.innerWidth - 10) left = window.innerWidth - 210;
            if (top + 200 > window.innerHeight) {
                top = rect.top - 10;
                devAnnotation.style.transform = 'translateY(-100%)';
            } else {
                devAnnotation.style.transform = 'none';
            }

            devAnnotation.style.left = left + 'px';
            devAnnotation.style.top = top + 'px';
            devAnnotation.classList.add('visible');
        }

        function hideDevAnnotation() {
            devAnnotation.classList.remove('visible');
        }

        function rgbToHex(rgb) {
            if (!rgb || rgb === 'transparent') return 'transparent';
            var match = rgb.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);
            if (!match) return rgb;
            var r = parseInt(match[1]).toString(16).padStart(2, '0');
            var g = parseInt(match[2]).toString(16).padStart(2, '0');
            var b = parseInt(match[3]).toString(16).padStart(2, '0');
            return '#' + r + g + b;
        }

        // 为画布中的组件添加标注事件
        document.querySelector('.phone-screen').addEventListener('mouseover', function(e) {
            if (!devMode) return;
            var blockEl = e.target.closest('.block');
            if (blockEl) {
                var blockId = blockEl.getAttribute('data-id');
                var blockData = findBlock(blockId);
                if (blockData) {
                    showDevAnnotation(blockEl, blockData);
                }
            }
        });

        document.querySelector('.phone-screen').addEventListener('mouseout', function(e) {
            if (!devMode) return;
            var blockEl = e.target.closest('.block');
            var relatedBlock = e.relatedTarget ? e.relatedTarget.closest('.block') : null;
            if (blockEl && blockEl !== relatedBlock) {
                hideDevAnnotation();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                if (e.key === 'z' && !e.shiftKey) {
                    e.preventDefault();
                    undo();
                } else if ((e.key === 'y') || (e.key === 'z' && e.shiftKey)) {
                    e.preventDefault();
                    redo();
                } else if (e.key === 's') {
                    e.preventDefault();
                    saveProject();
                } else if (e.key === 'd') {
                    // Ctrl+D: 调试 - 输出当前 blocks 状态
                    e.preventDefault();
                    console.log('╔══════════════════════════════════════════════════════════╗');
                    console.log('║     Ctrl+D 调试：当前画布状态                            ║');
                    console.log('╠══════════════════════════════════════════════════════════╣');
                    console.log('║ blocks 数组长度:', blocks.length);
                    console.log('║ layoutMode:', layoutMode);
                    console.log('╠══════════════════════════════════════════════════════════╣');
                    blocks.forEach(function(b, i) {
                        var info = '║ [' + i + '] id=' + b.id + ' type=' + b.type +
                                   ' x=' + (b.style && b.style.x !== undefined ? b.style.x.toFixed(1) : 'N/A') + '%' +
                                   ' y=' + (b.style && b.style.y !== undefined ? b.style.y.toFixed(1) : 'N/A') + '%';
                        if (b.props && b.props.title) info += ' title="' + b.props.title + '"';
                        console.log(info);
                    });
                    console.log('╚══════════════════════════════════════════════════════════╝');
                }
            }
            // Delete key
            if (e.key === 'Delete' || e.key === 'Backspace') {
                if (selectedIds.size > 0 && !e.target.closest('input, textarea, [contenteditable]')) {
                    e.preventDefault();
                    selectedIds.forEach(function(id) { deleteBlock(id); });
                }
            }
        });

        // Load saved project on startup
        var savedProject = localStorage.getItem('ios-designer-project');
        if (savedProject) {
            try {
                var data = JSON.parse(savedProject);
                blocks = data.blocks || [];
                idCounter = data.idCounter || 0;
                globalStyle = data.globalStyle || globalStyle;
                render();
                applyGlobal();
            } catch (e) {}
        }

        // Initialize history
        saveHistory();
    });

    function handleMouseMove(e) {
        // Handle toolbar dragging
        if (isToolbarDragging && dragGhost) {
            dragGhost.style.left = e.clientX + 10 + 'px';
            dragGhost.style.top = e.clientY + 10 + 'px';

            var canvas = document.getElementById('canvas');
            var rect = canvas.getBoundingClientRect();
            if (e.clientX >= rect.left && e.clientX <= rect.right &&
                e.clientY >= rect.top && e.clientY <= rect.bottom) {
                canvas.classList.add('drag-over-canvas');
            } else {
                canvas.classList.remove('drag-over-canvas');
            }
            return;
        }

        // 检测是否超过拖拽阈值
        if (isDragPending && !isDragging && currentDragBlock) {
            var dx = Math.abs(e.clientX - dragStartX);
            var dy = Math.abs(e.clientY - dragStartY);
            if (dx > dragThreshold || dy > dragThreshold) {
                activateDrag();
            } else {
                return; // 未超过阈值，不处理
            }
        }

        // Handle free layout block dragging
        if (!isDragging || !currentDragBlock || !currentDragElement || layoutMode !== 'free') return;

        // 阻止默认行为
        e.preventDefault();

        var canvas = document.getElementById('canvas');
        var rect = canvas.getBoundingClientRect();

        var deltaX = e.clientX - dragStartX;
        var deltaY = e.clientY - dragStartY;

        // Calculate position change as percentage (rect is already scaled)
        var newX = dragBlockStartX + (deltaX / rect.width * 100);
        var newY = dragBlockStartY + (deltaY / rect.height * 100);

        // Clamp values - allow dragging to edges
        newX = Math.max(-10, Math.min(95, newX));
        newY = Math.max(0, Math.min(200, newY));

        // Get current block dimensions
        var blockW = currentDragBlock.style.w === 'auto' ? 10 : (currentDragBlock.style.w || 100);
        var blockH = getBlockHeight(currentDragBlock);
        var blockRight = newX + blockW;
        var blockBottom = newY + blockH;
        var blockCenterX = newX + blockW / 2;
        var blockCenterY = newY + blockH / 2;

        // Auto alignment - check against other blocks
        clearAlignGuides();
        clearDistanceBubbles();
        var snappedX = newX;
        var snappedY = newY;
        var showGuides = [];
        var closestDistances = { left: null, right: null, top: null, bottom: null };

        for (var i = 0; i < blocks.length; i++) {
            var other = blocks[i];
            if (other.id === currentDragBlock.id || other.type === 'tabbar') continue;

            var otherX = other.style.x || 0;
            var otherY = other.style.y || 0;
            var otherW = other.style.w === 'auto' ? 10 : (other.style.w || 100);
            var otherH = getBlockHeight(other);
            var otherRight = otherX + otherW;
            var otherBottom = otherY + otherH;
            var otherCenterX = otherX + otherW / 2;
            var otherCenterY = otherY + otherH / 2;

            // Calculate distances to nearby blocks (horizontal)
            var distLeft = newX - otherRight;
            var distRight = otherX - blockRight;
            // Calculate distances (vertical)
            var distTop = newY - otherBottom;
            var distBottom = otherY - blockBottom;

            // Track closest horizontal distances for bubble display
            if (distLeft > 0 && distLeft < 20 && (!closestDistances.left || distLeft < closestDistances.left.dist)) {
                closestDistances.left = { dist: distLeft, x: otherRight + distLeft / 2, y: newY + blockH / 2 };
            }
            if (distRight > 0 && distRight < 20 && (!closestDistances.right || distRight < closestDistances.right.dist)) {
                closestDistances.right = { dist: distRight, x: blockRight + distRight / 2, y: newY + blockH / 2 };
            }
            // Track closest vertical distances for bubble display
            if (distTop > 0 && distTop < 15 && (!closestDistances.top || distTop < closestDistances.top.dist)) {
                closestDistances.top = { dist: distTop, x: newX + blockW / 2, y: otherBottom + distTop / 2 };
            }
            if (distBottom > 0 && distBottom < 15 && (!closestDistances.bottom || distBottom < closestDistances.bottom.dist)) {
                closestDistances.bottom = { dist: distBottom, x: newX + blockW / 2, y: blockBottom + distBottom / 2 };
            }

            // Horizontal alignment (left edges)
            if (Math.abs(newX - otherX) < alignSnapThreshold) {
                snappedX = otherX;
                showGuides.push({ type: 'vertical', pos: otherX, label: '左' });
            }
            // Horizontal alignment (right edges)
            if (Math.abs(blockRight - otherRight) < alignSnapThreshold) {
                snappedX = otherRight - blockW;
                showGuides.push({ type: 'vertical', pos: otherRight, label: '右' });
            }
            // Horizontal alignment (left to right)
            if (Math.abs(newX - otherRight) < alignSnapThreshold) {
                snappedX = otherRight;
                showGuides.push({ type: 'vertical', pos: otherRight, label: '贴边' });
            }
            // Horizontal alignment (right to left)
            if (Math.abs(blockRight - otherX) < alignSnapThreshold) {
                snappedX = otherX - blockW;
                showGuides.push({ type: 'vertical', pos: otherX, label: '贴边' });
            }
            // Horizontal alignment (center)
            if (Math.abs(blockCenterX - otherCenterX) < alignSnapThreshold) {
                snappedX = otherCenterX - blockW / 2;
                showGuides.push({ type: 'vertical', pos: otherCenterX, label: '中' });
            }
            // Vertical alignment (top edges)
            if (Math.abs(newY - otherY) < alignSnapThreshold) {
                snappedY = otherY;
                showGuides.push({ type: 'horizontal', pos: otherY, label: '顶' });
            }
            // Vertical alignment (bottom edges)
            if (Math.abs(blockBottom - otherBottom) < alignSnapThreshold) {
                snappedY = otherBottom - blockH;
                showGuides.push({ type: 'horizontal', pos: otherBottom, label: '底' });
            }
            // Vertical alignment (top to bottom)
            if (Math.abs(newY - otherBottom) < alignSnapThreshold) {
                snappedY = otherBottom;
                showGuides.push({ type: 'horizontal', pos: otherBottom, label: '贴边' });
            }
            // Vertical alignment (bottom to top)
            if (Math.abs(blockBottom - otherY) < alignSnapThreshold) {
                snappedY = otherY - blockH;
                showGuides.push({ type: 'horizontal', pos: otherY, label: '贴边' });
            }
            // Vertical alignment (center)
            if (Math.abs(blockCenterY - otherCenterY) < alignSnapThreshold) {
                snappedY = otherCenterY - blockH / 2;
                showGuides.push({ type: 'horizontal', pos: otherCenterY, label: '中' });
            }

            // Equal spacing detection (snap to standard spacing values)
            var standardSpacing = [8, 12, 16, 24, 32];
            var canvasWidth = 390; // Base canvas width in px
            for (var s = 0; s < standardSpacing.length; s++) {
                var spacePct = standardSpacing[s] / canvasWidth * 100;
                // Check horizontal equal spacing
                if (distLeft > 0 && Math.abs(distLeft - spacePct) < 0.8) {
                    snappedX = otherRight + spacePct;
                    showGuides.push({ type: 'vertical', pos: newX, label: standardSpacing[s] + '' });
                }
                if (distRight > 0 && Math.abs(distRight - spacePct) < 0.8) {
                    snappedX = otherX - blockW - spacePct;
                    showGuides.push({ type: 'vertical', pos: blockRight, label: standardSpacing[s] + '' });
                }
                // Check vertical equal spacing
                var canvasHeight = 844; // Base canvas height in px
                var spaceVPct = standardSpacing[s] / canvasHeight * 100;
                if (distTop > 0 && Math.abs(distTop - spaceVPct) < 0.5) {
                    snappedY = otherBottom + spaceVPct;
                }
                if (distBottom > 0 && Math.abs(distBottom - spaceVPct) < 0.5) {
                    snappedY = otherY - blockH - spaceVPct;
                }
            }
        }

        // Show distance bubbles for nearby blocks
        if (closestDistances.left) {
            showDistanceBubble(closestDistances.left.x, closestDistances.left.y, closestDistances.left.dist, 'h');
        }
        if (closestDistances.right) {
            showDistanceBubble(closestDistances.right.x, closestDistances.right.y, closestDistances.right.dist, 'h');
        }
        if (closestDistances.top) {
            showDistanceBubble(closestDistances.top.x, closestDistances.top.y, closestDistances.top.dist, 'v');
        }
        if (closestDistances.bottom) {
            showDistanceBubble(closestDistances.bottom.x, closestDistances.bottom.y, closestDistances.bottom.dist, 'v');
        }

        // Snap to canvas edges and center
        if (Math.abs(newX) < alignSnapThreshold) {
            snappedX = 0;
            showGuides.push({ type: 'vertical', pos: 0, label: '边缘' });
        }
        if (Math.abs(blockRight - 100) < alignSnapThreshold) {
            snappedX = 100 - blockW;
            showGuides.push({ type: 'vertical', pos: 100, label: '边缘' });
        }
        if (Math.abs(blockCenterX - 50) < alignSnapThreshold) {
            snappedX = 50 - blockW / 2;
            showGuides.push({ type: 'vertical', pos: 50, label: '居中' });
        }
        if (Math.abs(newY) < alignSnapThreshold) {
            snappedY = 0;
            showGuides.push({ type: 'horizontal', pos: 0, label: '顶部' });
        }

        // Show alignment guides
        showGuides.forEach(function(g) {
            showAlignGuide(g.type, g.pos, g.label);
        });

        newX = snappedX;
        newY = snappedY;

        // 直接更新 DOM 位置，不重新渲染
        currentDragElement.style.left = newX + '%';
        currentDragElement.style.top = newY + '%';

        // 保存新位置到数据
        currentDragBlock.style.x = Math.round(newX * 10) / 10;
        currentDragBlock.style.y = Math.round(newY * 10) / 10;

        // 实时更新操作按钮位置
        updateOverlayActions();
    }

    function showAlignGuide(type, pos, label) {
        var canvas = document.getElementById('canvas');
        var guide = document.createElement('div');
        guide.className = 'align-guide ' + type;
        if (type === 'vertical') {
            guide.style.left = pos + '%';
        } else {
            guide.style.top = pos + '%';
        }
        var labelEl = document.createElement('div');
        labelEl.className = 'align-guide-label';
        labelEl.textContent = label;
        if (type === 'vertical') {
            labelEl.style.top = '10px';
            labelEl.style.left = '2px';
        } else {
            labelEl.style.left = '10px';
            labelEl.style.top = '2px';
        }
        guide.appendChild(labelEl);
        canvas.appendChild(guide);
        alignGuides.push(guide);
    }

    function clearAlignGuides() {
        alignGuides.forEach(function(g) {
            if (g.parentNode) g.parentNode.removeChild(g);
        });
        alignGuides = [];
    }

    function handleMouseUp(e) {
        // Handle toolbar drag drop
        if (isToolbarDragging && toolbarDragType) {
            var canvas = document.getElementById('canvas');
            var rect = canvas.getBoundingClientRect();

            // Check if dropped on canvas
            if (e.clientX >= rect.left && e.clientX <= rect.right &&
                e.clientY >= rect.top && e.clientY <= rect.bottom) {

                // Calculate drop position as percentage (rect is already scaled)
                var dropX = (e.clientX - rect.left) / rect.width * 100;
                var dropY = (e.clientY - rect.top) / rect.height * 100;

                // Add block at drop position
                addBlockAtPosition(toolbarDragType, dropX, dropY);
            } else {
                // If not dropped on canvas but was just a click (not much movement), add at default position
                var moveDistance = Math.sqrt(Math.pow(e.clientX - toolbarDragStartX, 2) + Math.pow(e.clientY - toolbarDragStartY, 2));
                if (moveDistance < 10) {
                    addBlock(toolbarDragType);
                }
            }

            // Cleanup
            if (dragGhost) {
                dragGhost.remove();
                dragGhost = null;
            }
            canvas.classList.remove('drag-over-canvas');
            isToolbarDragging = false;
            toolbarDragType = null;
            return;
        }

        // Handle free layout block drag end
        if (isDragging || isDragPending) {
            endDrag();
        }
    }

    function applyGlobal() {
        document.querySelector('.phone-screen').style.background = globalStyle.bgColor;
        document.getElementById('canvas').style.background = globalStyle.bgColor;
    }

    // 获取画布可视区域（百分比）
    function getVisibleCanvasArea() {
        var phoneScreen = document.querySelector('.phone-screen');
        var canvas = document.getElementById('canvas');
        if (!phoneScreen || !canvas) {
            return { top: 0, bottom: 100, height: 100 };
        }

        var screenRect = phoneScreen.getBoundingClientRect();
        var canvasRect = canvas.getBoundingClientRect();
        var scrollTop = phoneScreen.scrollTop;

        // 可视区域相对于画布的百分比
        var visibleTop = (scrollTop / canvasRect.height) * 100;
        var visibleBottom = ((scrollTop + screenRect.height) / canvasRect.height) * 100;

        return {
            top: Math.max(0, visibleTop),
            bottom: Math.min(100, visibleBottom),
            height: screenRect.height,
            canvasHeight: canvasRect.height
        };
    }

    function addBlock(type) {
        var tpl = templates[type];
        if (!tpl) return;
        var block = {
            id: ++idCounter,
            type: type,
            props: JSON.parse(JSON.stringify(tpl.props)),
            style: JSON.parse(JSON.stringify(tpl.style))
        };

        // For free layout, set initial position within visible area
        if (layoutMode === 'free') {
            var visible = getVisibleCanvasArea();
            var defaultY = visible.top + 5; // 默认放在可视区域顶部往下一点

            // 如果有选中的组件，放在选中组件附近
            if (selectedIds.size > 0) {
                var selectedId = Array.from(selectedIds)[0];
                var selectedBlock = findBlock(selectedId);
                if (selectedBlock && selectedBlock.type !== 'tabbar') {
                    // 放在选中组件的下方
                    var selectedEl = document.querySelector('.block[data-id="' + selectedId + '"]');
                    if (selectedEl) {
                        var canvas = document.getElementById('canvas');
                        var canvasRect = canvas.getBoundingClientRect();
                        var elRect = selectedEl.getBoundingClientRect();
                        // 计算选中组件底部的百分比位置
                        var selectedBottom = ((elRect.bottom - canvasRect.top) / canvasRect.height) * 100;
                        defaultY = selectedBottom + 2; // 放在下方留2%间距

                        // 确保不超出可视区域太多
                        if (defaultY > visible.bottom - 10) {
                            // 如果放在下方会超出可视区域，放在选中组件上方
                            var selectedTop = ((elRect.top - canvasRect.top) / canvasRect.height) * 100;
                            defaultY = Math.max(visible.top + 2, selectedTop - 15);
                        }
                    }
                }
            }

            // 确保Y坐标在合理范围内
            block.style.y = Math.max(0, defaultY);
            block.style.x = 10;

            if (type !== 'tabbar') {
                block.style.w = 80;
            }
        }

        blocks.push(block);
        console.log('[添加组件] id=' + block.id + ' type=' + block.type +
                    ' x=' + (block.style.x || 0).toFixed(1) + '% y=' + (block.style.y || 0).toFixed(1) + '%' +
                    ' | blocks总数=' + blocks.length);
        saveHistory();
        render();
        selectBlock(block.id, false);

        // 滚动到新组件可见
        setTimeout(function() {
            var newEl = document.querySelector('.block[data-id="' + block.id + '"]');
            if (newEl) {
                newEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }, 50);
    }

    function addBlockAtPosition(type, x, y) {
        var tpl = templates[type];
        if (!tpl) return;
        var block = {
            id: ++idCounter,
            type: type,
            props: JSON.parse(JSON.stringify(tpl.props)),
            style: JSON.parse(JSON.stringify(tpl.style))
        };

        // Set position based on drop location
        if (layoutMode === 'free') {
            var visible = getVisibleCanvasArea();

            // 确保Y坐标在可视区域内
            var safeY = y;
            if (safeY < visible.top) {
                safeY = visible.top + 5;
            } else if (safeY > visible.bottom - 15) {
                safeY = visible.bottom - 20;
            }

            // Place block at mouse position
            if (type === 'icon') {
                // Icon is small, place directly at mouse position
                block.style.x = Math.max(0, Math.min(95, x));
                block.style.y = Math.max(0, safeY);
                block.style.w = 'auto';
            } else if (type === 'tabbar') {
                // Tabbar stays at bottom
                block.style.w = 100;
            } else {
                // Other blocks offset slightly from mouse
                var blockWidth = 80;
                block.style.x = Math.max(0, Math.min(100 - blockWidth, x - 5));
                block.style.y = Math.max(0, safeY);
                block.style.w = blockWidth;
            }
        }

        blocks.push(block);
        console.log('[拖入组件] id=' + block.id + ' type=' + block.type +
                    ' x=' + (block.style.x || 0).toFixed(1) + '% y=' + (block.style.y || 0).toFixed(1) + '%' +
                    ' | blocks总数=' + blocks.length);
        saveHistory();
        render();
        selectBlock(block.id, false);
    }

    function render() {
        var canvas = document.getElementById('canvas');
        if (blocks.length === 0) {
            canvas.innerHTML = '<div class="empty-canvas" id="emptyState"><i class="fas fa-plus-circle"></i><p class="empty-title">从左侧拖入组件开始设计</p><p class="empty-subtitle">或选择现成页面模板快速开始<br>放心操作，随时可撤销恢复</p><div class="empty-actions"><button class="empty-btn primary" onclick="window.addPageTemplate(\'feed-home\')">使用模板</button><button class="empty-btn" onclick="window.addQuickComponent(\'large-title\')">添加组件</button></div><p class="empty-note">更多模板请查看左侧「通用模板」</p></div>';
            return;
        }

        var html = '';
        var regular = [];
        var tabbar = null;
        for (var i = 0; i < blocks.length; i++) {
            if (blocks[i].type === 'tabbar') tabbar = blocks[i];
            else regular.push(blocks[i]);
        }

        for (var i = 0; i < regular.length; i++) {
            html += renderBlock(regular[i]);
            if (layoutMode === 'flow' && globalStyle.spacing > 0 && i < regular.length - 1) {
                html += '<div style="height:' + globalStyle.spacing + 'px"></div>';
            }
        }
        if (tabbar) html += renderBlock(tabbar);

        canvas.innerHTML = html;
        bindBlockEvents();
        updateOverlayActions();
    }

    function renderBlock(block) {
        var sel = selectedIds.has(block.id);
        var multi = selectedIds.size > 1 && sel;
        var cls = multi ? 'multi-selected' : (sel ? 'selected' : '');
        var s = block.style;
        var p = block.props;

        // Free position style
        var posStyle = '';
        if (layoutMode === 'free' && block.type !== 'tabbar') {
            cls += ' free-position';
            var widthStyle = (s.w === 'auto') ? 'auto' : (s.w || 100) + '%';
            posStyle = 'left:' + (s.x || 0) + '%;top:' + (s.y || 0) + '%;width:' + widthStyle + ';';
        }

        var resizeHandles = layoutMode === 'free' && block.type !== 'tabbar' && block.type !== 'icon' ?
            '<div class="resize-handle se" data-resize="se"></div>' : '';

        var actions;
        if (block.type === 'icon') {
            // Simplified actions for icon - just copy and delete
            actions = '<div class="block-actions">' +
                '<button class="block-action-btn" data-action="copy" data-id="' + block.id + '"><i class="fas fa-copy"></i></button>' +
                '<button class="block-action-btn delete" data-action="delete" data-id="' + block.id + '"><i class="fas fa-trash"></i></button></div>';
        } else {
            actions = '<div class="block-actions">' +
                '<span class="drag-handle block-action-btn"><i class="fas fa-grip-vertical"></i></span>' +
                (layoutMode === 'flow' ? '<button class="block-action-btn" data-action="up" data-id="' + block.id + '"><i class="fas fa-arrow-up"></i></button>' +
                '<button class="block-action-btn" data-action="down" data-id="' + block.id + '"><i class="fas fa-arrow-down"></i></button>' : '') +
                '<button class="block-action-btn" data-action="copy" data-id="' + block.id + '"><i class="fas fa-copy"></i></button>' +
                '<button class="block-action-btn delete" data-action="delete" data-id="' + block.id + '"><i class="fas fa-trash"></i></button></div>';
        }

        switch (block.type) {
            case 'navbar':
                var navRadius = s.radius ? 'border-radius:' + s.radius + 'px;' : '';
                var navHeight = s.h && s.h !== 'auto' ? 'height:' + s.h + 'px;' : '';
                var navTitle = (p.title && p.title.trim()) ? p.title : '<span class="text-placeholder">标题</span>';
                return '<div class="block ios-navbar ' + cls + '" data-id="' + block.id + '" draggable="' + (layoutMode === 'flow') + '" style="background:' + s.bg + ';' + navRadius + navHeight + posStyle + '">' + actions + resizeHandles +
                    '<div class="ios-navbar-left">' + (p.showLeft ? '<button class="ios-navbar-btn" style="color:' + s.btnColor + '"><i class="fas fa-chevron-left"></i> ' + p.left + '</button>' : '') + '</div>' +
                    '<span class="ios-navbar-title" style="color:' + s.titleColor + ';font-size:' + s.fontSize + 'px;font-weight:' + s.fontWeight + '">' + navTitle + '</span>' +
                    '<div class="ios-navbar-right">' + (p.showRight ? '<button class="ios-navbar-btn" style="color:' + s.btnColor + '">' + p.right + '</button>' : '') + '</div></div>';

            case 'large-title':
                var ltRadius = s.radius ? 'border-radius:' + s.radius + 'px;' : '';
                var ltHeight = s.h && s.h !== 'auto' ? 'height:' + s.h + 'px;' : '';
                var ltTitle = (p.title && p.title.trim()) ? p.title : '<span class="text-placeholder">双击输入标题</span>';
                return '<div class="block ios-large-title ' + cls + '" data-id="' + block.id + '" draggable="' + (layoutMode === 'flow') + '" style="background:' + s.bg + ';padding:' + s.py + 'px ' + s.px + 'px;' + ltRadius + ltHeight + posStyle + '">' + actions + resizeHandles +
                    '<h1 style="color:' + s.color + ';font-size:' + s.fontSize + 'px;font-weight:' + s.fontWeight + ';line-height:' + s.lineHeight + '">' + ltTitle + '</h1></div>';

            case 'search':
                var searchRadius = s.radius ? 'border-radius:' + s.radius + 'px;' : '';
                var searchHeight = s.h && s.h !== 'auto' ? 'height:' + s.h + 'px;' : '';
                return '<div class="block ios-search ' + cls + '" data-id="' + block.id + '" draggable="' + (layoutMode === 'flow') + '" style="background:' + s.bg + ';padding:8px ' + s.px + 'px;' + searchRadius + searchHeight + posStyle + '">' + actions + resizeHandles +
                    '<div class="ios-search-wrapper"><i class="fas fa-search" style="color:' + s.placeholderColor + '"></i><input type="text" class="ios-search-input" placeholder="' + p.placeholder + '" style="background:' + s.inputBg + ';color:' + s.color + ';font-size:' + s.fontSize + 'px;font-weight:' + s.fontWeight + ';border-radius:' + (s.inputRadius || s.radius || 10) + 'px"></div></div>';

            case 'section-header':
                var shRadius = s.radius ? 'border-radius:' + s.radius + 'px;' : '';
                var shHeight = s.h && s.h !== 'auto' ? 'height:' + s.h + 'px;' : '';
                var shTitle = (p.title && p.title.trim()) ? p.title : '<span class="text-placeholder">双击输入标题</span>';
                return '<div class="block ios-section-header ' + cls + '" data-id="' + block.id + '" draggable="' + (layoutMode === 'flow') + '" style="background:' + s.bg + ';padding:' + s.py + 'px ' + s.px + 'px 8px;' + shRadius + shHeight + posStyle + '">' + actions + resizeHandles +
                    '<span style="color:' + s.color + ';font-size:' + s.fontSize + 'px;font-weight:' + s.fontWeight + '">' + shTitle + '</span></div>';

            case 'list-item':
                var tw = s.titleWeight || 400;
                var sw = s.subWeight || 400;
                var liRadius = s.radius ? 'border-radius:' + s.radius + 'px;' : '';
                var liHeight = s.h && s.h !== 'auto' ? 'height:' + s.h + 'px;' : '';
                var liIconRadius = s.iconRadius !== undefined ? s.iconRadius : 7;
                var liTitle = (p.title && p.title.trim()) ? p.title : '<span class="text-placeholder">列表标题</span>';
                return '<div class="block ios-list-item ' + cls + '" data-id="' + block.id + '" draggable="' + (layoutMode === 'flow') + '" style="background:' + s.bg + ';padding:' + s.py + 'px ' + s.px + 'px;' + liRadius + liHeight + posStyle + '">' + actions + resizeHandles +
                    '<div class="ios-list-icon" style="background:' + p.iconBg + ';width:' + s.iconSize + 'px;height:' + s.iconSize + 'px;border-radius:' + liIconRadius + 'px"><i class="fas ' + p.icon + '"></i></div>' +
                    '<div class="ios-list-content"><div class="ios-list-title" style="color:' + s.titleColor + ';font-size:' + s.titleSize + 'px;font-weight:' + tw + '">' + liTitle + '</div>' +
                    (p.subtitle ? '<div class="ios-list-subtitle" style="color:' + s.subColor + ';font-size:' + s.subSize + 'px;font-weight:' + sw + '">' + p.subtitle + '</div>' : '') + '</div>' +
                    (p.value ? '<span class="ios-list-value" style="color:' + s.valueColor + '">' + p.value + '</span>' : '') +
                    (p.arrow ? '<span class="ios-list-accessory"><i class="fas fa-chevron-right"></i></span>' : '') + '</div>';

            case 'toggle-item':
                var onC = s.onColor || '#34c759';
                var offC = s.offColor || '#d2d2d7';
                var tw = s.fontWeight || 400;
                var tiRadius = s.radius ? 'border-radius:' + s.radius + 'px;' : '';
                var tiHeight = s.h && s.h !== 'auto' ? 'height:' + s.h + 'px;' : '';
                var tiTitle = (p.title && p.title.trim()) ? p.title : '<span class="text-placeholder">开关标题</span>';
                return '<div class="block ios-toggle-item ' + cls + '" data-id="' + block.id + '" draggable="' + (layoutMode === 'flow') + '" style="background:' + s.bg + ';padding:' + s.py + 'px ' + s.px + 'px;' + tiRadius + tiHeight + posStyle + '">' + actions + resizeHandles +
                    '<span style="color:' + s.color + ';font-size:' + s.fontSize + 'px;font-weight:' + tw + '">' + tiTitle + '</span>' +
                    '<div class="ios-toggle ' + (p.isOn ? 'on' : '') + '" data-toggle="' + block.id + '" style="background:' + (p.isOn ? onC : offC) + '"></div></div>';

            case 'card':
                var tw = s.titleWeight || 600;
                var dw = s.descWeight || 400;
                var cardTitle = (p.title && p.title.trim()) ? p.title : '<span class="text-placeholder">双击输入标题</span>';
                var cardDesc = (p.desc && p.desc.trim()) ? p.desc : '';
                return '<div class="block ios-card ' + cls + '" data-id="' + block.id + '" draggable="' + (layoutMode === 'flow') + '" style="background:' + s.bg + ';margin:' + (layoutMode === 'free' ? '0' : s.my + 'px ' + s.mx + 'px') + ';border-radius:' + s.radius + 'px;' + posStyle + '">' + actions + resizeHandles +
                    (p.showImg ? '<div class="ios-card-image" style="height:' + s.imgH + 'px;background:' + s.imgBg + ';color:' + s.imgColor + '"><i class="fas ' + p.imgIcon + '"></i></div>' : '') +
                    '<div class="ios-card-body" style="padding:' + s.py + 'px ' + s.px + 'px;background:' + s.bg + '"><div class="ios-card-title" style="color:' + s.titleColor + ';font-size:' + s.titleSize + 'px;font-weight:' + tw + '">' + cardTitle + '</div>' +
                    '<div class="ios-card-desc" style="color:' + s.descColor + ';font-size:' + s.descSize + 'px;font-weight:' + dw + '">' + cardDesc + '</div></div></div>';

            case 'button':
                var btnText = (p.text && p.text.trim()) ? p.text : '<span class="text-placeholder">按钮</span>';
                return '<div class="block ios-button ' + cls + '" data-id="' + block.id + '" draggable="' + (layoutMode === 'flow') + '" style="margin:' + (layoutMode === 'free' ? '0' : s.my + 'px ' + s.mx + 'px') + ';' + posStyle + '">' + actions + resizeHandles +
                    '<button style="background:' + s.bg + ';color:' + s.color + ';font-size:' + s.fontSize + 'px;font-weight:' + s.fontWeight + ';height:' + s.h + 'px;border-radius:' + s.radius + 'px">' + btnText + '</button></div>';

            case 'avatar-block':
                var nw = s.nameWeight || 600;
                var sw = s.subWeight || 400;
                var abRadius = s.radius ? 'border-radius:' + s.radius + 'px;' : '';
                var abHeight = s.h && s.h !== 'auto' ? 'height:' + s.h + 'px;' : '';
                var abAvatarRadius = s.avatarRadius !== undefined ? s.avatarRadius : Math.round(s.avatarSize / 2);
                var abName = (p.name && p.name.trim()) ? p.name : '<span class="text-placeholder">用户名</span>';
                var abSub = (p.subtitle && p.subtitle.trim()) ? p.subtitle : '';
                return '<div class="block ios-avatar-block ' + cls + '" data-id="' + block.id + '" draggable="' + (layoutMode === 'flow') + '" style="background:' + s.bg + ';padding:' + s.py + 'px ' + s.px + 'px;' + abRadius + abHeight + posStyle + '">' + actions + resizeHandles +
                    '<div class="ios-avatar" style="width:' + s.avatarSize + 'px;height:' + s.avatarSize + 'px;font-size:' + (s.avatarSize * 0.4) + 'px;background:' + s.avatarBg + ';color:' + s.avatarColor + ';border-radius:' + abAvatarRadius + 'px"><i class="fas ' + p.icon + '"></i></div>' +
                    '<div class="ios-avatar-name" style="color:' + s.nameColor + ';font-size:' + s.nameSize + 'px;font-weight:' + nw + '">' + abName + '</div>' +
                    '<div class="ios-avatar-subtitle" style="color:' + s.subColor + ';font-size:' + s.subSize + 'px;font-weight:' + sw + '">' + abSub + '</div></div>';

            case 'text-block':
                var tw = s.fontWeight || 400;
                var tbRadius = s.radius ? 'border-radius:' + s.radius + 'px;' : '';
                var tbHeight = s.h && s.h !== 'auto' ? 'height:' + s.h + 'px;' : '';
                var textContent = p.text || '';
                var textPlaceholder = !textContent.trim() ? ' data-placeholder="双击输入文本内容"' : '';
                var textDisplay = textContent.trim() ? p.text : '<span class="text-placeholder">双击输入文本内容</span>';
                return '<div class="block ios-text-block ' + cls + '" data-id="' + block.id + '" draggable="' + (layoutMode === 'flow') + '" style="background:' + s.bg + ';padding:' + s.py + 'px ' + s.px + 'px;' + tbRadius + tbHeight + posStyle + '">' + actions + resizeHandles +
                    '<p style="color:' + s.color + ';font-size:' + s.fontSize + 'px;font-weight:' + tw + ';line-height:' + s.lineHeight + '"' + textPlaceholder + '>' + textDisplay + '</p></div>';

            case 'icon':
                // Icon uses only position, no width constraint
                var iconPosStyle = layoutMode === 'free' ? 'left:' + (s.x || 0) + '%;top:' + (s.y || 0) + '%;' : '';
                return '<div class="block ios-icon-block ' + cls + '" data-id="' + block.id + '" draggable="' + (layoutMode === 'flow') + '" style="' + iconPosStyle + '">' + actions +
                    '<i class="fas ' + p.icon + '" style="color:' + s.color + ';font-size:' + s.fontSize + 'px"></i></div>';

            case 'number-picker':
                // Generate wheel items
                var wheelItems = '';
                var curr = p.value;
                var step = p.step || 1;
                for (var vi = -2; vi <= 2; vi++) {
                    var itemVal = curr + (vi * step);
                    var itemCls = vi === 0 ? 'active' : (Math.abs(vi) === 1 ? 'near' : 'far');
                    wheelItems += '<div class="ios-number-picker-item ' + itemCls + '">' + itemVal + '</div>';
                }
                var hStyle = s.h !== 'auto' ? 'height:' + s.h + 'px;' : '';
                return '<div class="block ios-number-picker ' + cls + '" data-id="' + block.id + '" draggable="' + (layoutMode === 'flow') + '" style="background:' + s.bg + ';border-radius:' + (s.radius || 0) + 'px;' + hStyle + posStyle + '">' + actions + resizeHandles +
                    '<span class="ios-number-picker-label" style="color:' + s.color + ';font-size:' + s.fontSize + 'px">' + p.label + '</span>' +
                    '<div style="display:flex;align-items:center;">' +
                    '<div class="ios-number-picker-wheel" style="height:' + (s.h !== 'auto' ? (s.h - 16) : 100) + 'px">' +
                    '<div class="ios-number-picker-highlight" style="background:' + s.highlightBg + ';border-color:' + s.borderColor + '"></div>' +
                    '<div class="ios-number-picker-scroll">' + wheelItems + '</div>' +
                    '<div class="ios-number-picker-arrows">' +
                    '<div class="ios-number-picker-arrow" data-action="increase" data-id="' + block.id + '"><i class="fas fa-chevron-up"></i></div>' +
                    '<div class="ios-number-picker-arrow" data-action="decrease" data-id="' + block.id + '"><i class="fas fa-chevron-down"></i></div>' +
                    '</div></div>' +
                    '<span class="ios-number-picker-unit" style="color:' + s.valueColor + '">' + (p.unit || '') + '</span>' +
                    '</div></div>';

            case 'option-item':
                var checkedCls = p.checked ? ' checked' : '';
                var optHStyle = s.h !== 'auto' ? 'height:' + s.h + 'px;' : '';
                return '<div class="block ios-option-item' + checkedCls + ' ' + cls + '" data-id="' + block.id + '" draggable="' + (layoutMode === 'flow') + '" style="background:' + s.bg + ';border-radius:' + (s.radius || 0) + 'px;' + optHStyle + posStyle + '">' + actions + resizeHandles +
                    '<div class="ios-option-item-left">' +
                    '<div class="ios-option-item-icon" style="border-color:' + (p.checked ? s.checkedColor : s.uncheckedColor) + ';background:' + (p.checked ? s.checkedBg : s.iconBg) + '"><i class="fas fa-check"></i></div>' +
                    '<div><div class="ios-option-item-text" style="color:' + s.color + ';font-size:' + s.fontSize + 'px">' + p.text + '</div>' +
                    (p.desc ? '<div class="ios-option-item-desc" style="color:' + s.descColor + ';font-size:' + s.descSize + 'px">' + p.desc + '</div>' : '') +
                    '</div></div></div>';

            case 'divider':
                var dvRadius = s.radius ? 'border-radius:' + s.radius + 'px;' : '';
                return '<div class="block ios-divider ' + cls + '" data-id="' + block.id + '" draggable="' + (layoutMode === 'flow') + '" style="background:' + s.bg + ';height:' + s.h + 'px;' + dvRadius + posStyle + '">' + actions + resizeHandles + '</div>';

            case 'spacer':
                return '<div class="block ios-spacer ' + cls + '" data-id="' + block.id + '" draggable="' + (layoutMode === 'flow') + '" style="height:' + s.h + 'px;' + posStyle + '">' + actions + resizeHandles + '</div>';

            case 'tabbar':
                var tabHtml = '<div class="block ios-tabbar ' + cls + '" data-id="' + block.id + '" style="background:' + s.bg + '">' + actions;
                for (var i = 0; i < p.items.length; i++) {
                    var item = p.items[i];
                    tabHtml += '<div class="ios-tabbar-item ' + (item.active ? 'active' : '') + '" style="color:' + (item.active ? s.activeColor : s.inactiveColor) + '" data-tab-idx="' + i + '"><i class="fas ' + item.icon + '"></i><span>' + (item.label || '') + '</span></div>';
                }
                return tabHtml + '</div>';

            case 'image-block':
                var imgRadius = s.radius ? 'border-radius:' + s.radius + 'px;' : '';
                return '<div class="block ios-image-block ' + cls + '" data-id="' + block.id + '" draggable="' + (layoutMode === 'flow') + '" style="background:' + s.bg + ';height:' + s.h + 'px;margin:' + (layoutMode === 'free' ? '0' : s.my + 'px ' + s.mx + 'px') + ';' + imgRadius + 'display:flex;align-items:center;justify-content:center;' + posStyle + '">' + actions + resizeHandles +
                    '<i class="fas ' + p.icon + '" style="font-size:48px;color:' + s.color + '"></i></div>';

            case 'badge':
                var badgeBg = p.type === 'primary' ? s.bg : (p.type === 'success' ? '#34c759' : (p.type === 'warning' ? '#ff9500' : s.bg));
                return '<div class="block ios-badge ' + cls + '" data-id="' + block.id + '" draggable="' + (layoutMode === 'flow') + '" style="display:inline-flex;background:' + badgeBg + ';color:' + s.color + ';font-size:' + s.fontSize + 'px;font-weight:' + s.fontWeight + ';padding:' + s.py + 'px ' + s.px + 'px;border-radius:' + s.radius + 'px;' + posStyle + '">' + actions + p.text + '</div>';

            case 'progress-bar':
                var pctVal = Math.min(100, Math.max(0, (p.value / p.max) * 100));
                return '<div class="block ios-progress-bar ' + cls + '" data-id="' + block.id + '" draggable="' + (layoutMode === 'flow') + '" style="margin:' + (layoutMode === 'free' ? '0' : s.my + 'px ' + s.mx + 'px') + ';' + posStyle + '">' + actions + resizeHandles +
                    '<div style="background:' + s.bg + ';height:' + s.h + 'px;border-radius:' + s.radius + 'px;overflow:hidden;position:relative;">' +
                    '<div style="background:' + s.barColor + ';height:100%;width:' + pctVal + '%;border-radius:' + s.radius + 'px;transition:width 0.3s;"></div></div>' +
                    (p.showLabel ? '<div style="text-align:center;font-size:12px;color:var(--text-secondary);margin-top:4px;">' + p.value + '/' + p.max + '</div>' : '') + '</div>';

            case 'rating':
                var ratingHtml = '<div class="block ios-rating ' + cls + '" data-id="' + block.id + '" draggable="' + (layoutMode === 'flow') + '" style="display:inline-flex;gap:4px;' + posStyle + '">' + actions;
                for (var ri = 1; ri <= p.max; ri++) {
                    var starColor = ri <= p.value ? s.color : s.emptyColor;
                    ratingHtml += '<i class="fas fa-star" style="font-size:' + s.fontSize + 'px;color:' + starColor + ';cursor:pointer;" data-rating="' + ri + '"></i>';
                }
                return ratingHtml + '</div>';

            case 'tag':
                return '<div class="block ios-tag ' + cls + '" data-id="' + block.id + '" draggable="' + (layoutMode === 'flow') + '" style="display:inline-flex;align-items:center;gap:4px;background:' + s.bg + ';color:' + s.color + ';font-size:' + s.fontSize + 'px;font-weight:' + s.fontWeight + ';padding:' + s.py + 'px ' + s.px + 'px;border-radius:' + s.radius + 'px;' + posStyle + '">' + actions +
                    p.text + (p.closable ? '<i class="fas fa-times" style="font-size:10px;cursor:pointer;"></i>' : '') + '</div>';

            case 'input-field':
                var ifRadius = s.radius ? 'border-radius:' + s.radius + 'px;' : '';
                return '<div class="block ios-input-field ' + cls + '" data-id="' + block.id + '" draggable="' + (layoutMode === 'flow') + '" style="background:' + s.bg + ';padding:' + s.py + 'px ' + s.px + 'px;' + ifRadius + posStyle + '">' + actions + resizeHandles +
                    '<div style="display:flex;align-items:center;gap:12px;"><label style="color:' + s.labelColor + ';font-size:' + s.fontSize + 'px;min-width:60px;">' + p.label + '</label>' +
                    '<input type="' + p.type + '" placeholder="' + p.placeholder + '" style="flex:1;background:' + s.inputBg + ';border:none;padding:10px 12px;border-radius:8px;font-size:' + s.fontSize + 'px;color:' + s.inputColor + '"></div></div>';

            case 'notice-bar':
                var nbRadius = s.radius ? 'border-radius:' + s.radius + 'px;' : '';
                return '<div class="block ios-notice-bar ' + cls + '" data-id="' + block.id + '" draggable="' + (layoutMode === 'flow') + '" style="background:' + s.bg + ';padding:' + s.py + 'px ' + s.px + 'px;display:flex;align-items:center;gap:8px;' + nbRadius + posStyle + '">' + actions + resizeHandles +
                    '<i class="fas ' + p.icon + '" style="color:' + s.iconColor + ';font-size:' + s.fontSize + 'px;"></i>' +
                    '<span style="flex:1;color:' + s.color + ';font-size:' + s.fontSize + 'px;">' + p.text + '</span>' +
                    (p.closable ? '<i class="fas fa-times" style="color:' + s.color + ';font-size:' + s.fontSize + 'px;cursor:pointer;"></i>' : '') + '</div>';

            case 'steps':
                var stepsHtml = '<div class="block ios-steps ' + cls + '" data-id="' + block.id + '" draggable="' + (layoutMode === 'flow') + '" style="background:' + s.bg + ';padding:' + s.py + 'px ' + s.px + 'px;' + posStyle + '">' + actions + resizeHandles +
                    '<div style="display:flex;align-items:center;justify-content:space-between;">';
                for (var si = 0; si < p.items.length; si++) {
                    var stepColor = si < p.current ? s.activeColor : s.inactiveColor;
                    var lineColor = si < p.current - 1 ? s.activeColor : s.lineColor;
                    stepsHtml += '<div style="display:flex;flex-direction:column;align-items:center;flex:1;position:relative;">';
                    stepsHtml += '<div style="width:20px;height:20px;border-radius:50%;background:' + stepColor + ';color:#fff;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:600;">' + (si + 1) + '</div>';
                    stepsHtml += '<span style="font-size:' + s.fontSize + 'px;color:' + stepColor + ';margin-top:4px;white-space:nowrap;">' + p.items[si] + '</span>';
                    if (si < p.items.length - 1) {
                        stepsHtml += '<div style="position:absolute;top:10px;left:calc(50% + 14px);right:calc(-50% + 14px);height:2px;background:' + lineColor + ';"></div>';
                    }
                    stepsHtml += '</div>';
                }
                return stepsHtml + '</div></div>';

            case 'bottom-button':
                return '<div class="block ios-bottom-button ' + cls + '" data-id="' + block.id + '" style="background:' + s.bg + ';display:flex;height:' + s.h + 'px;position:absolute;bottom:34px;left:0;right:0;border-top:1px solid var(--border-color);">' + actions +
                    (p.showLeft ? '<div style="flex:1;display:flex;align-items:center;justify-content:center;gap:6px;background:' + s.leftBg + ';color:' + s.leftColor + ';font-size:' + s.fontSize + 'px;"><i class="fas ' + p.leftIcon + '"></i>' + p.leftText + '</div>' : '') +
                    '<div style="flex:2;display:flex;align-items:center;justify-content:center;background:' + s.rightBg + ';color:' + s.rightColor + ';font-size:' + s.fontSize + 'px;font-weight:' + s.fontWeight + ';">' + p.rightText + '</div></div>';

            default: return '';
        }
    }

    function bindBlockEvents() {
        var blockEls = document.querySelectorAll('.block');
        for (var i = 0; i < blockEls.length; i++) {
            (function(el) {
                // Click select
                el.onclick = function(e) {
                    if (e.target.closest('.block-action-btn') || e.target.closest('.ios-toggle') || e.target.closest('.ios-tabbar-item') || e.target.closest('.resize-handle') || e.target.closest('.ios-number-picker-btn') || e.target.closest('.ios-option-item-icon')) return;
                    e.stopPropagation();
                    selectBlock(parseInt(el.getAttribute('data-id')), e.shiftKey);
                };

                // Free layout drag - 组件本体拖拽
                el.onmousedown = function(e) {
                    // 跳过特殊交互区域
                    if (e.target.closest('.block-action-btn') || e.target.closest('.ios-toggle') || e.target.closest('.ios-tabbar-item') || e.target.closest('.resize-handle') || e.target.closest('.ios-number-picker-btn') || e.target.closest('.overlay-drag-handle')) return;
                    // 允许输入元素正常获取焦点和输入
                    if (e.target.closest('input, textarea, [contenteditable]')) return;

                    var blockId = parseInt(el.getAttribute('data-id'));

                    // 使用统一的拖拽启动函数
                    if (initDrag(blockId, e)) {
                        e.preventDefault();
                        // 同时选中组件
                        selectBlock(blockId, false);
                    }
                };

                // Flow layout drag
                if (layoutMode === 'flow') {
                    el.ondragstart = function(e) {
                        draggedBlock = parseInt(el.getAttribute('data-id'));
                        el.classList.add('dragging');
                        e.dataTransfer.effectAllowed = 'move';
                    };

                    el.ondragover = function(e) {
                        e.preventDefault();
                        e.dataTransfer.dropEffect = 'move';
                        el.classList.add('drag-over');
                    };

                    el.ondragleave = function() {
                        el.classList.remove('drag-over');
                    };

                    el.ondrop = function(e) {
                        e.preventDefault();
                        el.classList.remove('drag-over');
                        var targetId = parseInt(el.getAttribute('data-id'));
                        if (draggedBlock !== null && draggedBlock !== targetId) {
                            reorderBlocks(draggedBlock, targetId);
                        }
                    };

                    el.ondragend = function() {
                        el.classList.remove('dragging');
                        draggedBlock = null;
                        var allBlocks = document.querySelectorAll('.block');
                        for (var j = 0; j < allBlocks.length; j++) {
                            allBlocks[j].classList.remove('drag-over');
                        }
                    };
                }
            })(blockEls[i]);
        }

        // Resize handles
        var resizeHandles = document.querySelectorAll('.resize-handle');
        for (var i = 0; i < resizeHandles.length; i++) {
            (function(handle) {
                handle.onmousedown = function(e) {
                    e.stopPropagation();
                    e.preventDefault();
                    var blockEl = handle.closest('.block');
                    var blockId = parseInt(blockEl.getAttribute('data-id'));
                    var block = findBlock(blockId);
                    if (!block) return;

                    var startX = e.clientX;
                    var startW = block.style.w || 100;
                    var canvas = document.getElementById('canvas');
                    var canvasRect = canvas.getBoundingClientRect();

                    function onMove(e) {
                        var deltaX = e.clientX - startX;
                        var deltaPercent = (deltaX / canvasRect.width) * 100;
                        var newW = Math.max(20, Math.min(100, startW + deltaPercent));
                        block.style.w = Math.round(newW * 10) / 10;
                        render();
                    }

                    function onUp() {
                        document.removeEventListener('mousemove', onMove);
                        document.removeEventListener('mouseup', onUp);
                    }

                    document.addEventListener('mousemove', onMove);
                    document.addEventListener('mouseup', onUp);
                };
            })(resizeHandles[i]);
        }

        // Action buttons
        var actionBtns = document.querySelectorAll('.block-action-btn[data-action]');
        for (var i = 0; i < actionBtns.length; i++) {
            (function(btn) {
                btn.onclick = function(e) {
                    e.stopPropagation();
                    var action = btn.getAttribute('data-action');
                    var id = parseInt(btn.getAttribute('data-id'));
                    if (action === 'up') moveBlock(id, -1);
                    else if (action === 'down') moveBlock(id, 1);
                    else if (action === 'copy') copyBlock(id);
                    else if (action === 'delete') deleteBlock(id);
                };
            })(actionBtns[i]);
        }

        // Toggle
        var toggles = document.querySelectorAll('.ios-toggle');
        for (var i = 0; i < toggles.length; i++) {
            (function(toggle) {
                toggle.onclick = function(e) {
                    e.stopPropagation();
                    var id = parseInt(toggle.getAttribute('data-toggle'));
                    var block = findBlock(id);
                    if (block) {
                        block.props.isOn = !block.props.isOn;
                        var s = block.style;
                        toggle.classList.toggle('on', block.props.isOn);
                        toggle.style.background = block.props.isOn ? (s.onColor || '#34c759') : (s.offColor || '#d2d2d7');
                    }
                };
            })(toggles[i]);
        }

        // Tab
        var tabItems = document.querySelectorAll('.ios-tabbar-item');
        for (var i = 0; i < tabItems.length; i++) {
            (function(item) {
                item.onclick = function(e) {
                    e.stopPropagation();
                    var blockEl = item.closest('.block');
                    var id = parseInt(blockEl.getAttribute('data-id'));
                    var idx = parseInt(item.getAttribute('data-tab-idx'));
                    var block = findBlock(id);
                    if (block) {
                        for (var j = 0; j < block.props.items.length; j++) {
                            block.props.items[j].active = j === idx;
                        }
                        render();
                    }
                };
            })(tabItems[i]);
        }

        // Number picker buttons
        var pickerBtns = document.querySelectorAll('.ios-number-picker-btn');
        for (var i = 0; i < pickerBtns.length; i++) {
            (function(btn) {
                btn.onclick = function(e) {
                    e.stopPropagation();
                    var action = btn.getAttribute('data-action');
                    var id = parseInt(btn.getAttribute('data-id'));
                    var block = findBlock(id);
                    if (block) {
                        var step = block.props.step || 1;
                        var min = block.props.min !== undefined ? block.props.min : 0;
                        var max = block.props.max !== undefined ? block.props.max : 100;
                        if (action === 'increase') {
                            block.props.value = Math.min(max, block.props.value + step);
                        } else if (action === 'decrease') {
                            block.props.value = Math.max(min, block.props.value - step);
                        }
                        render();
                        selectBlock(id, false);
                    }
                };
            })(pickerBtns[i]);
        }

        // Option item click
        var optionItems = document.querySelectorAll('.ios-option-item');
        for (var i = 0; i < optionItems.length; i++) {
            (function(item) {
                item.onclick = function(e) {
                    if (e.target.closest('.block-action-btn') || e.target.closest('.resize-handle')) return;
                    e.stopPropagation();
                    var id = parseInt(item.getAttribute('data-id'));
                    var block = findBlock(id);
                    if (block) {
                        block.props.checked = !block.props.checked;
                        render();
                        selectBlock(id, false);
                    }
                };
            })(optionItems[i]);
        }
    }

    // 更新独立覆盖层中的操作按钮
    function updateOverlayActions() {
        var overlay = document.getElementById('blockActionsOverlay');
        if (!overlay) return;

        // 清空覆盖层
        overlay.innerHTML = '';

        // 如果没有选中的组件，不显示操作按钮
        if (selectedIds.size === 0) return;

        var phoneFrame = document.querySelector('.phone-frame');
        var canvasArea = document.querySelector('.canvas-area');
        if (!phoneFrame || !canvasArea) return;

        var frameRect = phoneFrame.getBoundingClientRect();
        var areaRect = canvasArea.getBoundingClientRect();
        var overlayRect = overlay.getBoundingClientRect();

        // 为每个选中的组件创建操作按钮
        selectedIds.forEach(function(id) {
            var block = findBlock(id);
            if (!block) return;

            var blockEl = document.querySelector('.block[data-id="' + id + '"]');
            if (!blockEl) return;

            var blockRect = blockEl.getBoundingClientRect();

            // 计算相对于覆盖层的位置（考虑滚动）
            var top = blockRect.top - overlayRect.top;
            var left = blockRect.left - overlayRect.left;
            var width = blockRect.width;
            var right = blockRect.right - overlayRect.left;

            // 创建操作按钮容器
            var actionsDiv = document.createElement('div');
            actionsDiv.className = 'overlay-actions';
            actionsDiv.setAttribute('data-for-block', id);

            // 定位到组件右上角外侧，如果超出边界则调整位置
            var actionsWidth = 44; // 预估宽度
            var overlayWidth = overlayRect.width;
            var overlayHeight = overlayRect.height;

            // 默认定位到右侧
            var posTop = Math.max(8, top);
            var posLeft = right + 8;

            // 如果右侧超出边界，定位到左侧
            if (posLeft + actionsWidth > overlayWidth - 8) {
                posLeft = left - actionsWidth - 8;
                // 如果左侧也超出，定位到组件上方居中
                if (posLeft < 8) {
                    posLeft = left + width / 2;
                    posTop = top - 52;
                    actionsDiv.style.transform = 'translateX(-50%)';
                    actionsDiv.style.flexDirection = 'row';
                }
            }

            actionsDiv.style.top = Math.max(8, posTop) + 'px';
            actionsDiv.style.left = posLeft + 'px';

            // 根据组件类型生成按钮
            var isIcon = block.type === 'icon';
            var isTabbar = block.type === 'tabbar';

            // 六点拖拽手柄（所有组件都有）
            var dragHandle = document.createElement('div');
            dragHandle.className = 'overlay-drag-handle';
            dragHandle.innerHTML = '<div class="dot-col"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div><div class="dot-col"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>';
            dragHandle.setAttribute('data-drag-id', id);
            // 拖拽手柄的mousedown事件 - 启动拖拽（手柄拖拽无阈值，立即开始）
            dragHandle.onmousedown = function(e) {
                e.stopPropagation();
                e.preventDefault();
                if (initDrag(id, e)) {
                    // 手柄拖拽立即激活，无需等待阈值
                    activateDrag();
                }
            };
            actionsDiv.appendChild(dragHandle);

            if (!isIcon && !isTabbar && layoutMode === 'flow') {
                // 上移按钮
                var upBtn = document.createElement('button');
                upBtn.className = 'overlay-action-btn';
                upBtn.innerHTML = '<i class="fas fa-arrow-up"></i>';
                upBtn.onclick = function(e) { e.stopPropagation(); moveBlock(id, -1); };
                actionsDiv.appendChild(upBtn);

                // 下移按钮
                var downBtn = document.createElement('button');
                downBtn.className = 'overlay-action-btn';
                downBtn.innerHTML = '<i class="fas fa-arrow-down"></i>';
                downBtn.onclick = function(e) { e.stopPropagation(); moveBlock(id, 1); };
                actionsDiv.appendChild(downBtn);
            }

            // 复制按钮
            var copyBtn = document.createElement('button');
            copyBtn.className = 'overlay-action-btn';
            copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
            copyBtn.onclick = function(e) { e.stopPropagation(); copyBlock(id); };
            actionsDiv.appendChild(copyBtn);

            // 删除按钮
            var deleteBtn = document.createElement('button');
            deleteBtn.className = 'overlay-action-btn delete';
            deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
            deleteBtn.onclick = function(e) { e.stopPropagation(); deleteBlock(id); };
            actionsDiv.appendChild(deleteBtn);

            overlay.appendChild(actionsDiv);
        });
    }

    function reorderBlocks(fromId, toId) {
        var fromIdx = -1, toIdx = -1;
        for (var i = 0; i < blocks.length; i++) {
            if (blocks[i].id === fromId) fromIdx = i;
            if (blocks[i].id === toId) toIdx = i;
        }
        if (fromIdx > -1 && toIdx > -1) {
            var item = blocks.splice(fromIdx, 1)[0];
            blocks.splice(toIdx, 0, item);
            render();
        }
    }

    function findBlock(id) {
        for (var i = 0; i < blocks.length; i++) {
            if (blocks[i].id === id) return blocks[i];
        }
        return null;
    }

    function selectBlock(id, multi) {
        if (multi) {
            if (selectedIds.has(id)) selectedIds.delete(id);
            else selectedIds.add(id);
        } else {
            selectedIds.clear();
            selectedIds.add(id);
        }
        render();
        updateEditors();
    }

    function moveBlock(id, dir) {
        var idx = -1;
        for (var i = 0; i < blocks.length; i++) {
            if (blocks[i].id === id) { idx = i; break; }
        }
        var newIdx = idx + dir;
        if (newIdx >= 0 && newIdx < blocks.length) {
            var tmp = blocks[idx];
            blocks[idx] = blocks[newIdx];
            blocks[newIdx] = tmp;
            render();
        }
    }

    function copyBlock(id) {
        var block = findBlock(id);
        if (block) {
            var newBlock = {
                id: ++idCounter,
                type: block.type,
                props: JSON.parse(JSON.stringify(block.props)),
                style: JSON.parse(JSON.stringify(block.style))
            };
            // Offset position for free layout
            if (layoutMode === 'free') {
                newBlock.style.x = (newBlock.style.x || 0) + 5;
                newBlock.style.y = (newBlock.style.y || 0) + 5;
            }
            var idx = -1;
            for (var i = 0; i < blocks.length; i++) {
                if (blocks[i].id === id) { idx = i; break; }
            }
            blocks.splice(idx + 1, 0, newBlock);
            render();
            selectBlock(newBlock.id, false);
        }
    }

    function deleteBlock(id) {
        blocks = blocks.filter(function(b) { return b.id !== id; });
        selectedIds.delete(id);
        saveHistory();
        render();
        updateEditors();
    }

    function updateEditors() {
        var noSel = document.getElementById('noSelection');
        var noStyle = document.getElementById('noStyleSelection');
        var propsEditor = document.getElementById('propsEditor');
        var styleEditor = document.getElementById('styleEditor');

        if (selectedIds.size === 0) {
            noSel.style.display = 'block';
            noStyle.style.display = 'block';
            propsEditor.innerHTML = '';
            styleEditor.innerHTML = '';
            return;
        }

        noSel.style.display = 'none';
        noStyle.style.display = 'none';

        if (selectedIds.size > 1) {
            propsEditor.innerHTML = '<div class="multi-info"><h4>已选中 ' + selectedIds.size + ' 个组件</h4><p>在样式面板中批量调整外观</p></div>';
            styleEditor.innerHTML = genMultiStyleEditor();
        } else {
            var id = Array.from(selectedIds)[0];
            var block = findBlock(id);
            if (block) {
                propsEditor.innerHTML = genPropsEditor(block);
                styleEditor.innerHTML = genStyleEditor(block);
                bindEditorEvents(block);
            }
        }
    }

    function genPropsEditor(block) {
        var p = block.props;
        var html = '<div class="panel-section"><h3 class="panel-section-title">' + getTypeName(block.type) + '</h3>';

        switch (block.type) {
            case 'navbar':
                html += inp('标题', 'title', p.title, block.id) + inp('左侧', 'left', p.left, block.id) + inp('右侧', 'right', p.right, block.id);
                html += chk('显示左侧', 'showLeft', p.showLeft, block.id) + chk('显示右侧', 'showRight', p.showRight, block.id);
                break;
            case 'large-title': case 'section-header':
                html += inp('标题', 'title', p.title, block.id);
                break;
            case 'search':
                html += inp('占位文字', 'placeholder', p.placeholder, block.id);
                break;
            case 'list-item':
                html += inp('标题', 'title', p.title, block.id) + inp('副标题', 'subtitle', p.subtitle, block.id) + inp('右侧值', 'value', p.value, block.id);
                html += iconPicker('图标', 'icon', p.icon, block.id);
                html += colorPicker('图标背景', 'iconBg', p.iconBg, block.id, true);
                html += chk('显示箭头', 'arrow', p.arrow, block.id);
                break;
            case 'toggle-item':
                html += inp('标题', 'title', p.title, block.id) + chk('默认开启', 'isOn', p.isOn, block.id);
                break;
            case 'card':
                html += inp('标题', 'title', p.title, block.id) + txt('描述', 'desc', p.desc, block.id);
                html += chk('显示图片', 'showImg', p.showImg, block.id);
                html += iconPicker('图片图标', 'imgIcon', p.imgIcon, block.id);
                break;
            case 'button':
                html += inp('按钮文字', 'text', p.text, block.id);
                break;
            case 'avatar-block':
                html += inp('名称', 'name', p.name, block.id) + inp('副标题', 'subtitle', p.subtitle, block.id);
                html += iconPicker('图标', 'icon', p.icon, block.id);
                break;
            case 'text-block':
                html += txt('文本', 'text', p.text, block.id);
                break;
            case 'icon':
                html += iconPicker('图标', 'icon', p.icon, block.id);
                break;
            case 'number-picker':
                html += inp('标签文字', 'label', p.label, block.id);
                html += '<div class="property-row"><label class="property-label">数值</label><input type="number" class="property-input" data-prop="value" data-id="' + block.id + '" value="' + p.value + '"></div>';
                html += '<div class="property-row"><label class="property-label">最小值</label><input type="number" class="property-input" data-prop="min" data-id="' + block.id + '" value="' + p.min + '"></div>';
                html += '<div class="property-row"><label class="property-label">最大值</label><input type="number" class="property-input" data-prop="max" data-id="' + block.id + '" value="' + p.max + '"></div>';
                html += '<div class="property-row"><label class="property-label">步进值</label><input type="number" class="property-input" data-prop="step" data-id="' + block.id + '" value="' + p.step + '"></div>';
                html += inp('单位', 'unit', p.unit, block.id);
                break;
            case 'option-item':
                html += inp('选项文字', 'text', p.text, block.id);
                html += inp('描述文字', 'desc', p.desc, block.id);
                html += chk('选中状态', 'checked', p.checked, block.id);
                break;
            case 'image-block':
                html += iconPicker('占位图标', 'icon', p.icon, block.id);
                html += '<div class="property-row"><label class="property-label">宽高比</label><select class="property-input" data-prop="aspectRatio" data-id="' + block.id + '">' +
                    '<option value="16:9"' + (p.aspectRatio === '16:9' ? ' selected' : '') + '>16:9</option>' +
                    '<option value="4:3"' + (p.aspectRatio === '4:3' ? ' selected' : '') + '>4:3</option>' +
                    '<option value="1:1"' + (p.aspectRatio === '1:1' ? ' selected' : '') + '>1:1</option>' +
                    '</select></div>';
                break;
            case 'badge':
                html += inp('文字', 'text', p.text, block.id);
                html += '<div class="property-row"><label class="property-label">类型</label><select class="property-input" data-prop="type" data-id="' + block.id + '">' +
                    '<option value="primary"' + (p.type === 'primary' ? ' selected' : '') + '>主要</option>' +
                    '<option value="success"' + (p.type === 'success' ? ' selected' : '') + '>成功</option>' +
                    '<option value="warning"' + (p.type === 'warning' ? ' selected' : '') + '>警告</option>' +
                    '</select></div>';
                break;
            case 'progress-bar':
                html += '<div class="property-row"><label class="property-label">当前值</label><input type="number" class="property-input" data-prop="value" data-id="' + block.id + '" value="' + p.value + '" min="0" max="' + p.max + '"></div>';
                html += '<div class="property-row"><label class="property-label">最大值</label><input type="number" class="property-input" data-prop="max" data-id="' + block.id + '" value="' + p.max + '"></div>';
                html += chk('显示标签', 'showLabel', p.showLabel, block.id);
                break;
            case 'rating':
                html += '<div class="property-row"><label class="property-label">评分值</label><input type="number" class="property-input" data-prop="value" data-id="' + block.id + '" value="' + p.value + '" min="0" max="' + p.max + '"></div>';
                html += '<div class="property-row"><label class="property-label">最大星数</label><input type="number" class="property-input" data-prop="max" data-id="' + block.id + '" value="' + p.max + '" min="1" max="10"></div>';
                break;
            case 'tag':
                html += inp('标签文字', 'text', p.text, block.id);
                html += chk('可关闭', 'closable', p.closable, block.id);
                break;
            case 'input-field':
                html += inp('标签', 'label', p.label, block.id);
                html += inp('占位文字', 'placeholder', p.placeholder, block.id);
                html += '<div class="property-row"><label class="property-label">输入类型</label><select class="property-input" data-prop="type" data-id="' + block.id + '">' +
                    '<option value="text"' + (p.type === 'text' ? ' selected' : '') + '>文本</option>' +
                    '<option value="password"' + (p.type === 'password' ? ' selected' : '') + '>密码</option>' +
                    '<option value="number"' + (p.type === 'number' ? ' selected' : '') + '>数字</option>' +
                    '<option value="email"' + (p.type === 'email' ? ' selected' : '') + '>邮箱</option>' +
                    '</select></div>';
                break;
            case 'notice-bar':
                html += inp('通知文字', 'text', p.text, block.id);
                html += iconPicker('图标', 'icon', p.icon, block.id);
                html += chk('可关闭', 'closable', p.closable, block.id);
                break;
            case 'steps':
                html += '<div class="property-row"><label class="property-label">当前步骤</label><input type="number" class="property-input" data-prop="current" data-id="' + block.id + '" value="' + p.current + '" min="0" max="' + p.items.length + '"></div>';
                break;
            case 'bottom-button':
                html += inp('左侧文字', 'leftText', p.leftText, block.id);
                html += iconPicker('左侧图标', 'leftIcon', p.leftIcon, block.id);
                html += inp('右侧文字', 'rightText', p.rightText, block.id);
                html += chk('显示左侧', 'showLeft', p.showLeft, block.id);
                break;
        }
        return html + '</div>';
    }

    // Determine if a component has a shape (rectangle/square)
    function isShapedComponent(type) {
        var shapedTypes = ['navbar', 'large-title', 'search', 'section-header', 'list-item', 'toggle-item', 'card', 'button', 'avatar-block', 'text-block', 'number-picker', 'option-item', 'divider', 'image-block', 'progress-bar', 'input-field', 'notice-bar', 'steps', 'bottom-button'];
        return shapedTypes.indexOf(type) >= 0;
    }

    function genStyleEditor(block) {
        var s = block.style;
        var html = '';

        // Position section for free layout
        if (layoutMode === 'free' && block.type !== 'tabbar') {
            html += '<div class="panel-section"><h3 class="panel-section-title">位置与尺寸</h3>';
            html += '<div class="position-grid">';
            html += '<div class="position-item"><label>X 位置 (%)</label><input type="number" data-style="x" data-id="' + block.id + '" value="' + (s.x || 0) + '" step="1"></div>';
            html += '<div class="position-item"><label>Y 位置 (%)</label><input type="number" data-style="y" data-id="' + block.id + '" value="' + (s.y || 0) + '" step="1"></div>';
            html += '<div class="position-item"><label>宽度 (%)</label><input type="number" data-style="w" data-id="' + block.id + '" value="' + (s.w || 100) + '" min="10" max="100" step="1"></div>';
            html += '</div>';
            // Add height control for shaped components
            if (isShapedComponent(block.type)) {
                var hVal = s.h !== undefined ? (s.h === 'auto' ? 'auto' : s.h) : 'auto';
                html += '<div class="property-row" style="margin-top:8px;"><label class="property-label">高度 (px, 或 auto)</label><input type="text" class="property-input" data-style="h" data-id="' + block.id + '" value="' + hVal + '" placeholder="auto 或 数字"></div>';
            }
            html += '</div>';
        }

        // Radius and height control for shaped components (always show, not just in free layout)
        if (isShapedComponent(block.type)) {
            html += '<div class="panel-section"><h3 class="panel-section-title">形状</h3>';
            html += slider('圆角半径', 'radius', s.radius || 0, 0, 50, 'px', block.id);
            // Add height control if not already shown in position section
            if (layoutMode !== 'free') {
                var hVal = s.h !== undefined ? (s.h === 'auto' ? 'auto' : s.h) : 'auto';
                html += '<div class="property-row"><label class="property-label">高度 (px, 或 auto)</label><input type="text" class="property-input" data-style="h" data-id="' + block.id + '" value="' + hVal + '" placeholder="auto 或 数字"></div>';
            }
            html += '</div>';
        }

        html += '<div class="panel-section"><h3 class="panel-section-title">颜色</h3>';
        if (s.bg !== undefined) html += colorPicker('背景色', 'bg', s.bg, block.id);
        if (s.color !== undefined) html += colorPicker('文字颜色', 'color', s.color, block.id);
        if (s.titleColor !== undefined) html += colorPicker('标题颜色', 'titleColor', s.titleColor, block.id);
        if (s.subColor !== undefined) html += colorPicker('副标题颜色', 'subColor', s.subColor, block.id);
        if (s.valueColor !== undefined) html += colorPicker('值颜色', 'valueColor', s.valueColor, block.id);
        if (s.descColor !== undefined) html += colorPicker('描述颜色', 'descColor', s.descColor, block.id);
        if (s.nameColor !== undefined) html += colorPicker('名称颜色', 'nameColor', s.nameColor, block.id);
        if (s.btnColor !== undefined) html += colorPicker('按钮颜色', 'btnColor', s.btnColor, block.id);
        if (s.inputBg !== undefined) html += colorPicker('输入框背景', 'inputBg', s.inputBg, block.id);
        if (s.placeholderColor !== undefined) html += colorPicker('占位符颜色', 'placeholderColor', s.placeholderColor, block.id);
        if (s.imgColor !== undefined) html += colorPicker('图片图标颜色', 'imgColor', s.imgColor, block.id);
        if (s.avatarColor !== undefined) html += colorPicker('头像图标颜色', 'avatarColor', s.avatarColor, block.id);
        if (s.onColor !== undefined) html += colorPicker('开启颜色', 'onColor', s.onColor, block.id);
        if (s.offColor !== undefined) html += colorPicker('关闭颜色', 'offColor', s.offColor, block.id);
        if (s.activeColor !== undefined) html += colorPicker('激活颜色', 'activeColor', s.activeColor, block.id);
        if (s.inactiveColor !== undefined) html += colorPicker('未激活颜色', 'inactiveColor', s.inactiveColor, block.id);

        html += '</div><div class="panel-section"><h3 class="panel-section-title">字体</h3>';
        if (s.fontSize !== undefined) html += slider('字体大小', 'fontSize', s.fontSize, 10, 48, 'px', block.id);
        if (s.titleSize !== undefined) html += slider('标题大小', 'titleSize', s.titleSize, 10, 48, 'px', block.id);
        if (s.subSize !== undefined) html += slider('副标题大小', 'subSize', s.subSize, 10, 24, 'px', block.id);
        if (s.descSize !== undefined) html += slider('描述大小', 'descSize', s.descSize, 10, 24, 'px', block.id);
        if (s.nameSize !== undefined) html += slider('名称大小', 'nameSize', s.nameSize, 10, 36, 'px', block.id);

        // Font weight for all text components
        if (s.fontWeight !== undefined) html += weightPicker('fontWeight', s.fontWeight, block.id, '字重');
        if (s.titleWeight !== undefined) html += weightPicker('titleWeight', s.titleWeight, block.id, '标题字重');
        if (s.subWeight !== undefined) html += weightPicker('subWeight', s.subWeight, block.id, '副标题字重');
        if (s.descWeight !== undefined) html += weightPicker('descWeight', s.descWeight, block.id, '描述字重');
        if (s.nameWeight !== undefined) html += weightPicker('nameWeight', s.nameWeight, block.id, '名称字重');

        if (s.lineHeight !== undefined) html += slider('行高', 'lineHeight', s.lineHeight, 1, 2.5, '', block.id, 0.1);

        html += '</div><div class="panel-section"><h3 class="panel-section-title">间距与尺寸</h3>';
        if (s.py !== undefined || s.px !== undefined) {
            html += '<div class="number-input-group">';
            if (s.py !== undefined) html += numInput('上下边距', 'py', s.py, block.id);
            if (s.px !== undefined) html += numInput('左右边距', 'px', s.px, block.id);
            html += '</div>';
        }
        if (s.my !== undefined || s.mx !== undefined) {
            html += '<div class="number-input-group" style="margin-top:8px;">';
            if (s.my !== undefined) html += numInput('上下外边距', 'my', s.my, block.id);
            if (s.mx !== undefined) html += numInput('左右外边距', 'mx', s.mx, block.id);
            html += '</div>';
        }
        if (s.imgH !== undefined) html += slider('图片高度', 'imgH', s.imgH, 80, 300, 'px', block.id);
        if (s.iconSize !== undefined) html += slider('图标大小', 'iconSize', s.iconSize, 20, 60, 'px', block.id);
        if (s.iconRadius !== undefined) html += slider('图标圆角', 'iconRadius', s.iconRadius, 0, 30, 'px', block.id);
        if (s.avatarSize !== undefined) html += slider('头像大小', 'avatarSize', s.avatarSize, 40, 200, 'px', block.id);
        if (s.avatarRadius !== undefined) html += slider('头像圆角', 'avatarRadius', s.avatarRadius, 0, 100, 'px', block.id);

        return html + '</div>';
    }

    function genMultiStyleEditor() {
        return '<div class="multi-info"><h4>批量调整</h4></div>' +
            '<div class="panel-section"><h3 class="panel-section-title">背景</h3>' +
            '<div class="color-row"><input type="color" class="color-picker" id="multiBg" value="#ffffff"><input type="text" class="property-input" style="flex:1" value="#ffffff"></div>' +
            '<div class="color-presets">' + colors.map(function(c) { return '<div class="color-preset" style="background:' + c + '" onclick="window.updateMultiStyle(\'bg\',\'' + c + '\')"></div>'; }).join('') + '</div></div>' +
            '<div class="panel-section"><h3 class="panel-section-title">文字</h3>' +
            '<div class="color-row"><input type="color" class="color-picker" id="multiColor" value="#1d1d1f"><input type="text" class="property-input" style="flex:1" value="#1d1d1f"></div>' +
            '<div class="color-presets">' + colors.map(function(c) { return '<div class="color-preset" style="background:' + c + '" onclick="window.updateMultiStyle(\'color\',\'' + c + '\')"></div>'; }).join('') + '</div></div>' +
            '<div class="panel-section"><h3 class="panel-section-title">字重</h3>' +
            '<div class="segment-control">' +
            [300, 400, 500, 600, 700].map(function(w) { return '<div class="segment-option" onclick="window.updateMultiStyle(\'fontWeight\',' + w + ')">' + (w === 300 ? 'Light' : w === 400 ? 'Reg' : w === 500 ? 'Med' : w === 600 ? 'Semi' : 'Bold') + '</div>'; }).join('') + '</div></div>';
    }

    // Helpers
    function inp(label, prop, val, id) { return '<div class="property-row"><label class="property-label">' + label + '</label><input type="text" class="property-input" data-prop="' + prop + '" data-id="' + id + '" value="' + (val || '') + '"></div>'; }
    function txt(label, prop, val, id) { return '<div class="property-row"><label class="property-label">' + label + '</label><textarea class="property-input property-textarea" data-prop="' + prop + '" data-id="' + id + '">' + (val || '') + '</textarea></div>'; }
    function chk(label, prop, val, id) { return '<div class="property-row"><div class="checkbox-row"><input type="checkbox" data-prop="' + prop + '" data-id="' + id + '" ' + (val ? 'checked' : '') + '><label>' + label + '</label></div></div>'; }
    function colorPicker(label, prop, val, id, isProp) {
        var attr = isProp ? 'data-prop' : 'data-style';
        return '<div class="property-row"><label class="property-label">' + label + '</label><div class="color-row"><input type="color" class="color-picker" ' + attr + '="' + prop + '" data-id="' + id + '" value="' + val + '"><input type="text" class="property-input color-hex-input" ' + attr + '-hex="' + prop + '" data-id="' + id + '" style="flex:1" value="' + val + '" placeholder="#000000"></div>' +
            '<div class="color-presets">' + colors.slice(0, 10).map(function(c) { return '<div class="color-preset" style="background:' + c + '" ' + attr + '="' + prop + '" data-id="' + id + '" data-color="' + c + '"></div>'; }).join('') + '</div></div>';
    }
    function iconPicker(label, prop, val, id) {
        var html = '<div class="property-row"><label class="property-label">' + label + '</label><div class="icon-grid-container">';
        Object.keys(iconCategories).forEach(function(cat) {
            html += '<div class="icon-category-label">' + cat + '</div><div class="icon-grid">';
            html += iconCategories[cat].map(function(icon) {
                var iconName = iconNames[icon] || '';
                return '<div class="icon-option ' + (val === icon ? 'selected' : '') + '" data-prop="' + prop + '" data-id="' + id + '" data-icon="' + icon + '" data-name="' + iconName + '"><i class="fas ' + icon + '"></i></div>';
            }).join('');
            html += '</div>';
        });
        return html + '</div></div>';
    }
    function slider(label, prop, val, min, max, unit, id, step) {
        step = step || 1;
        return '<div class="property-row"><label class="property-label">' + label + '</label><div class="slider-row"><input type="range" class="property-slider" data-style="' + prop + '" data-id="' + id + '" min="' + min + '" max="' + max + '" step="' + step + '" value="' + val + '"><span class="slider-value">' + val + unit + '</span></div></div>';
    }
    function weightPicker(prop, val, id, label) {
        label = label || '字重';
        return '<div class="property-row"><label class="property-label">' + label + '</label><div class="segment-control">' +
            [300, 400, 500, 600, 700].map(function(w) { return '<div class="segment-option ' + (val === w ? 'active' : '') + '" data-style="' + prop + '" data-id="' + id + '" data-val="' + w + '">' + (w === 300 ? 'Light' : w === 400 ? 'Reg' : w === 500 ? 'Med' : w === 600 ? 'Semi' : 'Bold') + '</div>'; }).join('') + '</div></div>';
    }
    function numInput(label, prop, val, id) { return '<div class="number-input-item"><label>' + label + '</label><input type="number" data-style="' + prop + '" data-id="' + id + '" value="' + val + '"></div>'; }

    function bindEditorEvents(block) {
        var propInputs = document.querySelectorAll('[data-prop][data-id="' + block.id + '"]');
        for (var i = 0; i < propInputs.length; i++) {
            (function(el) {
                if (el.type === 'checkbox') {
                    el.onchange = function() { block.props[el.getAttribute('data-prop')] = el.checked; render(); };
                } else if (el.type === 'color') {
                    el.oninput = function() { block.props[el.getAttribute('data-prop')] = el.value; el.nextElementSibling.value = el.value; render(); };
                } else if (el.classList.contains('icon-option')) {
                    el.onclick = function() { block.props[el.getAttribute('data-prop')] = el.getAttribute('data-icon'); render(); updateEditors(); };
                    // 添加图标hover tooltip
                    var iconName = el.getAttribute('data-name');
                    if (iconName && typeof window.showTooltip === 'function') {
                        el.onmouseenter = function() { window.showTooltip(el, iconName); };
                        el.onmouseleave = function() { window.hideTooltip(); };
                    }
                } else if (el.classList.contains('color-preset')) {
                    el.onclick = function() { block.props[el.getAttribute('data-prop')] = el.getAttribute('data-color'); render(); updateEditors(); };
                } else if (el.tagName === 'TEXTAREA') {
                    // For textarea, update on input for real-time preview
                    el.oninput = function() {
                        block.props[el.getAttribute('data-prop')] = el.value;
                        // Update the component text directly without full re-render
                        var blockEl = document.querySelector('.block[data-id="' + block.id + '"]');
                        if (blockEl) {
                            var textEl = blockEl.querySelector('p');
                            if (textEl) textEl.textContent = el.value;
                        }
                    };
                } else {
                    el.oninput = function() { block.props[el.getAttribute('data-prop')] = el.value; render(); };
                }
            })(propInputs[i]);
        }

        var styleInputs = document.querySelectorAll('[data-style][data-id="' + block.id + '"]');
        for (var i = 0; i < styleInputs.length; i++) {
            (function(el) {
                if (el.type === 'range') {
                    el.oninput = function() {
                        var val = el.step == 1 ? parseInt(el.value) : parseFloat(el.value);
                        block.style[el.getAttribute('data-style')] = val;
                        el.nextElementSibling.textContent = el.value + (el.step == 1 ? 'px' : '');
                        render();
                    };
                } else if (el.type === 'color') {
                    el.oninput = function() { block.style[el.getAttribute('data-style')] = el.value; el.nextElementSibling.value = el.value; render(); };
                } else if (el.type === 'number') {
                    el.onchange = function() {
                        var val = parseFloat(el.value);
                        block.style[el.getAttribute('data-style')] = val;
                        render();
                    };
                } else if (el.type === 'text' && el.getAttribute('data-style') === 'h') {
                    // Special handling for height that accepts 'auto' or number
                    el.onchange = function() {
                        var val = el.value.trim().toLowerCase();
                        if (val === 'auto' || val === '') {
                            block.style.h = 'auto';
                        } else {
                            var num = parseFloat(val);
                            if (!isNaN(num) && num > 0) {
                                block.style.h = num;
                            }
                        }
                        render();
                    };
                } else if (el.classList.contains('segment-option')) {
                    el.onclick = function() { block.style[el.getAttribute('data-style')] = parseInt(el.getAttribute('data-val')); render(); updateEditors(); };
                } else if (el.classList.contains('color-preset')) {
                    el.onclick = function() { block.style[el.getAttribute('data-style')] = el.getAttribute('data-color'); render(); updateEditors(); };
                }
            })(styleInputs[i]);
        }

        // Color hex input for props
        var propHexInputs = document.querySelectorAll('[data-prop-hex][data-id="' + block.id + '"]');
        for (var i = 0; i < propHexInputs.length; i++) {
            (function(el) {
                el.oninput = function() {
                    var val = el.value.trim();
                    if (/^#[0-9A-Fa-f]{6}$/.test(val) || /^#[0-9A-Fa-f]{3}$/.test(val)) {
                        var prop = el.getAttribute('data-prop-hex');
                        block.props[prop] = val;
                        var colorPicker = el.previousElementSibling;
                        if (colorPicker && colorPicker.type === 'color') {
                            colorPicker.value = val.length === 4 ? '#' + val[1]+val[1]+val[2]+val[2]+val[3]+val[3] : val;
                        }
                        render();
                    }
                };
            })(propHexInputs[i]);
        }

        // Color hex input for styles
        var styleHexInputs = document.querySelectorAll('[data-style-hex][data-id="' + block.id + '"]');
        for (var i = 0; i < styleHexInputs.length; i++) {
            (function(el) {
                el.oninput = function() {
                    var val = el.value.trim();
                    if (/^#[0-9A-Fa-f]{6}$/.test(val) || /^#[0-9A-Fa-f]{3}$/.test(val)) {
                        var prop = el.getAttribute('data-style-hex');
                        block.style[prop] = val;
                        var colorPicker = el.previousElementSibling;
                        if (colorPicker && colorPicker.type === 'color') {
                            colorPicker.value = val.length === 4 ? '#' + val[1]+val[1]+val[2]+val[2]+val[3]+val[3] : val;
                        }
                        render();
                    }
                };
            })(styleHexInputs[i]);
        }
    }

    window.updateMultiStyle = function(prop, val) {
        selectedIds.forEach(function(id) {
            var block = findBlock(id);
            if (block && block.style[prop] !== undefined) block.style[prop] = val;
        });
        render();
    };

    function getTypeName(type) {
        var names = { navbar: '顶部导航', 'large-title': '页面标题', search: '搜索', 'section-header': '小标题', 'list-item': '列表', 'toggle-item': '开关', card: '信息卡片', button: '按钮', 'avatar-block': '头像', 'text-block': '正文文本', icon: '图标', 'number-picker': '数字选择', 'option-item': '单选 / 多选', divider: '分割线', spacer: '留白', tabbar: '底部导航', 'image-block': '图片', badge: '徽章', 'progress-bar': '进度条', rating: '评分', tag: '标签', 'input-field': '输入框', 'notice-bar': '通知栏', steps: '步骤条', 'bottom-button': '底部按钮' };
        return names[type] || type;
    }

    // Modal
    function showModal() {
        document.getElementById('modalTitle').textContent = modalSettings.title;
        document.getElementById('modalBody').textContent = modalSettings.body;
        document.getElementById('modalCancelBtn').textContent = modalSettings.cancel;
        document.getElementById('modalConfirmBtn').textContent = modalSettings.confirm;
        document.getElementById('iosModal').classList.add('show');
    }
    function hideModal() {
        document.getElementById('iosModal').classList.remove('show');
    }

    // Toast
    function showToast() {
        var toast = document.getElementById('toast');
        toast.textContent = toastSettings.text;
        toast.classList.add('show');
        setTimeout(function() { toast.classList.remove('show'); }, toastSettings.duration * 1000);
    }

    // Editor modals
    window.openEditorModal = function(id) {
        if (id === 'modalEditor') {
            document.getElementById('modalTitleInput').value = modalSettings.title;
            document.getElementById('modalBodyInput').value = modalSettings.body;
            document.getElementById('modalCancelInput').value = modalSettings.cancel;
            document.getElementById('modalConfirmInput').value = modalSettings.confirm;
        } else if (id === 'toastEditor') {
            document.getElementById('toastTextInput').value = toastSettings.text;
            document.getElementById('toastDurationInput').value = toastSettings.duration;
            document.getElementById('toastDurationValue').textContent = toastSettings.duration + 's';
        }
        document.getElementById(id).classList.add('show');
    };

    window.closeEditorModal = function(id) {
        document.getElementById(id).classList.remove('show');
    };

    window.saveModalSettings = function() {
        modalSettings.title = document.getElementById('modalTitleInput').value;
        modalSettings.body = document.getElementById('modalBodyInput').value;
        modalSettings.cancel = document.getElementById('modalCancelInput').value;
        modalSettings.confirm = document.getElementById('modalConfirmInput').value;
        closeEditorModal('modalEditor');
        showToast();
    };

    window.saveToastSettings = function() {
        toastSettings.text = document.getElementById('toastTextInput').value;
        toastSettings.duration = parseInt(document.getElementById('toastDurationInput').value);
        closeEditorModal('toastEditor');
        showToast();
    };

    // ==================== Style Template Functions ====================

    function openTemplateModal(modalId) {
        if (modalId === 'colorTemplateModal') {
            renderColorTemplateList();
        } else if (modalId === 'fontTemplateModal') {
            renderFontTemplateList();
        }
        document.getElementById(modalId).classList.add('show');
    }

    window.closeTemplateModal = function(modalId) {
        document.getElementById(modalId).classList.remove('show');
    };

    function openApplyTemplateModal() {
        renderApplyColorList();
        renderApplyFontList();
        document.getElementById('applyTemplateModal').classList.add('show');
    }

    // Color Templates
    function renderColorTemplateList() {
        var list = document.getElementById('colorTemplateList');
        if (colorTemplates.length === 0) {
            list.innerHTML = '<div class="empty-template"><i class="fas fa-palette"></i><p>暂无预设颜色</p></div>';
            return;
        }
        var html = '';
        colorTemplates.forEach(function(t, idx) {
            html += '<div class="template-item">' +
                '<div class="template-color-preview" style="background:' + t.color + '"></div>' +
                '<div class="template-info">' +
                '<div class="template-name">' + t.name + '</div>' +
                '<div class="template-meta">' + t.color + ' · ' + (t.usage || '无备注') + '</div>' +
                '</div>' +
                '<div class="template-actions">' +
                '<button class="template-action-btn delete" onclick="deleteColorTemplate(' + idx + ')"><i class="fas fa-trash"></i></button>' +
                '</div></div>';
        });
        list.innerHTML = html;
    }

    window.addColorTemplate = function() {
        var name = document.getElementById('colorName').value.trim();
        var color = document.getElementById('colorValue').value;
        var usage = document.getElementById('colorUsage').value.trim();
        if (!name) { alert('请输入颜色名称'); return; }
        colorTemplates.push({ name: name, color: color, usage: usage });
        localStorage.setItem('colorTemplates', JSON.stringify(colorTemplates));
        document.getElementById('colorName').value = '';
        document.getElementById('colorUsage').value = '';
        renderColorTemplateList();
    };

    window.deleteColorTemplate = function(idx) {
        colorTemplates.splice(idx, 1);
        localStorage.setItem('colorTemplates', JSON.stringify(colorTemplates));
        renderColorTemplateList();
    };

    // Font Templates
    function renderFontTemplateList() {
        var list = document.getElementById('fontTemplateList');
        if (fontTemplates.length === 0) {
            list.innerHTML = '<div class="empty-template"><i class="fas fa-font"></i><p>暂无预设字体</p></div>';
            return;
        }
        var html = '';
        fontTemplates.forEach(function(t, idx) {
            var weightName = {300:'Light',400:'Regular',500:'Medium',600:'Semibold',700:'Bold'}[t.weight] || t.weight;
            html += '<div class="template-item">' +
                '<div class="template-color-preview" style="background:' + t.color + ';display:flex;align-items:center;justify-content:center;font-size:' + Math.min(t.size, 20) + 'px;font-weight:' + t.weight + ';color:#fff;text-shadow:0 1px 2px rgba(0,0,0,0.3)">Aa</div>' +
                '<div class="template-info">' +
                '<div class="template-name">' + t.name + '</div>' +
                '<div class="template-meta">' + t.size + 'px · ' + weightName + ' · ' + (t.usage || '无备注') + '</div>' +
                '</div>' +
                '<div class="template-actions">' +
                '<button class="template-action-btn delete" onclick="deleteFontTemplate(' + idx + ')"><i class="fas fa-trash"></i></button>' +
                '</div></div>';
        });
        list.innerHTML = html;
    }

    window.addFontTemplate = function() {
        var name = document.getElementById('fontName').value.trim();
        var size = parseInt(document.getElementById('fontSize').value);
        var weight = parseInt(document.getElementById('fontWeight').value);
        var color = document.getElementById('fontColor').value;
        var usage = document.getElementById('fontUsage').value.trim();
        if (!name) { alert('请输入样式名称'); return; }
        fontTemplates.push({ name: name, size: size, weight: weight, color: color, usage: usage });
        localStorage.setItem('fontTemplates', JSON.stringify(fontTemplates));
        document.getElementById('fontName').value = '';
        document.getElementById('fontUsage').value = '';
        renderFontTemplateList();
    };

    window.deleteFontTemplate = function(idx) {
        fontTemplates.splice(idx, 1);
        localStorage.setItem('fontTemplates', JSON.stringify(fontTemplates));
        renderFontTemplateList();
    };

    // Apply Templates
    function renderApplyColorList() {
        var container = document.getElementById('applyColorList');
        if (colorTemplates.length === 0) {
            container.innerHTML = '<div style="color:var(--text-tertiary);font-size:13px;padding:10px 0;">暂无预设颜色</div>';
            return;
        }
        var html = '<div style="display:flex;flex-wrap:wrap;gap:8px;">';
        colorTemplates.forEach(function(t, idx) {
            html += '<label style="display:flex;align-items:center;gap:6px;padding:8px 12px;background:var(--bg-primary);border-radius:6px;cursor:pointer;font-size:13px;">' +
                '<input type="checkbox" name="applyColor" value="' + idx + '">' +
                '<span style="width:16px;height:16px;border-radius:4px;background:' + t.color + '"></span>' +
                t.name + '</label>';
        });
        container.innerHTML = html + '</div>';
    }

    function renderApplyFontList() {
        var container = document.getElementById('applyFontList');
        if (fontTemplates.length === 0) {
            container.innerHTML = '<div style="color:var(--text-tertiary);font-size:13px;padding:10px 0;">暂无预设字体</div>';
            return;
        }
        var html = '<div style="display:flex;flex-wrap:wrap;gap:8px;">';
        fontTemplates.forEach(function(t, idx) {
            html += '<label style="display:flex;align-items:center;gap:6px;padding:8px 12px;background:var(--bg-primary);border-radius:6px;cursor:pointer;font-size:13px;">' +
                '<input type="checkbox" name="applyFont" value="' + idx + '">' +
                '<span style="font-size:' + Math.min(t.size, 16) + 'px;font-weight:' + t.weight + ';color:' + t.color + '">Aa</span> ' +
                t.name + '</label>';
        });
        container.innerHTML = html + '</div>';
    }

    window.applyStyleTemplate = function() {
        var applyToAll = document.getElementById('applyToAll').checked;
        var applyToSelected = document.getElementById('applyToSelected').checked;

        // Get selected colors
        var selectedColors = [];
        document.querySelectorAll('input[name="applyColor"]:checked').forEach(function(el) {
            selectedColors.push(colorTemplates[parseInt(el.value)]);
        });

        // Get selected fonts
        var selectedFonts = [];
        document.querySelectorAll('input[name="applyFont"]:checked').forEach(function(el) {
            selectedFonts.push(fontTemplates[parseInt(el.value)]);
        });

        if (selectedColors.length === 0 && selectedFonts.length === 0) {
            alert('请选择至少一个预设');
            return;
        }

        // Determine which blocks to apply to
        var targetBlocks = [];
        if (applyToAll) {
            targetBlocks = blocks;
        } else if (applyToSelected && selectedIds.size > 0) {
            blocks.forEach(function(b) {
                if (selectedIds.has(b.id)) targetBlocks.push(b);
            });
        }

        if (targetBlocks.length === 0) {
            alert('请先选中组件或勾选"全部组件"');
            return;
        }

        // Apply styles
        targetBlocks.forEach(function(block) {
            // Apply first selected color to main color properties
            if (selectedColors.length > 0) {
                var mainColor = selectedColors[0].color;
                if (block.style.color !== undefined) block.style.color = mainColor;
                if (block.style.titleColor !== undefined) block.style.titleColor = mainColor;
                // Apply second color to secondary elements if available
                if (selectedColors.length > 1) {
                    var secondColor = selectedColors[1].color;
                    if (block.style.bg !== undefined && block.style.bg !== 'transparent') block.style.bg = secondColor;
                }
            }

            // Apply first selected font
            if (selectedFonts.length > 0) {
                var font = selectedFonts[0];
                if (block.style.fontSize !== undefined) block.style.fontSize = font.size;
                if (block.style.fontWeight !== undefined) block.style.fontWeight = font.weight;
                if (block.style.titleSize !== undefined) block.style.titleSize = font.size;
                if (block.style.titleWeight !== undefined) block.style.titleWeight = font.weight;
            }
        });

        render();
        updateEditors();
        closeTemplateModal('applyTemplateModal');

        // Show toast notification
        toastSettings.text = '已应用到 ' + targetBlocks.length + ' 个组件';
        showToast();
    };

    // ==================== History (Undo/Redo) ====================

    function saveHistory() {
        // Remove future states if we're in the middle of history
        if (historyIndex < history.length - 1) {
            history = history.slice(0, historyIndex + 1);
        }
        // Save current state
        history.push(JSON.stringify(blocks));
        if (history.length > maxHistory) {
            history.shift();
        } else {
            historyIndex++;
        }
        updateUndoRedoButtons();
    }

    function undo() {
        if (historyIndex > 0) {
            historyIndex--;
            blocks = JSON.parse(history[historyIndex]);
            render();
            updateEditors();
            updateUndoRedoButtons();
            showToastMsg('已撤销');
        }
    }

    function redo() {
        if (historyIndex < history.length - 1) {
            historyIndex++;
            blocks = JSON.parse(history[historyIndex]);
            render();
            updateEditors();
            updateUndoRedoButtons();
            showToastMsg('已重做');
        }
    }

    function updateUndoRedoButtons() {
        document.getElementById('undoBtn').disabled = historyIndex <= 0;
        document.getElementById('redoBtn').disabled = historyIndex >= history.length - 1;
    }

    function showToastMsg(msg) {
        var toast = document.getElementById('toast');
        toast.textContent = msg;
        toast.classList.add('show');
        setTimeout(function() { toast.classList.remove('show'); }, 1500);
    }

    // ==================== Save/Load/Export ====================

    function saveProject() {
        var data = {
            blocks: blocks,
            idCounter: idCounter,
            globalStyle: globalStyle,
            timestamp: Date.now()
        };
        localStorage.setItem('ios-designer-project', JSON.stringify(data));
        showToastMsg('已保存到本地');
    }

    function exportJSON() {
        var data = {
            blocks: blocks,
            idCounter: idCounter,
            globalStyle: globalStyle,
            exportTime: new Date().toISOString()
        };
        var blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        var url = URL.createObjectURL(blob);
        var a = document.createElement('a');
        a.href = url;
        a.download = 'ios-design-' + Date.now() + '.json';
        a.click();
        URL.revokeObjectURL(url);
        showToastMsg('JSON 已导出');
    }

    // ==================== 导出 HTML 功能 ====================

    var exportState = {
        projectName: 'my-project',
        pageName: '首页',
        lastExportedFilename: '',
        lastExportedBlob: null
    };

    // 显示导出对话框
    function exportHTML() {
        document.getElementById('exportProjectName').value = exportState.projectName;
        document.getElementById('exportPageName').value = exportState.pageName;
        updateExportFilenamePreview();
        document.getElementById('exportDialog').classList.add('show');
    }

    // 更新文件名预览
    function updateExportFilenamePreview() {
        var projectName = document.getElementById('exportProjectName').value.trim() || 'my-project';
        var pageName = document.getElementById('exportPageName').value.trim() || '首页';
        var now = new Date();
        var dateStr = now.getFullYear().toString() +
            String(now.getMonth() + 1).padStart(2, '0') +
            String(now.getDate()).padStart(2, '0') + '-' +
            String(now.getHours()).padStart(2, '0') +
            String(now.getMinutes()).padStart(2, '0');
        var filename = projectName + '-' + pageName + '-' + dateStr + '.html';
        document.getElementById('exportFilenamePreview').textContent = filename;
        return filename;
    }

    // 关闭导出对话框
    function closeExportDialog() {
        document.getElementById('exportDialog').classList.remove('show');
    }

    // 执行导出
    function performExport() {
        exportState.projectName = document.getElementById('exportProjectName').value.trim() || 'my-project';
        exportState.pageName = document.getElementById('exportPageName').value.trim() || '首页';

        // 获取导出类型
        var exportType = document.querySelector('input[name="exportType"]:checked').value;

        var filename = updateExportFilenamePreview();
        // 标注版文件名添加 -inspect 后缀
        if (exportType === 'inspect') {
            filename = filename.replace('.html', '-inspect.html');
        }
        exportState.lastExportedFilename = filename;

        // 生成 HTML 内容（只存在于内存变量中）
        var htmlContent = buildExportHTML(exportType);
        var blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
        exportState.lastExportedBlob = blob;

        // 通过 Blob + URL 下载文件
        var url = URL.createObjectURL(blob);
        var a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.style.display = 'none';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        // 关闭导出对话框，显示成功提示
        closeExportDialog();
        showExportSuccess(filename);
    }

    // 显示导出成功提示
    function showExportSuccess(filename) {
        document.getElementById('exportedFilename').textContent = filename;
        document.getElementById('exportSuccessDialog').classList.add('show');
    }

    // 关闭导出成功提示
    function closeExportSuccess() {
        document.getElementById('exportSuccessDialog').classList.remove('show');
    }

    // 复制文件名
    function copyFilename() {
        var filename = exportState.lastExportedFilename;
        if (navigator.clipboard) {
            navigator.clipboard.writeText(filename).then(function() {
                showToastMsg('文件名已复制');
            });
        }
    }

    // 再次下载
    function redownload() {
        if (exportState.lastExportedBlob && exportState.lastExportedFilename) {
            var url = URL.createObjectURL(exportState.lastExportedBlob);
            var a = document.createElement('a');
            a.href = url;
            a.download = exportState.lastExportedFilename;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showToastMsg('已再次下载');
        }
    }

    // 构建导出 HTML（保持与编辑器画布一致的手机容器结构）
    // 生成导出用的干净HTML（无编辑器控件）
    function renderExportBlock(block, exportType, index) {
        var s = block.style;
        var p = block.props;
        var inspectAttr = exportType === 'inspect' ? ' data-inspect="block-' + index + '"' : '';

        switch (block.type) {
            case 'navbar':
                var navRadius = s.radius ? 'border-radius:' + s.radius + 'px;' : '';
                var navHeight = s.h && s.h !== 'auto' ? 'height:' + s.h + 'px;' : '';
                return '<div class="ios-navbar"' + inspectAttr + ' style="background:' + s.bg + ';' + navRadius + navHeight + '">' +
                    '<div class="ios-navbar-left">' + (p.showLeft ? '<button class="ios-navbar-btn" style="color:' + s.btnColor + '"><i class="fas fa-chevron-left"></i> ' + p.left + '</button>' : '') + '</div>' +
                    '<span class="ios-navbar-title" style="color:' + s.titleColor + ';font-size:' + s.fontSize + 'px;font-weight:' + s.fontWeight + '">' + (p.title || '') + '</span>' +
                    '<div class="ios-navbar-right">' + (p.showRight ? '<button class="ios-navbar-btn" style="color:' + s.btnColor + '">' + p.right + '</button>' : '') + '</div></div>';

            case 'large-title':
                var ltRadius = s.radius ? 'border-radius:' + s.radius + 'px;' : '';
                return '<div class="ios-large-title"' + inspectAttr + ' style="background:' + s.bg + ';padding:' + s.py + 'px ' + s.px + 'px;' + ltRadius + '">' +
                    '<h1 style="color:' + s.color + ';font-size:' + s.fontSize + 'px;font-weight:' + s.fontWeight + ';line-height:' + s.lineHeight + '">' + (p.title || '') + '</h1></div>';

            case 'search':
                var searchRadius = s.radius ? 'border-radius:' + s.radius + 'px;' : '';
                return '<div class="ios-search"' + inspectAttr + ' style="background:' + s.bg + ';padding:8px ' + s.px + 'px;' + searchRadius + '">' +
                    '<div class="ios-search-wrapper"><i class="fas fa-search" style="color:' + s.placeholderColor + '"></i>' +
                    '<input type="text" class="ios-search-input" placeholder="' + p.placeholder + '" style="background:' + s.inputBg + ';color:' + s.color + ';font-size:' + s.fontSize + 'px;border-radius:' + (s.inputRadius || 10) + 'px"></div></div>';

            case 'section-header':
                var shRadius = s.radius ? 'border-radius:' + s.radius + 'px;' : '';
                return '<div class="ios-section-header"' + inspectAttr + ' style="background:' + s.bg + ';padding:' + s.py + 'px ' + s.px + 'px 8px;' + shRadius + '">' +
                    '<span style="color:' + s.color + ';font-size:' + s.fontSize + 'px;font-weight:' + s.fontWeight + '">' + (p.title || '') + '</span></div>';

            case 'list-item':
                var liIconRadius = s.iconRadius !== undefined ? s.iconRadius : 7;
                return '<div class="ios-list-item"' + inspectAttr + ' style="background:' + s.bg + ';padding:' + s.py + 'px ' + s.px + 'px;">' +
                    '<div class="ios-list-icon" style="background:' + p.iconBg + ';width:' + s.iconSize + 'px;height:' + s.iconSize + 'px;border-radius:' + liIconRadius + 'px"><i class="fas ' + p.icon + '"></i></div>' +
                    '<div class="ios-list-content"><div class="ios-list-title" style="color:' + s.titleColor + ';font-size:' + s.titleSize + 'px;font-weight:' + (s.titleWeight || 400) + '">' + (p.title || '') + '</div>' +
                    (p.subtitle ? '<div class="ios-list-subtitle" style="color:' + s.subColor + ';font-size:' + s.subSize + 'px">' + p.subtitle + '</div>' : '') + '</div>' +
                    (p.value ? '<span class="ios-list-value" style="color:' + s.valueColor + '">' + p.value + '</span>' : '') +
                    (p.arrow ? '<span class="ios-list-accessory"><i class="fas fa-chevron-right"></i></span>' : '') + '</div>';

            case 'toggle-item':
                return '<div class="ios-toggle-item"' + inspectAttr + ' style="background:' + s.bg + ';padding:' + s.py + 'px ' + s.px + 'px;">' +
                    '<span style="color:' + s.color + ';font-size:' + s.fontSize + 'px">' + (p.title || '') + '</span>' +
                    '<div class="ios-toggle ' + (p.isOn ? 'on' : '') + '" style="background:' + (p.isOn ? (s.onColor || '#34c759') : (s.offColor || '#d2d2d7')) + '"></div></div>';

            case 'card':
                return '<div class="ios-card"' + inspectAttr + ' style="background:' + s.bg + ';margin:' + s.my + 'px ' + s.mx + 'px;border-radius:' + s.radius + 'px;">' +
                    (p.showImg ? '<div class="ios-card-image" style="height:' + s.imgH + 'px;background:' + s.imgBg + ';color:' + s.imgColor + '"><i class="fas ' + p.imgIcon + '"></i></div>' : '') +
                    '<div class="ios-card-body" style="padding:' + s.py + 'px ' + s.px + 'px"><div class="ios-card-title" style="color:' + s.titleColor + ';font-size:' + s.titleSize + 'px;font-weight:' + (s.titleWeight || 600) + '">' + (p.title || '') + '</div>' +
                    '<div class="ios-card-desc" style="color:' + s.descColor + ';font-size:' + s.descSize + 'px">' + (p.desc || '') + '</div></div></div>';

            case 'button':
                return '<div class="ios-button"' + inspectAttr + ' style="margin:' + s.my + 'px ' + s.mx + 'px;">' +
                    '<button style="background:' + s.bg + ';color:' + s.color + ';font-size:' + s.fontSize + 'px;font-weight:' + s.fontWeight + ';height:' + s.h + 'px;border-radius:' + s.radius + 'px">' + (p.text || '按钮') + '</button></div>';

            case 'avatar-block':
                var abAvatarRadius = s.avatarRadius !== undefined ? s.avatarRadius : Math.round(s.avatarSize / 2);
                return '<div class="ios-avatar-block"' + inspectAttr + ' style="background:' + s.bg + ';padding:' + s.py + 'px ' + s.px + 'px;">' +
                    '<div class="ios-avatar" style="width:' + s.avatarSize + 'px;height:' + s.avatarSize + 'px;font-size:' + (s.avatarSize * 0.4) + 'px;background:' + s.avatarBg + ';color:' + s.avatarColor + ';border-radius:' + abAvatarRadius + 'px"><i class="fas ' + p.icon + '"></i></div>' +
                    '<div class="ios-avatar-name" style="color:' + s.nameColor + ';font-size:' + s.nameSize + 'px;font-weight:' + (s.nameWeight || 600) + '">' + (p.name || '') + '</div>' +
                    '<div class="ios-avatar-subtitle" style="color:' + s.subColor + ';font-size:' + s.subSize + 'px">' + (p.subtitle || '') + '</div></div>';

            case 'text-block':
                return '<div class="ios-text-block"' + inspectAttr + ' style="background:' + s.bg + ';padding:' + s.py + 'px ' + s.px + 'px;">' +
                    '<p style="color:' + s.color + ';font-size:' + s.fontSize + 'px;font-weight:' + (s.fontWeight || 400) + ';line-height:' + s.lineHeight + '">' + (p.text || '') + '</p></div>';

            case 'image-block':
                return '<div class="ios-image-block"' + inspectAttr + ' style="background:' + s.bg + ';height:' + s.h + 'px;margin:' + (s.my || 0) + 'px ' + (s.mx || 0) + 'px;border-radius:' + s.radius + 'px;display:flex;align-items:center;justify-content:center;color:' + s.color + '">' +
                    '<i class="fas ' + p.icon + '" style="font-size:32px"></i></div>';

            case 'divider':
                return '<div class="ios-divider"' + inspectAttr + ' style="background:' + s.bg + ';height:' + s.h + 'px;"></div>';

            case 'spacer':
                return '<div class="ios-spacer"' + inspectAttr + ' style="height:' + s.h + 'px;"></div>';

            case 'tabbar':
                var tabItems = (p.items || []).map(function(item) {
                    return '<div class="ios-tabbar-item ' + (item.active ? 'active' : '') + '">' +
                        '<i class="fas ' + item.icon + '"></i>' +
                        (item.label ? '<span>' + item.label + '</span>' : '') + '</div>';
                }).join('');
                return '<div class="ios-tabbar"' + inspectAttr + '>' + tabItems + '</div>';

            case 'notice-bar':
                return '<div class="ios-notice-bar"' + inspectAttr + ' style="background:' + s.bg + ';color:' + s.color + ';padding:' + s.py + 'px ' + s.px + 'px;font-size:' + s.fontSize + 'px;">' +
                    (p.icon ? '<i class="fas ' + p.icon + '" style="color:' + s.iconColor + ';margin-right:8px"></i>' : '') +
                    '<span>' + (p.text || '') + '</span></div>';

            case 'steps':
                var stepsHtml = (p.items || []).map(function(item, i) {
                    var isActive = i < p.current;
                    var isCurrent = i === p.current - 1;
                    return '<div class="ios-step ' + (isActive ? 'active' : '') + ' ' + (isCurrent ? 'current' : '') + '">' +
                        '<div class="ios-step-num" style="background:' + (isActive ? s.activeColor : s.inactiveColor) + '">' + (i + 1) + '</div>' +
                        '<div class="ios-step-title" style="color:' + (isActive ? s.activeColor : s.inactiveColor) + '">' + item + '</div></div>';
                }).join('');
                return '<div class="ios-steps"' + inspectAttr + ' style="background:' + s.bg + ';padding:' + s.py + 'px ' + s.px + 'px;">' + stepsHtml + '</div>';

            case 'input-field':
                return '<div class="ios-input-field"' + inspectAttr + ' style="background:' + s.bg + ';padding:' + s.py + 'px ' + s.px + 'px;">' +
                    (p.label ? '<label style="color:' + s.labelColor + '">' + p.label + '</label>' : '') +
                    '<input type="' + (p.type || 'text') + '" placeholder="' + (p.placeholder || '') + '" style="background:' + s.inputBg + ';color:' + s.inputColor + ';font-size:' + s.fontSize + 'px;border-radius:' + s.radius + 'px;height:' + s.h + 'px"></div>';

            case 'option-item':
                return '<div class="ios-option-item"' + inspectAttr + ' style="background:' + s.bg + ';padding:12px 16px;">' +
                    '<div class="ios-option-check" style="background:' + (p.checked ? s.checkedBg : s.iconBg) + ';color:' + (p.checked ? '#fff' : s.uncheckedColor) + '">' +
                    (p.checked ? '<i class="fas fa-check"></i>' : '') + '</div>' +
                    '<div class="ios-option-content"><span style="color:' + s.color + ';font-size:' + s.fontSize + 'px">' + (p.text || '') + '</span>' +
                    (p.desc ? '<span style="color:' + s.descColor + ';font-size:' + s.descSize + 'px">' + p.desc + '</span>' : '') + '</div></div>';

            case 'bottom-button':
                return '<div class="ios-bottom-button"' + inspectAttr + ' style="background:' + s.bg + ';padding:12px 16px;display:flex;gap:12px;">' +
                    (p.showLeft ? '<button style="flex:1;background:' + s.leftBg + ';color:' + s.leftColor + ';border:1px solid ' + s.leftBorderColor + ';height:' + s.h + 'px;border-radius:' + s.radius + 'px;font-size:' + s.fontSize + 'px">' + (p.leftText || '') + '</button>' : '') +
                    '<button style="flex:2;background:' + s.rightBg + ';color:' + s.rightColor + ';border:none;height:' + s.h + 'px;border-radius:' + s.radius + 'px;font-size:' + s.fontSize + 'px;font-weight:' + s.fontWeight + '">' + (p.rightText || '') + '</button></div>';

            default:
                return '';
        }
    }

    function buildExportHTML(exportType) {
        var bgColor = globalStyle.bgColor || '#F6F7F8';

        // 复制 blocks 数组并按 y 坐标排序（保证导出顺序与视觉顺序一致）
        var sortedBlocks = blocks.slice().sort(function(a, b) {
            // navbar 始终在最前
            if (a.type === 'navbar') return -1;
            if (b.type === 'navbar') return 1;
            // tabbar 始终在最后
            if (a.type === 'tabbar') return 1;
            if (b.type === 'tabbar') return -1;
            // 其他按 y 坐标排序（从上到下）
            var ay = a.style && a.style.y !== undefined ? a.style.y : 0;
            var by = b.style && b.style.y !== undefined ? b.style.y : 0;
            return ay - by;
        });

        // 调试：输出详细的 blocks 状态（每次导出前验证）
        console.log('╔══════════════════════════════════════════════════════════╗');
        console.log('║           导出调试信息 - 画布状态验证                    ║');
        console.log('╠══════════════════════════════════════════════════════════╣');
        console.log('║ blocks 数组长度:', blocks.length);
        console.log('║ sortedBlocks 长度:', sortedBlocks.length);
        console.log('╠══════════════════════════════════════════════════════════╣');
        console.log('║ 组件详情（按Y坐标排序后）:');
        sortedBlocks.forEach(function(b, i) {
            var info = '║ [' + i + '] id=' + b.id + ' type=' + b.type +
                       ' x=' + (b.style && b.style.x !== undefined ? b.style.x.toFixed(1) : 'N/A') + '%' +
                       ' y=' + (b.style && b.style.y !== undefined ? b.style.y.toFixed(1) : 'N/A') + '%';
            if (b.props && b.props.title) info += ' title="' + b.props.title + '"';
            console.log(info);
        });
        console.log('╚══════════════════════════════════════════════════════════╝');

        // 从排序后的 blocks 生成内容
        var navbarHtml = '';
        var tabbarHtml = '';
        var contentHtml = '';
        var headerHeight = 44;
        var blockIndex = 0;

        for (var i = 0; i < sortedBlocks.length; i++) {
            var block = sortedBlocks[i];
            var html = renderExportBlock(block, exportType, blockIndex++);
            if (html === '') {
                console.warn('[导出警告] 组件 id=' + block.id + ' type=' + block.type + ' 返回空HTML');
            }
            if (block.type === 'navbar') {
                navbarHtml = html;
            } else if (block.type === 'tabbar') {
                tabbarHtml = html;
            } else {
                contentHtml += html;
            }
        }
        console.log('[导出统计] navbar=' + (navbarHtml ? '有' : '无') +
                    ' content组件=' + (sortedBlocks.length - (navbarHtml ? 1 : 0) - (tabbarHtml ? 1 : 0)) +
                    ' tabbar=' + (tabbarHtml ? '有' : '无'));

        var hasHeader = navbarHtml !== '';
        var hasTabbar = tabbarHtml !== '';

        // 基础 CSS - 干净的屏幕内容（无手机壳）
        var baseCSS = [
            '/* Reset */',
            'html, body { margin: 0; padding: 0; }',
            '* { box-sizing: border-box; }',
            'body { font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", sans-serif; background: #f4f5f7; }',
            '',
            '/* CSS Variables */',
            ':root { --bg: ' + bgColor + '; --bg-card: #fff; --text: #111; --muted: #999; --border: #e6e6e8; }',
            '',
            '/* 页面居中 */',
            '.export-page { min-height: 100vh; display: flex; justify-content: center; align-items: flex-start; background: #f4f5f7; padding: 24px 0; }',
            '',
            '/* 屏幕容器 - 390px宽度，圆角，轻阴影 */',
            '.phone-screen { position: relative; width: 390px; min-height: 844px; background: var(--bg); border-radius: 32px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.15); }',
            '',
            '/* 顶部导航栏 - 固定在顶部 */',
            '.screen-header { position: sticky; top: 0; left: 0; right: 0; z-index: 50; background: var(--bg-card); border-radius: 32px 32px 0 0; }',
            '',
            '/* 页面内容 */',
            '.screen-content { min-height: calc(844px - ' + (hasHeader ? headerHeight : 0) + 'px - ' + (hasTabbar ? '64px' : '0px') + '); padding-bottom: ' + (hasTabbar ? '64px' : '20px') + '; }',
            '',
            '/* 底部 TabBar - 固定在底部 */',
            '.screen-tabbar { position: absolute; left: 0; right: 0; bottom: 0; height: 64px; z-index: 40; background: var(--bg-card); border-top: 1px solid rgba(0,0,0,0.06); display: flex; align-items: center; padding: 8px 0 4px; border-radius: 0 0 32px 32px; }',
            '',
            '/* 组件样式 */',
            '.block.free-position { position: absolute; }',
            '.ios-navbar { padding: 12px 16px; display: flex; align-items: center; justify-content: space-between; background: var(--bg-card); }',
            '.ios-navbar-left, .ios-navbar-right { width: 60px; display: flex; align-items: center; }',
            '.ios-navbar-right { justify-content: flex-end; }',
            '.ios-navbar-title { font-size: 17px; font-weight: 600; }',
            '.ios-navbar-btn { background: none; border: none; font-size: 17px; cursor: pointer; }',
            '.ios-large-title { padding: 8px 16px 16px; }',
            '.ios-large-title h1 { font-size: 34px; font-weight: 700; }',
            '.ios-section-header { padding: 24px 16px 8px; }',
            '.ios-section-header h2 { font-size: 22px; font-weight: 700; color: var(--text); }',
            '.ios-search { padding: 8px 16px; }',
            '.ios-search-wrapper { position: relative; }',
            '.ios-search-wrapper i { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--muted); }',
            '.ios-search-input { width: 100%; padding: 10px 12px 10px 36px; border: 1px solid var(--border); border-radius: 8px; font-size: 17px; background: var(--bg-card); }',
            '.ios-list-item { padding: 12px 16px; display: flex; align-items: center; background: var(--bg-card); }',
            '.ios-list-icon { width: 30px; height: 30px; border-radius: 7px; display: flex; align-items: center; justify-content: center; margin-right: 12px; color: #fff; }',
            '.ios-list-content { flex: 1; }',
            '.ios-list-title { font-size: 17px; }',
            '.ios-list-subtitle { font-size: 13px; color: var(--muted); margin-top: 2px; }',
            '.ios-list-arrow { color: var(--muted); font-size: 14px; }',
            '.ios-toggle-item { padding: 12px 16px; display: flex; align-items: center; justify-content: space-between; background: var(--bg-card); }',
            '.ios-toggle { width: 51px; height: 31px; border-radius: 16px; position: relative; cursor: pointer; background: var(--muted); flex-shrink: 0; }',
            '.ios-toggle::after { content: ""; width: 27px; height: 27px; background: #fff; border-radius: 50%; position: absolute; top: 2px; left: 2px; transition: 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }',
            '.ios-toggle.on { background: #34c759; }',
            '.ios-toggle.on::after { transform: translateX(20px); }',
            '.ios-card { margin: 16px; border-radius: 12px; overflow: hidden; background: var(--bg-card); border: 1px solid var(--border); }',
            '.ios-card-body { padding: 16px; }',
            '.ios-card-title { font-size: 17px; font-weight: 600; margin-bottom: 4px; }',
            '.ios-card-desc { font-size: 15px; color: var(--muted); }',
            '.ios-button { margin: 16px; }',
            '.ios-button button { width: 100%; border: none; border-radius: 12px; font-size: 17px; font-weight: 600; cursor: pointer; padding: 14px 20px; }',
            '.ios-avatar-block { padding: 24px 16px; display: flex; flex-direction: column; align-items: center; background: var(--bg-card); }',
            '.ios-avatar { display: flex; align-items: center; justify-content: center; margin-bottom: 12px; }',
            '.ios-avatar-name { font-size: 20px; font-weight: 600; margin-bottom: 4px; }',
            '.ios-avatar-subtitle { font-size: 14px; color: var(--muted); }',
            '.ios-text-block { padding: 16px; background: var(--bg-card); }',
            '.ios-text-block p { font-size: 15px; color: var(--muted); line-height: 1.5; }',
            '.ios-divider { height: 1px; background: var(--border); }',
            '.ios-spacer { height: 24px; }',
            '.ios-tabbar { display: flex; width: 100%; }',
            '.ios-tabbar-item { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px; font-size: 10px; cursor: pointer; color: var(--muted); }',
            '.ios-tabbar-item.active { color: var(--text); }',
            '.ios-tabbar-item i { font-size: 24px; }',
            '.ios-image-block { display: flex; align-items: center; justify-content: center; background: #f0f0f0; }',
            '.ios-notice-bar { display: flex; align-items: center; }',
            '.ios-steps { display: flex; justify-content: space-between; }',
            '.ios-step { display: flex; flex-direction: column; align-items: center; flex: 1; }',
            '.ios-step-num { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 12px; margin-bottom: 4px; }',
            '.ios-step-title { font-size: 11px; }',
            '.ios-input-field { display: flex; flex-direction: column; gap: 8px; }',
            '.ios-input-field label { font-size: 13px; font-weight: 500; }',
            '.ios-input-field input { width: 100%; border: 1px solid var(--border); padding: 0 12px; }',
            '.ios-option-item { display: flex; align-items: center; gap: 12px; }',
            '.ios-option-check { width: 22px; height: 22px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; }',
            '.ios-option-content { display: flex; flex-direction: column; }',
            '.ios-bottom-button button { cursor: pointer; }',
            '.ios-list-accessory { color: var(--muted); font-size: 14px; margin-left: 8px; }',
            '.ios-card-image { display: flex; align-items: center; justify-content: center; font-size: 32px; }',
            '.text-placeholder { color: var(--muted); font-style: italic; }'
        ].join('\n');

        // 标注版额外 CSS
        var inspectCSS = exportType === 'inspect' ? [
            '',
            '/* === Inspect 模式样式 === */',
            '.inspect-toggle { position: fixed; top: 16px; right: 16px; z-index: 10001; display: flex; background: rgba(0,0,0,0.9); border-radius: 8px; padding: 4px; }',
            '.inspect-toggle button { padding: 8px 16px; border: none; background: transparent; color: rgba(255,255,255,0.6); font-size: 13px; font-weight: 500; cursor: pointer; border-radius: 6px; transition: all 0.15s; }',
            '.inspect-toggle button.active { background: rgba(255,255,255,0.15); color: #fff; }',
            '.inspect-tooltip { position: fixed; background: rgba(30,30,30,0.95); color: #fff; padding: 12px 14px; border-radius: 8px; font-size: 11px; font-family: "SF Mono", Monaco, monospace; line-height: 1.6; z-index: 10000; pointer-events: none; display: none; max-width: 260px; box-shadow: 0 8px 24px rgba(0,0,0,0.3); }',
            '.inspect-tooltip.visible { display: block; }',
            '.inspect-row { display: flex; justify-content: space-between; padding: 2px 0; }',
            '.inspect-label { color: rgba(255,255,255,0.5); }',
            '.inspect-value { color: #81C784; font-weight: 500; }',
            '.inspect-section { margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1); }',
            '.inspect-section-title { font-size: 10px; color: #FFB74D; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; }',
            'body.inspect-mode [data-inspect]:hover { outline: 2px dashed #4FC3F7 !important; outline-offset: 2px; }',
            '.inspect-distance { position: absolute; pointer-events: none; z-index: 9999; }',
            '.inspect-distance-line { background: #FF5722; }',
            '.inspect-distance-label { position: absolute; background: #FF5722; color: #fff; font-size: 10px; padding: 2px 6px; border-radius: 3px; font-family: "SF Mono", Monaco, monospace; white-space: nowrap; }'
        ].join('\n') : '';

        // 标注版 HTML 结构
        var inspectHTML = exportType === 'inspect' ? [
            '',
            '<!-- Inspect 模式切换按钮 -->',
            '<div class="inspect-toggle">',
            '  <button id="btnUI" class="active">UI</button>',
            '  <button id="btnInspect">Inspect</button>',
            '</div>',
            '',
            '<!-- Inspect 信息浮层 -->',
            '<div class="inspect-tooltip" id="inspectTooltip"></div>'
        ].join('\n') : '';

        // 标注版 JS
        var inspectJS = exportType === 'inspect' ? [
            '<script>',
            '(function() {',
            '  var inspectMode = false;',
            '  var tooltip = document.getElementById("inspectTooltip");',
            '  var btnUI = document.getElementById("btnUI");',
            '  var btnInspect = document.getElementById("btnInspect");',
            '  var altPressed = false;',
            '  var distanceEls = [];',
            '',
            '  btnUI.onclick = function() { setInspectMode(false); };',
            '  btnInspect.onclick = function() { setInspectMode(true); };',
            '',
            '  function setInspectMode(enabled) {',
            '    inspectMode = enabled;',
            '    document.body.classList.toggle("inspect-mode", enabled);',
            '    btnUI.classList.toggle("active", !enabled);',
            '    btnInspect.classList.toggle("active", enabled);',
            '    if (!enabled) hideTooltip();',
            '  }',
            '',
            '  function rgbToHex(rgb) {',
            '    if (!rgb || rgb === "transparent") return "transparent";',
            '    var m = rgb.match(/rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)/);',
            '    if (!m) return rgb;',
            '    return "#" + [m[1],m[2],m[3]].map(function(x) { return parseInt(x).toString(16).padStart(2,"0"); }).join("");',
            '  }',
            '',
            '  function showTooltip(el) {',
            '    if (!inspectMode) return;',
            '    var rect = el.getBoundingClientRect();',
            '    var cs = getComputedStyle(el);',
            '    var html = "";',
            '    html += "<div class=\\"inspect-section\\"><div class=\\"inspect-section-title\\">尺寸 Size</div>";',
            '    html += "<div class=\\"inspect-row\\"><span class=\\"inspect-label\\">宽×高</span><span class=\\"inspect-value\\">" + Math.round(rect.width) + " × " + Math.round(rect.height) + " px</span></div></div>";',
            '    var p = cs.padding, m = cs.margin;',
            '    if (p !== "0px" || m !== "0px") {',
            '      html += "<div class=\\"inspect-section\\"><div class=\\"inspect-section-title\\">间距 Spacing</div>";',
            '      if (p !== "0px") html += "<div class=\\"inspect-row\\"><span class=\\"inspect-label\\">padding</span><span class=\\"inspect-value\\">" + p + "</span></div>";',
            '      if (m !== "0px") html += "<div class=\\"inspect-row\\"><span class=\\"inspect-label\\">margin</span><span class=\\"inspect-value\\">" + m + "</span></div>";',
            '      html += "</div>";',
            '    }',
            '    var textEl = el.querySelector("h1,h2,p,span,button,.ios-navbar-title,.ios-list-title,.ios-card-title");',
            '    if (textEl) {',
            '      var ts = getComputedStyle(textEl);',
            '      html += "<div class=\\"inspect-section\\"><div class=\\"inspect-section-title\\">文字 Typography</div>";',
            '      html += "<div class=\\"inspect-row\\"><span class=\\"inspect-label\\">font-size</span><span class=\\"inspect-value\\">" + ts.fontSize + "</span></div>";',
            '      html += "<div class=\\"inspect-row\\"><span class=\\"inspect-label\\">line-height</span><span class=\\"inspect-value\\">" + ts.lineHeight + "</span></div>";',
            '      html += "<div class=\\"inspect-row\\"><span class=\\"inspect-label\\">font-weight</span><span class=\\"inspect-value\\">" + ts.fontWeight + "</span></div>";',
            '      html += "<div class=\\"inspect-row\\"><span class=\\"inspect-label\\">color</span><span class=\\"inspect-value\\">" + rgbToHex(ts.color) + "</span></div>";',
            '      html += "</div>";',
            '    }',
            '    var bg = cs.backgroundColor;',
            '    if (bg && bg !== "rgba(0, 0, 0, 0)" && bg !== "transparent") {',
            '      html += "<div class=\\"inspect-section\\"><div class=\\"inspect-section-title\\">背景 Background</div>";',
            '      html += "<div class=\\"inspect-row\\"><span class=\\"inspect-label\\">background</span><span class=\\"inspect-value\\">" + rgbToHex(bg) + "</span></div></div>";',
            '    }',
            '    tooltip.innerHTML = html;',
            '    var left = rect.left + rect.width/2 - 130;',
            '    var top = rect.bottom + 10;',
            '    if (left < 10) left = 10;',
            '    if (left + 260 > window.innerWidth) left = window.innerWidth - 270;',
            '    if (top + 200 > window.innerHeight) top = rect.top - 10 - tooltip.offsetHeight;',
            '    tooltip.style.left = left + "px";',
            '    tooltip.style.top = top + "px";',
            '    tooltip.classList.add("visible");',
            '  }',
            '',
            '  function hideTooltip() { tooltip.classList.remove("visible"); }',
            '',
            '  document.addEventListener("mouseover", function(e) {',
            '    var el = e.target.closest("[data-inspect]");',
            '    if (el) showTooltip(el);',
            '  });',
            '  document.addEventListener("mouseout", function(e) {',
            '    var el = e.target.closest("[data-inspect]");',
            '    var rel = e.relatedTarget ? e.relatedTarget.closest("[data-inspect]") : null;',
            '    if (el && el !== rel) hideTooltip();',
            '  });',
            '',
            '  // Alt/Option 键显示间距',
            '  document.addEventListener("keydown", function(e) {',
            '    if ((e.key === "Alt" || e.key === "Option") && inspectMode && !altPressed) {',
            '      altPressed = true;',
            '      showDistances();',
            '    }',
            '  });',
            '  document.addEventListener("keyup", function(e) {',
            '    if (e.key === "Alt" || e.key === "Option") {',
            '      altPressed = false;',
            '      clearDistances();',
            '    }',
            '  });',
            '',
            '  function showDistances() {',
            '    var hovered = document.querySelector("[data-inspect]:hover");',
            '    if (!hovered) return;',
            '    var parent = hovered.parentElement;',
            '    if (!parent) return;',
            '    var cr = hovered.getBoundingClientRect();',
            '    var pr = parent.getBoundingClientRect();',
            '    var top = cr.top - pr.top;',
            '    var left = cr.left - pr.left;',
            '    var right = pr.right - cr.right;',
            '    var bottom = pr.bottom - cr.bottom;',
            '    if (top > 0) createDistanceLine("top", cr, top);',
            '    if (left > 0) createDistanceLine("left", cr, left);',
            '    if (right > 0) createDistanceLine("right", cr, right);',
            '    if (bottom > 0) createDistanceLine("bottom", cr, bottom);',
            '  }',
            '',
            '  function createDistanceLine(dir, rect, dist) {',
            '    var line = document.createElement("div");',
            '    line.className = "inspect-distance";',
            '    var lbl = document.createElement("div");',
            '    lbl.className = "inspect-distance-label";',
            '    lbl.textContent = Math.round(dist) + "px";',
            '    if (dir === "top") {',
            '      line.innerHTML = "<div class=\\"inspect-distance-line\\" style=\\"width:1px;height:" + dist + "px;\\"></div>";',
            '      line.style.left = (rect.left + rect.width/2) + "px";',
            '      line.style.top = (rect.top - dist) + "px";',
            '      lbl.style.left = "4px"; lbl.style.top = (dist/2 - 8) + "px";',
            '    } else if (dir === "left") {',
            '      line.innerHTML = "<div class=\\"inspect-distance-line\\" style=\\"width:" + dist + "px;height:1px;\\"></div>";',
            '      line.style.left = (rect.left - dist) + "px";',
            '      line.style.top = (rect.top + rect.height/2) + "px";',
            '      lbl.style.left = (dist/2 - 15) + "px"; lbl.style.top = "4px";',
            '    } else if (dir === "right") {',
            '      line.innerHTML = "<div class=\\"inspect-distance-line\\" style=\\"width:" + dist + "px;height:1px;\\"></div>";',
            '      line.style.left = rect.right + "px";',
            '      line.style.top = (rect.top + rect.height/2) + "px";',
            '      lbl.style.left = (dist/2 - 15) + "px"; lbl.style.top = "4px";',
            '    } else if (dir === "bottom") {',
            '      line.innerHTML = "<div class=\\"inspect-distance-line\\" style=\\"width:1px;height:" + dist + "px;\\"></div>";',
            '      line.style.left = (rect.left + rect.width/2) + "px";',
            '      line.style.top = rect.bottom + "px";',
            '      lbl.style.left = "4px"; lbl.style.top = (dist/2 - 8) + "px";',
            '    }',
            '    line.appendChild(lbl);',
            '    document.body.appendChild(line);',
            '    distanceEls.push(line);',
            '  }',
            '',
            '  function clearDistances() {',
            '    distanceEls.forEach(function(el) { el.remove(); });',
            '    distanceEls = [];',
            '  }',
            '})();',
            '</' + 'script>'
        ].join('\n') : '';

        // 构建完整 HTML 字符串 - 干净结构（无手机壳）
        var html = [
            '<!DOCTYPE html>',
            '<html lang="zh-CN">',
            '<head>',
            '<meta charset="UTF-8">',
            '<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">',
            '<title>' + exportState.pageName + (exportType === 'inspect' ? ' - Inspect' : '') + '</title>',
            '<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">',
            '<style>',
            baseCSS,
            inspectCSS,
            '</style>',
            '</head>',
            '<body>',
            '<div class="export-page">',
            '  <div class="phone-screen">',
            hasHeader ? '    <div class="screen-header">' + navbarHtml + '</div>' : '',
            '    <div class="screen-content">',
            contentHtml,
            '    </div>',
            hasTabbar ? '    <div class="screen-tabbar">' + tabbarHtml + '</div>' : '',
            '  </div>',
            '</div>',
            inspectHTML,
            inspectJS,
            '</body>',
            '</html>'
        ].join('\n');

        return html;
    }

    function clearAll() {
        if (blocks.length === 0) return;
        showConfirmDialog(
            '确认清空本页面？',
            '仅清空当前页面，不影响其他内容。清空后可通过"撤销"恢复。',
            '清空',
            function() {
                blocks = [];
                selectedIds.clear();
                saveHistory();
                render();
                updateEditors();
                showToastMsg('已清空，可撤销恢复');
            }
        );
    }

    // ==================== Alignment Functions ====================

    function alignBlocks(direction) {
        if (selectedIds.size < 1) {
            showToastMsg('请先选中组件');
            return;
        }

        var selectedBlocks = [];
        selectedIds.forEach(function(id) {
            var b = findBlock(id);
            if (b && b.type !== 'tabbar') selectedBlocks.push(b);
        });

        if (selectedBlocks.length === 0) return;

        // If only one block, align to canvas
        if (selectedBlocks.length === 1) {
            var b = selectedBlocks[0];
            var bw = b.style.w === 'auto' ? 10 : (b.style.w || 100);
            switch (direction) {
                case 'left': b.style.x = 0; break;
                case 'center': b.style.x = (100 - bw) / 2; break;
                case 'right': b.style.x = 100 - bw; break;
                case 'top': b.style.y = 0; break;
                case 'middle': b.style.y = 50; break;
                case 'bottom': b.style.y = 80; break;
            }
        } else {
            // Align to first selected block
            var first = selectedBlocks[0];
            var firstW = first.style.w === 'auto' ? 10 : (first.style.w || 100);

            for (var i = 1; i < selectedBlocks.length; i++) {
                var b = selectedBlocks[i];
                var bw = b.style.w === 'auto' ? 10 : (b.style.w || 100);
                switch (direction) {
                    case 'left': b.style.x = first.style.x; break;
                    case 'center': b.style.x = first.style.x + (firstW - bw) / 2; break;
                    case 'right': b.style.x = first.style.x + firstW - bw; break;
                    case 'top': b.style.y = first.style.y; break;
                    case 'middle': b.style.y = first.style.y; break;
                    case 'bottom': b.style.y = first.style.y; break;
                }
            }
        }

        saveHistory();
        render();
        showToastMsg('对齐完成');
    }

    function distributeBlocks(direction) {
        if (selectedIds.size < 3) {
            showToastMsg('需要选择至少 3 个组件');
            return;
        }

        var selectedBlocks = [];
        selectedIds.forEach(function(id) {
            var b = findBlock(id);
            if (b && b.type !== 'tabbar') selectedBlocks.push(b);
        });

        if (selectedBlocks.length < 3) {
            showToastMsg('需要选择至少 3 个组件');
            return;
        }

        if (direction === 'horizontal') {
            // Sort by x position
            selectedBlocks.sort(function(a, b) { return (a.style.x || 0) - (b.style.x || 0); });
            var first = selectedBlocks[0];
            var last = selectedBlocks[selectedBlocks.length - 1];
            var totalSpace = (last.style.x || 0) - (first.style.x || 0);
            var gap = totalSpace / (selectedBlocks.length - 1);

            for (var i = 1; i < selectedBlocks.length - 1; i++) {
                selectedBlocks[i].style.x = (first.style.x || 0) + gap * i;
            }
        } else {
            // Sort by y position
            selectedBlocks.sort(function(a, b) { return (a.style.y || 0) - (b.style.y || 0); });
            var first = selectedBlocks[0];
            var last = selectedBlocks[selectedBlocks.length - 1];
            var totalSpace = (last.style.y || 0) - (first.style.y || 0);
            var gap = totalSpace / (selectedBlocks.length - 1);

            for (var i = 1; i < selectedBlocks.length - 1; i++) {
                selectedBlocks[i].style.y = (first.style.y || 0) + gap * i;
            }
        }

        saveHistory();
        render();
        showToastMsg('均分完成');
    }

    // ==================== Distance Bubbles ====================

    function showDistanceBubble(x, y, distance, direction) {
        var canvas = document.getElementById('canvas');
        var canvasRect = canvas.getBoundingClientRect();
        var bubble = document.createElement('div');
        bubble.className = 'distance-bubble';
        // 将百分比转换为像素，根据方向使用宽度或高度
        var pxDistance;
        if (direction === 'v') {
            pxDistance = Math.round(distance * canvasRect.height / 100);
        } else {
            pxDistance = Math.round(distance * canvasRect.width / 100);
        }
        // 显示最接近的标准间距值（8/12/16/24/32）或实际像素值
        var standardSpacing = [8, 12, 16, 24, 32];
        var closestStandard = standardSpacing.reduce(function(prev, curr) {
            return Math.abs(curr - pxDistance) < Math.abs(prev - pxDistance) ? curr : prev;
        });
        // 如果接近标准值（±2px），显示标准值，否则显示实际值
        var displayValue = Math.abs(pxDistance - closestStandard) <= 2 ? closestStandard : pxDistance;
        bubble.textContent = displayValue;
        bubble.style.left = x + '%';
        bubble.style.top = y + '%';
        canvas.appendChild(bubble);
        distanceBubbles.push(bubble);
    }

    function clearDistanceBubbles() {
        distanceBubbles.forEach(function(b) {
            if (b.parentNode) b.parentNode.removeChild(b);
        });
        distanceBubbles = [];
    }

    // Save history after block operations
    var originalAddBlock = addBlock;
    addBlock = function(type) {
        originalAddBlock(type);
        saveHistory();
    };

    var originalAddBlockAtPosition = addBlockAtPosition;
    addBlockAtPosition = function(type, x, y) {
        originalAddBlockAtPosition(type, x, y);
        saveHistory();
    };

    var originalDeleteBlock = deleteBlock;
    deleteBlock = function(id) {
        originalDeleteBlock(id);
        saveHistory();
    };

    var originalCopyBlock = copyBlock;
    copyBlock = function(id) {
        originalCopyBlock(id);
        saveHistory();
    };
})();
</script>
</body>
</html>
